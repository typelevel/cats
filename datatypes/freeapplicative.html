<!DOCTYPE html>
<html lang="en">
  
  <head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="generator" content="Typelevel Laika + Helium Theme" />
  <title>Free Applicative</title>
  
  <meta name="author" content="cats contributors"/>
  
  <meta name="author" content="Cody Allen"/>
  
  <meta name="author" content="Ross Baker"/>
  
  <meta name="author" content="Arman Bilge"/>
  
  <meta name="author" content="P. Oscar Boykin"/>
  
  <meta name="author" content="Travis Brown"/>
  
  <meta name="author" content="Adelbert Chang"/>
  
  <meta name="author" content="Daniel Esik"/>
  
  <meta name="author" content="Peter Neyens"/>
  
  <meta name="author" content="Rob Norris"/>
  
  <meta name="author" content="Erik Osheim"/>
  
  <meta name="author" content="LukaJCB"/>
  
  <meta name="author" content="Michael Pilquist"/>
  
  <meta name="author" content="Miles Sabin"/>
  
  <meta name="author" content="Daniel Spiewak"/>
  
  <meta name="author" content="Frank Thomas"/>
  
  <meta name="author" content="Sergey Torgashov"/>
  
  <meta name="author" content="Julien Truffaut"/>
  
  <meta name="author" content="Kailuo Wang"/>
  
  
  <meta name="description" content="docs"/>
  
  
  
  <link rel="icon" sizes="32x32" type="image/png" href="https://typelevel.org/img/favicon.png"/>
  
  
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:400,700">
  
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Fira+Mono:500">
  
  <link rel="stylesheet" type="text/css" href="../helium/site/icofont.min.css" />
    <link rel="stylesheet" type="text/css" href="../helium/site/laika-helium.css" />
  <script src="../helium/site/laika-helium.js"></script>
  
  
  <script> /* for avoiding page load transitions */ </script>
</head>

  <body>

    <header id="top-bar" class="light-default dark-default">

  <div class="row">
    <a id="nav-icon">
      <i class="icofont-laika navigationMenu" title="Navigation">&#xefa2;</i>
    </a>
    
    
  </div>

  <a class="image-link" href="https://typelevel.org"><img src="https://typelevel.org/img/logo.svg"></a>

  <div class="row links">
    
    <a class="icon-link svg-link" href="https://www.javadoc.io/doc/org.typelevel/cats-docs_2.13/2.12.0/"><span class="api" title="API"><svg class="svg-icon" width="100%" height="100%" viewBox="0 0 100 100" version="1.1" xmlns="http://www.w3.org/2000/svg" xml:space="preserve" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:2;">
  <g class="svg-shape">
    <path d="M75,47.5c13.246,0 24,10.754 24,24c0,13.246 -10.754,24 -24,24c-13.246,0 -24,-10.754 -24,-24c0,-13.246 10.754,-24 24,-24Zm-50,-0c13.246,-0 24,10.754 24,24c0,13.246 -10.754,24 -24,24c-13.246,-0 -24,-10.754 -24,-24c0,-13.246 10.754,-24 24,-24Zm2.705,16.735l7.239,0l0.622,-4.904l-21.833,0l-0,4.904l7.589,0l0,22.067l6.383,0l-0,-22.067Zm58.076,7.265c-0,-8.757 -3.698,-14.166 -10.781,-14.166c-7.083,-0 -10.781,5.604 -10.781,14.166c0,8.757 3.698,14.166 10.781,14.166c7.083,0 10.781,-5.604 10.781,-14.166Zm-6.539,0c0,6.538 -1.128,9.496 -4.242,9.496c-2.997,0 -4.242,-2.88 -4.242,-9.496c-0,-6.616 1.206,-9.496 4.242,-9.496c3.036,-0 4.242,2.88 4.242,9.496Zm-29.242,-67c13.246,0 24,10.754 24,24c0,13.246 -10.754,24 -24,24c-13.246,0 -24,-10.754 -24,-24c0,-13.246 10.754,-24 24,-24Zm0.512,9.834c-7.122,-0 -12.609,5.098 -12.609,14.127c-0,9.263 5.215,14.205 12.532,14.205c4.164,0 7.083,-1.634 9.068,-3.658l-2.88,-3.697c-1.518,1.206 -3.153,2.413 -5.838,2.413c-3.697,-0 -6.266,-2.763 -6.266,-9.263c-0,-6.616 2.724,-9.379 6.149,-9.379c2.102,-0 3.892,0.778 5.371,1.984l3.113,-3.775c-2.257,-1.868 -4.748,-2.957 -8.64,-2.957Z"/>
  </g>
</svg></span></a>
    
    <a class="icon-link svg-link" href="https://github.com/typelevel/cats"><span class="github" title="Source Code"><svg class="svg-icon" width="100%" height="100%" viewBox="0 0 100 100" version="1.1" xmlns="http://www.w3.org/2000/svg" xml:space="preserve" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:2;">
  <g class="svg-shape">
    <path d="M49.995,1c-27.609,-0 -49.995,22.386 -49.995,50.002c-0,22.09 14.325,40.83 34.194,47.444c2.501,0.458 3.413,-1.086 3.413,-2.412c0,-1.185 -0.043,-4.331 -0.067,-8.503c-13.908,3.021 -16.843,-6.704 -16.843,-6.704c-2.274,-5.773 -5.552,-7.311 -5.552,-7.311c-4.54,-3.103 0.344,-3.042 0.344,-3.042c5.018,0.356 7.658,5.154 7.658,5.154c4.46,7.64 11.704,5.433 14.552,4.156c0.454,-3.232 1.744,-5.436 3.174,-6.685c-11.102,-1.262 -22.775,-5.553 -22.775,-24.713c-0,-5.457 1.949,-9.92 5.147,-13.416c-0.516,-1.265 -2.231,-6.348 0.488,-13.233c0,0 4.199,-1.344 13.751,5.126c3.988,-1.108 8.266,-1.663 12.518,-1.682c4.245,0.019 8.523,0.574 12.517,1.682c9.546,-6.47 13.736,-5.126 13.736,-5.126c2.728,6.885 1.013,11.968 0.497,13.233c3.204,3.496 5.141,7.959 5.141,13.416c0,19.209 -11.691,23.436 -22.83,24.673c1.795,1.544 3.394,4.595 3.394,9.26c0,6.682 -0.061,12.076 -0.061,13.715c0,1.338 0.899,2.894 3.438,2.406c19.853,-6.627 34.166,-25.354 34.166,-47.438c-0,-27.616 -22.389,-50.002 -50.005,-50.002"/>
  </g>
</svg></span></a>
    
    <a class="icon-link glyph-link" href="https://discord.gg/XF3CXcMzqD"><i class="icofont-laika chat" title="Chat">&#xeed5;</i></a>
    
    <a class="icon-link svg-link" href="https://fosstodon.org/@typelevel"><span class="mastodon" title="Mastodon"><svg class="svg-icon" width="100%" height="100%" viewBox="0 0 16 16" version="1.1" xmlns="http://www.w3.org/2000/svg">
  <g class="svg-shape">
    <path d="M11.19 12.195c2.016-.24 3.77-1.475 3.99-2.603.348-1.778.32-4.339.32-4.339 0-3.47-2.286-4.488-2.286-4.488C12.062.238 10.083.017 8.027 0h-.05C5.92.017 3.942.238 2.79.765c0 0-2.285 1.017-2.285 4.488l-.002.662c-.004.64-.007 1.35.011 2.091.083 3.394.626 6.74 3.78 7.57 1.454.383 2.703.463 3.709.408 1.823-.1 2.847-.647 2.847-.647l-.06-1.317s-1.303.41-2.767.36c-1.45-.05-2.98-.156-3.215-1.928a3.614 3.614 0 0 1-.033-.496s1.424.346 3.228.428c1.103.05 2.137-.064 3.188-.189zm1.613-2.47H11.13v-4.08c0-.859-.364-1.295-1.091-1.295-.804 0-1.207.517-1.207 1.541v2.233H7.168V5.89c0-1.024-.403-1.541-1.207-1.541-.727 0-1.091.436-1.091 1.296v4.079H3.197V5.522c0-.859.22-1.541.66-2.046.456-.505 1.052-.764 1.793-.764.856 0 1.504.328 1.933.983L8 4.39l.417-.695c.429-.655 1.077-.983 1.934-.983.74 0 1.336.259 1.791.764.442.505.661 1.187.661 2.046v4.203z"/>
  </g>
</svg></span></a>
    
  </div>  

</header>
    
    <nav id="sidebar">

  <div class="row">
    
    <a class="icon-link svg-link" href="https://www.javadoc.io/doc/org.typelevel/cats-docs_2.13/2.12.0/"><span class="api" title="API"><svg class="svg-icon" width="100%" height="100%" viewBox="0 0 100 100" version="1.1" xmlns="http://www.w3.org/2000/svg" xml:space="preserve" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:2;">
  <g class="svg-shape">
    <path d="M75,47.5c13.246,0 24,10.754 24,24c0,13.246 -10.754,24 -24,24c-13.246,0 -24,-10.754 -24,-24c0,-13.246 10.754,-24 24,-24Zm-50,-0c13.246,-0 24,10.754 24,24c0,13.246 -10.754,24 -24,24c-13.246,-0 -24,-10.754 -24,-24c0,-13.246 10.754,-24 24,-24Zm2.705,16.735l7.239,0l0.622,-4.904l-21.833,0l-0,4.904l7.589,0l0,22.067l6.383,0l-0,-22.067Zm58.076,7.265c-0,-8.757 -3.698,-14.166 -10.781,-14.166c-7.083,-0 -10.781,5.604 -10.781,14.166c0,8.757 3.698,14.166 10.781,14.166c7.083,0 10.781,-5.604 10.781,-14.166Zm-6.539,0c0,6.538 -1.128,9.496 -4.242,9.496c-2.997,0 -4.242,-2.88 -4.242,-9.496c-0,-6.616 1.206,-9.496 4.242,-9.496c3.036,-0 4.242,2.88 4.242,9.496Zm-29.242,-67c13.246,0 24,10.754 24,24c0,13.246 -10.754,24 -24,24c-13.246,0 -24,-10.754 -24,-24c0,-13.246 10.754,-24 24,-24Zm0.512,9.834c-7.122,-0 -12.609,5.098 -12.609,14.127c-0,9.263 5.215,14.205 12.532,14.205c4.164,0 7.083,-1.634 9.068,-3.658l-2.88,-3.697c-1.518,1.206 -3.153,2.413 -5.838,2.413c-3.697,-0 -6.266,-2.763 -6.266,-9.263c-0,-6.616 2.724,-9.379 6.149,-9.379c2.102,-0 3.892,0.778 5.371,1.984l3.113,-3.775c-2.257,-1.868 -4.748,-2.957 -8.64,-2.957Z"/>
  </g>
</svg></span></a>
    
    <a class="icon-link svg-link" href="https://github.com/typelevel/cats"><span class="github" title="Source Code"><svg class="svg-icon" width="100%" height="100%" viewBox="0 0 100 100" version="1.1" xmlns="http://www.w3.org/2000/svg" xml:space="preserve" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:2;">
  <g class="svg-shape">
    <path d="M49.995,1c-27.609,-0 -49.995,22.386 -49.995,50.002c-0,22.09 14.325,40.83 34.194,47.444c2.501,0.458 3.413,-1.086 3.413,-2.412c0,-1.185 -0.043,-4.331 -0.067,-8.503c-13.908,3.021 -16.843,-6.704 -16.843,-6.704c-2.274,-5.773 -5.552,-7.311 -5.552,-7.311c-4.54,-3.103 0.344,-3.042 0.344,-3.042c5.018,0.356 7.658,5.154 7.658,5.154c4.46,7.64 11.704,5.433 14.552,4.156c0.454,-3.232 1.744,-5.436 3.174,-6.685c-11.102,-1.262 -22.775,-5.553 -22.775,-24.713c-0,-5.457 1.949,-9.92 5.147,-13.416c-0.516,-1.265 -2.231,-6.348 0.488,-13.233c0,0 4.199,-1.344 13.751,5.126c3.988,-1.108 8.266,-1.663 12.518,-1.682c4.245,0.019 8.523,0.574 12.517,1.682c9.546,-6.47 13.736,-5.126 13.736,-5.126c2.728,6.885 1.013,11.968 0.497,13.233c3.204,3.496 5.141,7.959 5.141,13.416c0,19.209 -11.691,23.436 -22.83,24.673c1.795,1.544 3.394,4.595 3.394,9.26c0,6.682 -0.061,12.076 -0.061,13.715c0,1.338 0.899,2.894 3.438,2.406c19.853,-6.627 34.166,-25.354 34.166,-47.438c-0,-27.616 -22.389,-50.002 -50.005,-50.002"/>
  </g>
</svg></span></a>
    
    <a class="icon-link glyph-link" href="https://discord.gg/XF3CXcMzqD"><i class="icofont-laika chat" title="Chat">&#xeed5;</i></a>
    
    <a class="icon-link svg-link" href="https://fosstodon.org/@typelevel"><span class="mastodon" title="Mastodon"><svg class="svg-icon" width="100%" height="100%" viewBox="0 0 16 16" version="1.1" xmlns="http://www.w3.org/2000/svg">
  <g class="svg-shape">
    <path d="M11.19 12.195c2.016-.24 3.77-1.475 3.99-2.603.348-1.778.32-4.339.32-4.339 0-3.47-2.286-4.488-2.286-4.488C12.062.238 10.083.017 8.027 0h-.05C5.92.017 3.942.238 2.79.765c0 0-2.285 1.017-2.285 4.488l-.002.662c-.004.64-.007 1.35.011 2.091.083 3.394.626 6.74 3.78 7.57 1.454.383 2.703.463 3.709.408 1.823-.1 2.847-.647 2.847-.647l-.06-1.317s-1.303.41-2.767.36c-1.45-.05-2.98-.156-3.215-1.928a3.614 3.614 0 0 1-.033-.496s1.424.346 3.228.428c1.103.05 2.137-.064 3.188-.189zm1.613-2.47H11.13v-4.08c0-.859-.364-1.295-1.091-1.295-.804 0-1.207.517-1.207 1.541v2.233H7.168V5.89c0-1.024-.403-1.541-1.207-1.541-.727 0-1.091.436-1.091 1.296v4.079H3.197V5.522c0-.859.22-1.541.66-2.046.456-.505 1.052-.764 1.793-.764.856 0 1.504.328 1.933.983L8 4.39l.417-.695c.429-.655 1.077-.983 1.934-.983.74 0 1.336.259 1.791.764.442.505.661 1.187.661 2.046v4.203z"/>
  </g>
</svg></span></a>
    
  </div>

  <ul class="nav-list">
    <li class="level1 nav-leaf"><a href="../">Cats</a></li>
    <li class="level1 nav-leaf"><a href="../typeclasses.html">Type Classes</a></li>
    <li class="level1 nav-leaf"><a href="../datatypes.html">Data Types</a></li>
    <li class="level1 nav-leaf"><a href="../algebra.html">Algebra</a></li>
    <li class="level1 nav-leaf"><a href="../alleycats.html">Alleycats</a></li>
    <li class="level1 nav-leaf"><a href="../motivations.html">Motivations</a></li>
    <li class="level1 nav-leaf"><a href="../resources_for_learners.html">Resources for Learners</a></li>
    <li class="level1 nav-leaf"><a href="../jump_start_guide.html">Jump Start Guide</a></li>
    <li class="level1 nav-leaf"><a href="../imports.html">Imports</a></li>
    <li class="level1 nav-leaf"><a href="../faq.html">FAQ</a></li>
    <li class="level1 nav-leaf"><a href="../CONTRIBUTING.html">Contributor guide</a></li>
    <li class="level1 nav-leaf"><a href="../ADOPTERS.html">Adopters</a></li>
    <li class="level1 nav-leaf"><a href="../colophon.html">Colophon</a></li>
    <li class="level1 nav-leaf"><a href="../nomenclature.html">Glossary</a></li>
    <li class="level1 nav-leaf"><a href="../guidelines.html">Guidelines</a></li>
    <li class="level1 nav-leaf"><a href="../typelevelEcosystem.html">Typelevel Ecosystem</a></li>
    <li class="level1 nav-header">Type Classes</li>
    <li class="level2 nav-leaf"><a href="../typeclasses/alternative.html">Alternative</a></li>
    <li class="level2 nav-leaf"><a href="../typeclasses/applicative.html">Applicative</a></li>
    <li class="level2 nav-leaf"><a href="../typeclasses/applicativemonaderror.html">ApplicativeError and MonadError</a></li>
    <li class="level2 nav-leaf"><a href="../typeclasses/applicativetraverse.html">Applicative and Traversable Functors</a></li>
    <li class="level2 nav-leaf"><a href="../typeclasses/arrow.html">Arrow</a></li>
    <li class="level2 nav-leaf"><a href="../typeclasses/arrowchoice.html">Arrow Choice</a></li>
    <li class="level2 nav-leaf"><a href="../typeclasses/bifoldable.html">Bifoldable</a></li>
    <li class="level2 nav-leaf"><a href="../typeclasses/bifunctor.html">Bifunctor</a></li>
    <li class="level2 nav-leaf"><a href="../typeclasses/bimonad.html">Bimonad</a></li>
    <li class="level2 nav-leaf"><a href="../typeclasses/comonad.html">Comonad</a></li>
    <li class="level2 nav-leaf"><a href="../typeclasses/contravariant.html">Contravariant</a></li>
    <li class="level2 nav-leaf"><a href="../typeclasses/contravariantmonoidal.html">Contravariant Monoidal</a></li>
    <li class="level2 nav-leaf"><a href="../typeclasses/eq.html">Eq</a></li>
    <li class="level2 nav-leaf"><a href="../typeclasses/foldable.html">Foldable</a></li>
    <li class="level2 nav-leaf"><a href="../typeclasses/functor.html">Functor</a></li>
    <li class="level2 nav-leaf"><a href="../typeclasses/invariant.html">Invariant</a></li>
    <li class="level2 nav-leaf"><a href="../typeclasses/invariantmonoidal.html">Invariant Monoidal</a></li>
    <li class="level2 nav-leaf"><a href="../typeclasses/lawtesting.html">Law testing</a></li>
    <li class="level2 nav-leaf"><a href="../typeclasses/monad.html">Monad</a></li>
    <li class="level2 nav-leaf"><a href="../typeclasses/monoid.html">Monoid</a></li>
    <li class="level2 nav-leaf"><a href="../typeclasses/monoidk.html">MonoidK</a></li>
    <li class="level2 nav-leaf"><a href="../typeclasses/nonemptytraverse.html">NonEmptyTraverse</a></li>
    <li class="level2 nav-leaf"><a href="../typeclasses/parallel.html">Parallel</a></li>
    <li class="level2 nav-leaf"><a href="../typeclasses/reducible.html">Reducible</a></li>
    <li class="level2 nav-leaf"><a href="../typeclasses/semigroup.html">Semigroup</a></li>
    <li class="level2 nav-leaf"><a href="../typeclasses/semigroupk.html">SemigroupK</a></li>
    <li class="level2 nav-leaf"><a href="../typeclasses/show.html">Show</a></li>
    <li class="level2 nav-leaf"><a href="../typeclasses/traverse.html">Traverse</a></li>
    <li class="level1 nav-header">Data Types</li>
    <li class="level2 nav-leaf"><a href="chain.html">Chain</a></li>
    <li class="level2 nav-leaf"><a href="const.html">Const</a></li>
    <li class="level2 nav-leaf"><a href="contt.html">ContT</a></li>
    <li class="level2 nav-leaf"><a href="eithert.html">EitherT</a></li>
    <li class="level2 nav-leaf"><a href="eval.html">Eval</a></li>
    <li class="level2 active nav-leaf"><a href="#">Free Applicative</a></li>
    <li class="level2 nav-leaf"><a href="freemonad.html">Free Monad</a></li>
    <li class="level2 nav-leaf"><a href="functionk.html">FunctionK</a></li>
    <li class="level2 nav-leaf"><a href="id.html">Id</a></li>
    <li class="level2 nav-leaf"><a href="ior.html">Ior</a></li>
    <li class="level2 nav-leaf"><a href="iort.html">IorT</a></li>
    <li class="level2 nav-leaf"><a href="kleisli.html">Kleisli</a></li>
    <li class="level2 nav-leaf"><a href="nel.html">NonEmptyList</a></li>
    <li class="level2 nav-leaf"><a href="nested.html">Nested</a></li>
    <li class="level2 nav-leaf"><a href="oneand.html">OneAnd</a></li>
    <li class="level2 nav-leaf"><a href="optiont.html">OptionT</a></li>
    <li class="level2 nav-leaf"><a href="state.html">State</a></li>
    <li class="level2 nav-leaf"><a href="statet.html">StateT</a></li>
    <li class="level2 nav-leaf"><a href="validated.html">Validated</a></li>
    <li class="level2 nav-leaf"><a href="writer.html">Writer</a></li>
    <li class="level2 nav-leaf"><a href="writert.html">WriterT</a></li>
  </ul>

</nav>

    <div id="container">

      
<nav id="page-nav">
  <p class="header"><a href="#">Free Applicative</a></p>

  <ul class="nav-list">
    <li class="level1 nav-leaf"><a href="#dependency">Dependency</a></li>
    <li class="level1 nav-leaf"><a href="#example">Example</a></li>
    <li class="level1 nav-node"><a href="#differences-from-free">Differences from <code>Free</code></a></li>
    <li class="level2 nav-leaf"><a href="#parallelism">Parallelism</a></li>
    <li class="level2 nav-leaf"><a href="#logging">Logging</a></li>
    <li class="level2 nav-leaf"><a href="#why-not-both">Why not both?</a></li>
    <li class="level2 nav-leaf"><a href="#the-way-freeapplicative-foldmap-works">The way FreeApplicative#foldMap works</a></li>
    <li class="level1 nav-leaf"><a href="#references">References</a></li>
  </ul>

  <p class="footer"></p>
</nav>


      <main class="content">

        <h1 id="free-applicative" class="title">Free Applicative</h1>
        <p>API Documentation: <a class="api" href="https://www.javadoc.io/doc/org.typelevel/cats-docs_2.13/2.12.0/cats/free/FreeApplicative.html">FreeApplicative</a></p>
        <p><code>FreeApplicative</code>s are similar to <code>Free</code> (monads) in that they provide a nice way to represent
        computations as data and are useful for building embedded DSLs (EDSLs). However, they differ
        from <code>Free</code> in that the kinds of operations they support are limited, much like the distinction
        between <code>Applicative</code> and <code>Monad</code>.</p>
        
        <h2 id="dependency" class="section"><a class="anchor-link left" href="#dependency"><i class="icofont-laika link">&#xef71;</i></a>Dependency</h2>
        <p>If you&#39;d like to use cats&#39; free applicative, you&#39;ll need to add a library dependency
        for the <code>cats-free</code> module.</p>
        
        <h2 id="example" class="section"><a class="anchor-link left" href="#example"><i class="icofont-laika link">&#xef71;</i></a>Example</h2>
        <p>Consider building an EDSL for validating strings - to keep things simple we&#39;ll just have
        a way to check a string is at least a certain size and to ensure the string contains numbers.</p>
        <pre class="keep-together pdf epub"><code class="nohighlight"><span class="keyword">sealed</span><span> </span><span class="keyword">abstract</span><span> </span><span class="keyword">class</span><span> </span><span class="type-name">ValidationOp</span><span>[</span><span class="type-name">A</span><span>]
</span><span class="keyword">case</span><span> </span><span class="keyword">class</span><span> </span><span class="type-name">Size</span><span>(</span><span class="identifier">size</span><span>: </span><span class="type-name">Int</span><span>) </span><span class="keyword">extends</span><span> </span><span class="type-name">ValidationOp</span><span>[</span><span class="type-name">Boolean</span><span>]
</span><span class="keyword">case</span><span> </span><span class="keyword">object</span><span> </span><span class="type-name">HasNumber</span><span> </span><span class="keyword">extends</span><span> </span><span class="type-name">ValidationOp</span><span>[</span><span class="type-name">Boolean</span><span>]</span></code></pre>
        <p>Much like the <code>Free</code> monad tutorial, we use smart constructors to lift our algebra into the <code>FreeApplicative</code>.</p>
        <pre class="keep-together pdf epub"><code class="nohighlight"><span class="keyword">import</span><span> </span><span class="identifier">cats</span><span>.</span><span class="identifier">free</span><span>.</span><span class="type-name">FreeApplicative</span><span>
</span><span class="keyword">import</span><span> </span><span class="identifier">cats</span><span>.</span><span class="identifier">free</span><span>.</span><span class="type-name">FreeApplicative</span><span>.</span><span class="identifier">lift</span><span>

</span><span class="keyword">type</span><span> </span><span class="type-name">Validation</span><span>[</span><span class="type-name">A</span><span>] = </span><span class="type-name">FreeApplicative</span><span>[</span><span class="type-name">ValidationOp</span><span>, </span><span class="type-name">A</span><span>]

</span><span class="keyword">def</span><span> </span><span class="declaration-name">size</span><span>(</span><span class="identifier">size</span><span>: </span><span class="type-name">Int</span><span>): </span><span class="type-name">Validation</span><span>[</span><span class="type-name">Boolean</span><span>] = </span><span class="identifier">lift</span><span>(</span><span class="type-name">Size</span><span>(</span><span class="identifier">size</span><span>))

</span><span class="keyword">val</span><span> </span><span class="identifier">hasNumber</span><span>: </span><span class="type-name">Validation</span><span>[</span><span class="type-name">Boolean</span><span>] = </span><span class="identifier">lift</span><span>(</span><span class="type-name">HasNumber</span><span>)</span></code></pre>
        <p>Because a <code>FreeApplicative</code> only supports the operations of <code>Applicative</code>, we do not get the nicety
        of a for-comprehension. We can however still use <code>Applicative</code> syntax provided by Cats.</p>
        <pre class="keep-together pdf epub"><code class="nohighlight"><span class="keyword">import</span><span> </span><span class="identifier">cats</span><span>.</span><span class="identifier">syntax</span><span>.</span><span class="identifier">all</span><span>.</span><span class="identifier">_</span><span>

</span><span class="keyword">val</span><span> </span><span class="identifier">prog</span><span>: </span><span class="type-name">Validation</span><span>[</span><span class="type-name">Boolean</span><span>] = (</span><span class="identifier">size</span><span>(</span><span class="number-literal">5</span><span>), </span><span class="identifier">hasNumber</span><span>).</span><span class="identifier">mapN</span><span> { </span><span class="keyword">case</span><span> (</span><span class="identifier">l</span><span>, </span><span class="identifier">r</span><span>) =&gt; </span><span class="identifier">l</span><span> &amp;&amp; </span><span class="identifier">r</span><span>}</span></code></pre>
        <p>As it stands, our program is just an instance of a data structure - nothing has happened
        at this point. To make our program useful we need to interpret it.</p>
        <pre><code class="nohighlight"><span class="keyword">import</span><span> </span><span class="identifier">cats</span><span>.</span><span class="type-name">Id</span><span>
</span><span class="keyword">import</span><span> </span><span class="identifier">cats</span><span>.</span><span class="identifier">arrow</span><span>.</span><span class="type-name">FunctionK</span><span>
</span><span class="keyword">import</span><span> </span><span class="identifier">cats</span><span>.</span><span class="identifier">syntax</span><span>.</span><span class="identifier">all</span><span>.</span><span class="identifier">_</span><span>

</span><span class="comment">// a function that takes a string as input
</span><span class="keyword">type</span><span> </span><span class="type-name">FromString</span><span>[</span><span class="type-name">A</span><span>] = </span><span class="type-name">String</span><span> =&gt; </span><span class="type-name">A</span><span>

</span><span class="keyword">val</span><span> </span><span class="identifier">compiler</span><span> = </span><span class="keyword">new</span><span> </span><span class="type-name">FunctionK</span><span>[</span><span class="type-name">ValidationOp</span><span>, </span><span class="type-name">FromString</span><span>] {
  </span><span class="keyword">def</span><span> </span><span class="declaration-name">apply</span><span>[</span><span class="type-name">A</span><span>](</span><span class="identifier">fa</span><span>: </span><span class="type-name">ValidationOp</span><span>[</span><span class="type-name">A</span><span>]): </span><span class="type-name">FromString</span><span>[</span><span class="type-name">A</span><span>] = </span><span class="identifier">str</span><span> =&gt;
    </span><span class="identifier">fa</span><span> </span><span class="keyword">match</span><span> {
      </span><span class="keyword">case</span><span> </span><span class="type-name">Size</span><span>(</span><span class="identifier">size</span><span>) =&gt; </span><span class="identifier">str</span><span>.</span><span class="identifier">size</span><span> &gt;= </span><span class="identifier">size</span><span>
      </span><span class="keyword">case</span><span> </span><span class="type-name">HasNumber</span><span>  =&gt; </span><span class="identifier">str</span><span>.</span><span class="identifier">exists</span><span>(</span><span class="identifier">c</span><span> =&gt; </span><span class="string-literal">&quot;0123456789&quot;</span><span>.</span><span class="identifier">contains</span><span>(</span><span class="identifier">c</span><span>))
    }
}</span></code></pre>
        <pre class="keep-together pdf epub"><code class="nohighlight"><span class="keyword">val</span><span> </span><span class="identifier">validator</span><span> = </span><span class="identifier">prog</span><span>.</span><span class="identifier">foldMap</span><span>[</span><span class="type-name">FromString</span><span>](</span><span class="identifier">compiler</span><span>)
</span><span class="comment">// validator: FromString[Boolean] = cats.instances.Function1Instances$$anon$7$$Lambda$14489/0x00007f3228702598@8363f82
</span><span class="identifier">validator</span><span>(</span><span class="string-literal">&quot;1234&quot;</span><span>)
</span><span class="comment">// res0: Boolean = false
</span><span class="identifier">validator</span><span>(</span><span class="string-literal">&quot;12345&quot;</span><span>)
</span><span class="comment">// res1: Boolean = true</span></code></pre>
        
        <h2 id="differences-from-free" class="section"><a class="anchor-link left" href="#differences-from-free"><i class="icofont-laika link">&#xef71;</i></a>Differences from <code>Free</code></h2>
        <p>So far everything we&#39;ve been doing has been not much different from <code>Free</code> - we&#39;ve built
        an algebra and interpreted it. However, there are some things <code>FreeApplicative</code> can do that
        <code>Free</code> cannot.</p>
        <p>Recall a key distinction between the type classes <code>Applicative</code> and <code>Monad</code> - <code>Applicative</code>
        captures the idea of independent computations, whereas <code>Monad</code> captures that of dependent
        computations. Put differently <code>Applicative</code>s cannot branch based on the value of an existing/prior
        computation. Therefore when using <code>Applicative</code>s, we must hand in all our data in one go.</p>
        <p>In the context of <code>FreeApplicative</code>s, we can leverage this static knowledge in our interpreter.</p>
        
        <h3 id="parallelism" class="section"><a class="anchor-link left" href="#parallelism"><i class="icofont-laika link">&#xef71;</i></a>Parallelism</h3>
        <p>Because we have everything we need up front and know there can be no branching, we can easily
        write a validator that validates in parallel.</p>
        <pre><code class="nohighlight"><span class="keyword">import</span><span> </span><span class="identifier">cats</span><span>.</span><span class="identifier">data</span><span>.</span><span class="type-name">Kleisli</span><span>
</span><span class="keyword">import</span><span> </span><span class="identifier">cats</span><span>.</span><span class="identifier">syntax</span><span>.</span><span class="identifier">all</span><span>.</span><span class="identifier">_</span><span>
</span><span class="keyword">import</span><span> </span><span class="identifier">scala</span><span>.</span><span class="identifier">concurrent</span><span>.</span><span class="type-name">Future</span><span>
</span><span class="keyword">import</span><span> </span><span class="identifier">scala</span><span>.</span><span class="identifier">concurrent</span><span>.</span><span class="type-name">ExecutionContext</span><span>.</span><span class="type-name">Implicits</span><span>.</span><span class="identifier">global</span><span>

</span><span class="comment">// recall Kleisli[Future, String, A] is the same as String =&gt; Future[A]
</span><span class="keyword">type</span><span> </span><span class="type-name">ParValidator</span><span>[</span><span class="type-name">A</span><span>] = </span><span class="type-name">Kleisli</span><span>[</span><span class="type-name">Future</span><span>, </span><span class="type-name">String</span><span>, </span><span class="type-name">A</span><span>]

</span><span class="keyword">val</span><span> </span><span class="identifier">parCompiler</span><span> = </span><span class="keyword">new</span><span> </span><span class="type-name">FunctionK</span><span>[</span><span class="type-name">ValidationOp</span><span>, </span><span class="type-name">ParValidator</span><span>] {
  </span><span class="keyword">def</span><span> </span><span class="declaration-name">apply</span><span>[</span><span class="type-name">A</span><span>](</span><span class="identifier">fa</span><span>: </span><span class="type-name">ValidationOp</span><span>[</span><span class="type-name">A</span><span>]): </span><span class="type-name">ParValidator</span><span>[</span><span class="type-name">A</span><span>] = </span><span class="type-name">Kleisli</span><span> { </span><span class="identifier">str</span><span> =&gt;
    </span><span class="identifier">fa</span><span> </span><span class="keyword">match</span><span> {
      </span><span class="keyword">case</span><span> </span><span class="type-name">Size</span><span>(</span><span class="identifier">size</span><span>) =&gt; </span><span class="type-name">Future</span><span> { </span><span class="identifier">str</span><span>.</span><span class="identifier">size</span><span> &gt;= </span><span class="identifier">size</span><span> }
      </span><span class="keyword">case</span><span> </span><span class="type-name">HasNumber</span><span> =&gt; </span><span class="type-name">Future</span><span> { </span><span class="identifier">str</span><span>.</span><span class="identifier">exists</span><span>(</span><span class="identifier">c</span><span> =&gt; </span><span class="string-literal">&quot;0123456789&quot;</span><span>.</span><span class="identifier">contains</span><span>(</span><span class="identifier">c</span><span>)) }
    }
  }
}

</span><span class="keyword">val</span><span> </span><span class="identifier">parValidator</span><span> = </span><span class="identifier">prog</span><span>.</span><span class="identifier">foldMap</span><span>[</span><span class="type-name">ParValidator</span><span>](</span><span class="identifier">parCompiler</span><span>)</span></code></pre>
        
        <h3 id="logging" class="section"><a class="anchor-link left" href="#logging"><i class="icofont-laika link">&#xef71;</i></a>Logging</h3>
        <p>We can also write an interpreter that simply creates a list of strings indicating the filters that
        have been used - this could be useful for logging purposes. Note that we need not actually evaluate
        the rules against a string for this, we simply need to map each rule to some identifier. Therefore
        we can completely ignore the return type of the operation and return just a <code>List[String]</code> - the
        <code>Const</code> data type is useful for this.</p>
        <pre><code class="nohighlight"><span class="keyword">import</span><span> </span><span class="identifier">cats</span><span>.</span><span class="identifier">data</span><span>.</span><span class="type-name">Const</span><span>
</span><span class="keyword">import</span><span> </span><span class="identifier">cats</span><span>.</span><span class="identifier">syntax</span><span>.</span><span class="identifier">all</span><span>.</span><span class="identifier">_</span><span>

</span><span class="keyword">type</span><span> </span><span class="type-name">Log</span><span>[</span><span class="type-name">A</span><span>] = </span><span class="type-name">Const</span><span>[</span><span class="type-name">List</span><span>[</span><span class="type-name">String</span><span>], </span><span class="type-name">A</span><span>]

</span><span class="keyword">val</span><span> </span><span class="identifier">logCompiler</span><span> = </span><span class="keyword">new</span><span> </span><span class="type-name">FunctionK</span><span>[</span><span class="type-name">ValidationOp</span><span>, </span><span class="type-name">Log</span><span>] {
  </span><span class="keyword">def</span><span> </span><span class="declaration-name">apply</span><span>[</span><span class="type-name">A</span><span>](</span><span class="identifier">fa</span><span>: </span><span class="type-name">ValidationOp</span><span>[</span><span class="type-name">A</span><span>]): </span><span class="type-name">Log</span><span>[</span><span class="type-name">A</span><span>] = </span><span class="identifier">fa</span><span> </span><span class="keyword">match</span><span> {
    </span><span class="keyword">case</span><span> </span><span class="type-name">Size</span><span>(</span><span class="identifier">size</span><span>) =&gt; </span><span class="type-name">Const</span><span>(</span><span class="type-name">List</span><span>(</span><span class="string-literal">s&quot;size &gt;= </span><span class="substitution">$size</span><span class="string-literal">&quot;</span><span>))
    </span><span class="keyword">case</span><span> </span><span class="type-name">HasNumber</span><span> =&gt; </span><span class="type-name">Const</span><span>(</span><span class="type-name">List</span><span>(</span><span class="string-literal">&quot;has number&quot;</span><span>))
  }
}

</span><span class="keyword">def</span><span> </span><span class="declaration-name">logValidation</span><span>[</span><span class="type-name">A</span><span>](</span><span class="identifier">validation</span><span>: </span><span class="type-name">Validation</span><span>[</span><span class="type-name">A</span><span>]): </span><span class="type-name">List</span><span>[</span><span class="type-name">String</span><span>] =
  </span><span class="identifier">validation</span><span>.</span><span class="identifier">foldMap</span><span>[</span><span class="type-name">Log</span><span>](</span><span class="identifier">logCompiler</span><span>).</span><span class="identifier">getConst</span></code></pre>
        <pre class="keep-together pdf epub"><code class="nohighlight"><span class="identifier">logValidation</span><span>(</span><span class="identifier">prog</span><span>)
</span><span class="comment">// res2: List[String] = List(&quot;size &gt;= 5&quot;, &quot;has number&quot;)
</span><span class="identifier">logValidation</span><span>(</span><span class="identifier">size</span><span>(</span><span class="number-literal">5</span><span>) *&gt; </span><span class="identifier">hasNumber</span><span> *&gt; </span><span class="identifier">size</span><span>(</span><span class="number-literal">10</span><span>))
</span><span class="comment">// res3: List[String] = List(&quot;size &gt;= 5&quot;, &quot;has number&quot;, &quot;size &gt;= 10&quot;)
</span><span class="identifier">logValidation</span><span>((</span><span class="identifier">hasNumber</span><span>, </span><span class="identifier">size</span><span>(</span><span class="number-literal">3</span><span>)).</span><span class="identifier">mapN</span><span>(</span><span class="identifier">_</span><span> || </span><span class="identifier">_</span><span>))
</span><span class="comment">// res4: List[String] = List(&quot;has number&quot;, &quot;size &gt;= 3&quot;)</span></code></pre>
        
        <h3 id="why-not-both" class="section"><a class="anchor-link left" href="#why-not-both"><i class="icofont-laika link">&#xef71;</i></a>Why not both?</h3>
        <p>It is perhaps more plausible and useful to have both the actual validation function and the logging
        strings. While we could easily compile our program twice, once for each interpreter as we have above,
        we could also do it in one go - this would avoid multiple traversals of the same structure.</p>
        <p>Another useful property <code>Applicative</code>s have over <code>Monad</code>s is that given two <code>Applicative</code>s <code>F[_]</code> and
        <code>G[_]</code>, their product <code>type FG[A] = (F[A], G[A])</code> is also an <code>Applicative</code>. This is not true in the general
        case for monads.</p>
        <p>Therefore, we can write an interpreter that uses the product of the <code>ParValidator</code> and <code>Log</code> <code>Applicative</code>s
        to interpret our program in one go. We can create this interpreter easily by using <code>FunctionK#and</code>.</p>
        <pre class="keep-together pdf epub"><code class="nohighlight"><span class="keyword">import</span><span> </span><span class="identifier">cats</span><span>.</span><span class="identifier">data</span><span>.</span><span class="type-name">Tuple2K</span><span>

</span><span class="keyword">type</span><span> </span><span class="type-name">ValidateAndLog</span><span>[</span><span class="type-name">A</span><span>] = </span><span class="type-name">Tuple2K</span><span>[</span><span class="type-name">ParValidator</span><span>, </span><span class="type-name">Log</span><span>, </span><span class="type-name">A</span><span>]

</span><span class="keyword">val</span><span> </span><span class="identifier">prodCompiler</span><span>: </span><span class="type-name">FunctionK</span><span>[</span><span class="type-name">ValidationOp</span><span>, </span><span class="type-name">ValidateAndLog</span><span>] = </span><span class="identifier">parCompiler</span><span> </span><span class="identifier">and</span><span> </span><span class="identifier">logCompiler</span><span>

</span><span class="keyword">val</span><span> </span><span class="identifier">prodValidation</span><span> = </span><span class="identifier">prog</span><span>.</span><span class="identifier">foldMap</span><span>[</span><span class="type-name">ValidateAndLog</span><span>](</span><span class="identifier">prodCompiler</span><span>)</span></code></pre>
        
        <h3 id="the-way-freeapplicative-foldmap-works" class="section"><a class="anchor-link left" href="#the-way-freeapplicative-foldmap-works"><i class="icofont-laika link">&#xef71;</i></a>The way FreeApplicative#foldMap works</h3>
        <p>Despite being an imperative loop, there is a functional intuition behind <code>FreeApplicative#foldMap</code>.</p>
        <p>The new <code>FreeApplicative</code>&#39;s <code>foldMap</code> is a sort of mutually-recursive function that operates on an argument stack and a 
        function stack, where the argument stack has type <code>List[FreeApplicative[F, _]]</code> and the functions have type <code>List[Fn[G, _, _]]</code>.
        <code>Fn[G[_, _]]</code> contains a function to be <code>Ap</code>&#39;d that has already been translated to the target <code>Applicative</code>,
        as well as the number of functions that were <code>Ap</code>&#39;d immediately subsequently to it.</p>
        
        <h4 id="main-re-association-loop" class="section"><a class="anchor-link left" href="#main-re-association-loop"><i class="icofont-laika link">&#xef71;</i></a>Main re-association loop</h4>
        <p>Pull an argument out of the stack, eagerly remove right-associated <code>Ap</code> nodes, by looping on the right and 
        adding the <code>Ap</code> nodes&#39; arguments on the left to the argument stack; at the end, pushes a single function to the 
        function stack of the applied functions, the rest of which will be pushed in this loop in later iterations. 
        Once all of the <code>Ap</code> nodes on the right are removed, the loop resets to deal with the ones on the left.</p>
        <p>Here&#39;s an example <code>FreeApplicative</code> value to demonstrate the loop&#39;s function, at the end of every iteration.
        Every node in the tree is annotated with an identifying number and the concrete type of the node
        (A -&gt; <code>Ap</code>, L -&gt; <code>Lift</code>, P -&gt; <code>Pure</code>), and an apostrophe to denote where <code>argF</code> (the current argument) currently
        points; as well the argument and function branches off <code>Ap</code> nodes are explicitly denoted.</p>
        <pre><code>==&gt; begin.
           &#39;1A
           /  \
       arg/    \fun
         /      \
        /        \
       2A        3A
   arg/  \fun arg/  \fun
     /    \     /    \
    4L    5P   6L     7L

args: Nil
functions: Nil
==&gt; loop.

            1A
           /  \
       arg/    \fun
         /      \
        /        \
       2A        &#39;3A
   arg/  \fun arg/  \fun
     /    \     /    \
    4L    5P   6L    7L

args: 2A :: Nil
functions: Nil
==&gt; loop.

            1A
           /  \
       arg/    \fun
         /      \
        /        \
       2A         3A
   arg/  \fun arg/  \fun
     /    \     /    \
    4L    5P   6L   &#39;7L

args: 6L :: 2A :: Nil
functions: Fn(gab = foldArg(7L), argc = 2) :: Nil
==&gt; finished.</code></pre>
        <p>At the end of the loop the entire right branch of <code>Ap</code>s under <code>argF</code> has been peeled off into a single curried function,
        all of the arguments to that function are on the argument stack and that function itself is on the function stack,
        annotated with the amount of arguments it takes.</p>
        
        <h4 id="function-application-loop" class="section"><a class="anchor-link left" href="#function-application-loop"><i class="icofont-laika link">&#xef71;</i></a>Function application loop</h4>
        <p>Once <code>argF</code> isn&#39;t an <code>Ap</code> node, a loop runs which pulls functions from the stack until it reaches a curried function,
        in which case it applies the function to <code>argF</code> transformed into a <code>G[Any]</code> value, and pushes the resulting function
        back to the function stack, before returning to the main loop.</p>
        <p>I&#39;ll continue the example from before here:</p>
        <pre><code>==&gt; loop.
            1A
           /  \
       arg/    \fun
         /      \
        /        \
       2A         3A
   arg/  \fun arg/  \fun
     /    \     /    \
    4L    5P  &#39;6L    7L

args: 2A :: Nil
functions: Fn(gab = foldArg(7L) ap foldArg(6L), argc = 1) :: Nil
==&gt; finished.</code></pre>
        <p>At the end of this loop every function on the top of the function stack with <code>length == 1</code> (not curried)
        has been applied to a single argument from the argument stack, and the first curried function (<code>length != 1</code>)
        on the stack has been applied to a single argument from the argument stack.
        The reason we can&#39;t keep applying the curried function to arguments is that the node on top of the argument
        stack <em>must</em> be an <code>Ap</code> node if the function is curried, so we can&#39;t translate it directly to <code>G[_]</code>.</p>
        <p>Once the last function has been applied to the last argument, the fold has finished and the result is returned.</p>
        
        <h2 id="references" class="section"><a class="anchor-link left" href="#references"><i class="icofont-laika link">&#xef71;</i></a>References</h2>
        <p>Deeper explanations can be found in this paper <a href="http://www.paolocapriotti.com/assets/applicative.pdf">Free Applicative Functors by Paolo Capriotti</a></p>

        
<hr class="footer-rule"/>
<footer>
  cats is a <a href="https://typelevel.org/">Typelevel</a> project distributed under the <a href="https://opensource.org/licenses/MIT">MIT</a> license.
</footer>


      </main>

    </div>

  </body>

</html>