<!DOCTYPE html>
<html lang="en">
  
  <head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="generator" content="Typelevel Laika + Helium Theme" />
  <title>Kleisli</title>
  
  <meta name="author" content="cats contributors"/>
  
  <meta name="author" content="Cody Allen"/>
  
  <meta name="author" content="Ross Baker"/>
  
  <meta name="author" content="Arman Bilge"/>
  
  <meta name="author" content="P. Oscar Boykin"/>
  
  <meta name="author" content="Travis Brown"/>
  
  <meta name="author" content="Adelbert Chang"/>
  
  <meta name="author" content="Daniel Esik"/>
  
  <meta name="author" content="Peter Neyens"/>
  
  <meta name="author" content="Rob Norris"/>
  
  <meta name="author" content="Erik Osheim"/>
  
  <meta name="author" content="LukaJCB"/>
  
  <meta name="author" content="Michael Pilquist"/>
  
  <meta name="author" content="Miles Sabin"/>
  
  <meta name="author" content="Daniel Spiewak"/>
  
  <meta name="author" content="Frank Thomas"/>
  
  <meta name="author" content="Sergey Torgashov"/>
  
  <meta name="author" content="Julien Truffaut"/>
  
  <meta name="author" content="Kailuo Wang"/>
  
  
  <meta name="description" content="docs"/>
  
  
  
  <link rel="icon" sizes="32x32" type="image/png" href="https://typelevel.org/img/favicon.png"/>
  
  
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:400,700">
  
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Fira+Mono:500">
  
  <link rel="stylesheet" type="text/css" href="../helium/site/icofont.min.css" />
    <link rel="stylesheet" type="text/css" href="../helium/site/laika-helium.css" />
  <script src="../helium/site/laika-helium.js"></script>
  
  
  <script> /* for avoiding page load transitions */ </script>
</head>

  <body>

    <header id="top-bar" class="light-default dark-default">

  <div class="row">
    <a id="nav-icon">
      <i class="icofont-laika navigationMenu" title="Navigation">&#xefa2;</i>
    </a>
    
    
  </div>

  <a class="image-link" href="https://typelevel.org"><img src="https://typelevel.org/img/logo.svg"></a>

  <div class="row links">
    
    <a class="icon-link svg-link" href="https://www.javadoc.io/doc/org.typelevel/cats-docs_2.13/2.13.0/"><span class="api" title="API"><svg class="svg-icon" width="100%" height="100%" viewBox="0 0 100 100" version="1.1" xmlns="http://www.w3.org/2000/svg" xml:space="preserve" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:2;">
  <g class="svg-shape">
    <path d="M75,47.5c13.246,0 24,10.754 24,24c0,13.246 -10.754,24 -24,24c-13.246,0 -24,-10.754 -24,-24c0,-13.246 10.754,-24 24,-24Zm-50,-0c13.246,-0 24,10.754 24,24c0,13.246 -10.754,24 -24,24c-13.246,-0 -24,-10.754 -24,-24c0,-13.246 10.754,-24 24,-24Zm2.705,16.735l7.239,0l0.622,-4.904l-21.833,0l-0,4.904l7.589,0l0,22.067l6.383,0l-0,-22.067Zm58.076,7.265c-0,-8.757 -3.698,-14.166 -10.781,-14.166c-7.083,-0 -10.781,5.604 -10.781,14.166c0,8.757 3.698,14.166 10.781,14.166c7.083,0 10.781,-5.604 10.781,-14.166Zm-6.539,0c0,6.538 -1.128,9.496 -4.242,9.496c-2.997,0 -4.242,-2.88 -4.242,-9.496c-0,-6.616 1.206,-9.496 4.242,-9.496c3.036,-0 4.242,2.88 4.242,9.496Zm-29.242,-67c13.246,0 24,10.754 24,24c0,13.246 -10.754,24 -24,24c-13.246,0 -24,-10.754 -24,-24c0,-13.246 10.754,-24 24,-24Zm0.512,9.834c-7.122,-0 -12.609,5.098 -12.609,14.127c-0,9.263 5.215,14.205 12.532,14.205c4.164,0 7.083,-1.634 9.068,-3.658l-2.88,-3.697c-1.518,1.206 -3.153,2.413 -5.838,2.413c-3.697,-0 -6.266,-2.763 -6.266,-9.263c-0,-6.616 2.724,-9.379 6.149,-9.379c2.102,-0 3.892,0.778 5.371,1.984l3.113,-3.775c-2.257,-1.868 -4.748,-2.957 -8.64,-2.957Z"/>
  </g>
</svg></span></a>
    
    <a class="icon-link svg-link" href="https://github.com/typelevel/cats"><span class="github" title="Source Code"><svg class="svg-icon" width="100%" height="100%" viewBox="0 0 100 100" version="1.1" xmlns="http://www.w3.org/2000/svg" xml:space="preserve" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:2;">
  <g class="svg-shape">
    <path d="M49.995,1c-27.609,-0 -49.995,22.386 -49.995,50.002c-0,22.09 14.325,40.83 34.194,47.444c2.501,0.458 3.413,-1.086 3.413,-2.412c0,-1.185 -0.043,-4.331 -0.067,-8.503c-13.908,3.021 -16.843,-6.704 -16.843,-6.704c-2.274,-5.773 -5.552,-7.311 -5.552,-7.311c-4.54,-3.103 0.344,-3.042 0.344,-3.042c5.018,0.356 7.658,5.154 7.658,5.154c4.46,7.64 11.704,5.433 14.552,4.156c0.454,-3.232 1.744,-5.436 3.174,-6.685c-11.102,-1.262 -22.775,-5.553 -22.775,-24.713c-0,-5.457 1.949,-9.92 5.147,-13.416c-0.516,-1.265 -2.231,-6.348 0.488,-13.233c0,0 4.199,-1.344 13.751,5.126c3.988,-1.108 8.266,-1.663 12.518,-1.682c4.245,0.019 8.523,0.574 12.517,1.682c9.546,-6.47 13.736,-5.126 13.736,-5.126c2.728,6.885 1.013,11.968 0.497,13.233c3.204,3.496 5.141,7.959 5.141,13.416c0,19.209 -11.691,23.436 -22.83,24.673c1.795,1.544 3.394,4.595 3.394,9.26c0,6.682 -0.061,12.076 -0.061,13.715c0,1.338 0.899,2.894 3.438,2.406c19.853,-6.627 34.166,-25.354 34.166,-47.438c-0,-27.616 -22.389,-50.002 -50.005,-50.002"/>
  </g>
</svg></span></a>
    
    <a class="icon-link glyph-link" href="https://discord.gg/XF3CXcMzqD"><i class="icofont-laika chat" title="Chat">&#xeed5;</i></a>
    
    <a class="icon-link svg-link" href="https://fosstodon.org/@typelevel"><span class="mastodon" title="Mastodon"><svg class="svg-icon" width="100%" height="100%" viewBox="0 0 16 16" version="1.1" xmlns="http://www.w3.org/2000/svg">
  <g class="svg-shape">
    <path d="M11.19 12.195c2.016-.24 3.77-1.475 3.99-2.603.348-1.778.32-4.339.32-4.339 0-3.47-2.286-4.488-2.286-4.488C12.062.238 10.083.017 8.027 0h-.05C5.92.017 3.942.238 2.79.765c0 0-2.285 1.017-2.285 4.488l-.002.662c-.004.64-.007 1.35.011 2.091.083 3.394.626 6.74 3.78 7.57 1.454.383 2.703.463 3.709.408 1.823-.1 2.847-.647 2.847-.647l-.06-1.317s-1.303.41-2.767.36c-1.45-.05-2.98-.156-3.215-1.928a3.614 3.614 0 0 1-.033-.496s1.424.346 3.228.428c1.103.05 2.137-.064 3.188-.189zm1.613-2.47H11.13v-4.08c0-.859-.364-1.295-1.091-1.295-.804 0-1.207.517-1.207 1.541v2.233H7.168V5.89c0-1.024-.403-1.541-1.207-1.541-.727 0-1.091.436-1.091 1.296v4.079H3.197V5.522c0-.859.22-1.541.66-2.046.456-.505 1.052-.764 1.793-.764.856 0 1.504.328 1.933.983L8 4.39l.417-.695c.429-.655 1.077-.983 1.934-.983.74 0 1.336.259 1.791.764.442.505.661 1.187.661 2.046v4.203z"/>
  </g>
</svg></span></a>
    
  </div>  

</header>
    
    <nav id="sidebar">

  <div class="row">
    
    <a class="icon-link svg-link" href="https://www.javadoc.io/doc/org.typelevel/cats-docs_2.13/2.13.0/"><span class="api" title="API"><svg class="svg-icon" width="100%" height="100%" viewBox="0 0 100 100" version="1.1" xmlns="http://www.w3.org/2000/svg" xml:space="preserve" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:2;">
  <g class="svg-shape">
    <path d="M75,47.5c13.246,0 24,10.754 24,24c0,13.246 -10.754,24 -24,24c-13.246,0 -24,-10.754 -24,-24c0,-13.246 10.754,-24 24,-24Zm-50,-0c13.246,-0 24,10.754 24,24c0,13.246 -10.754,24 -24,24c-13.246,-0 -24,-10.754 -24,-24c0,-13.246 10.754,-24 24,-24Zm2.705,16.735l7.239,0l0.622,-4.904l-21.833,0l-0,4.904l7.589,0l0,22.067l6.383,0l-0,-22.067Zm58.076,7.265c-0,-8.757 -3.698,-14.166 -10.781,-14.166c-7.083,-0 -10.781,5.604 -10.781,14.166c0,8.757 3.698,14.166 10.781,14.166c7.083,0 10.781,-5.604 10.781,-14.166Zm-6.539,0c0,6.538 -1.128,9.496 -4.242,9.496c-2.997,0 -4.242,-2.88 -4.242,-9.496c-0,-6.616 1.206,-9.496 4.242,-9.496c3.036,-0 4.242,2.88 4.242,9.496Zm-29.242,-67c13.246,0 24,10.754 24,24c0,13.246 -10.754,24 -24,24c-13.246,0 -24,-10.754 -24,-24c0,-13.246 10.754,-24 24,-24Zm0.512,9.834c-7.122,-0 -12.609,5.098 -12.609,14.127c-0,9.263 5.215,14.205 12.532,14.205c4.164,0 7.083,-1.634 9.068,-3.658l-2.88,-3.697c-1.518,1.206 -3.153,2.413 -5.838,2.413c-3.697,-0 -6.266,-2.763 -6.266,-9.263c-0,-6.616 2.724,-9.379 6.149,-9.379c2.102,-0 3.892,0.778 5.371,1.984l3.113,-3.775c-2.257,-1.868 -4.748,-2.957 -8.64,-2.957Z"/>
  </g>
</svg></span></a>
    
    <a class="icon-link svg-link" href="https://github.com/typelevel/cats"><span class="github" title="Source Code"><svg class="svg-icon" width="100%" height="100%" viewBox="0 0 100 100" version="1.1" xmlns="http://www.w3.org/2000/svg" xml:space="preserve" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:2;">
  <g class="svg-shape">
    <path d="M49.995,1c-27.609,-0 -49.995,22.386 -49.995,50.002c-0,22.09 14.325,40.83 34.194,47.444c2.501,0.458 3.413,-1.086 3.413,-2.412c0,-1.185 -0.043,-4.331 -0.067,-8.503c-13.908,3.021 -16.843,-6.704 -16.843,-6.704c-2.274,-5.773 -5.552,-7.311 -5.552,-7.311c-4.54,-3.103 0.344,-3.042 0.344,-3.042c5.018,0.356 7.658,5.154 7.658,5.154c4.46,7.64 11.704,5.433 14.552,4.156c0.454,-3.232 1.744,-5.436 3.174,-6.685c-11.102,-1.262 -22.775,-5.553 -22.775,-24.713c-0,-5.457 1.949,-9.92 5.147,-13.416c-0.516,-1.265 -2.231,-6.348 0.488,-13.233c0,0 4.199,-1.344 13.751,5.126c3.988,-1.108 8.266,-1.663 12.518,-1.682c4.245,0.019 8.523,0.574 12.517,1.682c9.546,-6.47 13.736,-5.126 13.736,-5.126c2.728,6.885 1.013,11.968 0.497,13.233c3.204,3.496 5.141,7.959 5.141,13.416c0,19.209 -11.691,23.436 -22.83,24.673c1.795,1.544 3.394,4.595 3.394,9.26c0,6.682 -0.061,12.076 -0.061,13.715c0,1.338 0.899,2.894 3.438,2.406c19.853,-6.627 34.166,-25.354 34.166,-47.438c-0,-27.616 -22.389,-50.002 -50.005,-50.002"/>
  </g>
</svg></span></a>
    
    <a class="icon-link glyph-link" href="https://discord.gg/XF3CXcMzqD"><i class="icofont-laika chat" title="Chat">&#xeed5;</i></a>
    
    <a class="icon-link svg-link" href="https://fosstodon.org/@typelevel"><span class="mastodon" title="Mastodon"><svg class="svg-icon" width="100%" height="100%" viewBox="0 0 16 16" version="1.1" xmlns="http://www.w3.org/2000/svg">
  <g class="svg-shape">
    <path d="M11.19 12.195c2.016-.24 3.77-1.475 3.99-2.603.348-1.778.32-4.339.32-4.339 0-3.47-2.286-4.488-2.286-4.488C12.062.238 10.083.017 8.027 0h-.05C5.92.017 3.942.238 2.79.765c0 0-2.285 1.017-2.285 4.488l-.002.662c-.004.64-.007 1.35.011 2.091.083 3.394.626 6.74 3.78 7.57 1.454.383 2.703.463 3.709.408 1.823-.1 2.847-.647 2.847-.647l-.06-1.317s-1.303.41-2.767.36c-1.45-.05-2.98-.156-3.215-1.928a3.614 3.614 0 0 1-.033-.496s1.424.346 3.228.428c1.103.05 2.137-.064 3.188-.189zm1.613-2.47H11.13v-4.08c0-.859-.364-1.295-1.091-1.295-.804 0-1.207.517-1.207 1.541v2.233H7.168V5.89c0-1.024-.403-1.541-1.207-1.541-.727 0-1.091.436-1.091 1.296v4.079H3.197V5.522c0-.859.22-1.541.66-2.046.456-.505 1.052-.764 1.793-.764.856 0 1.504.328 1.933.983L8 4.39l.417-.695c.429-.655 1.077-.983 1.934-.983.74 0 1.336.259 1.791.764.442.505.661 1.187.661 2.046v4.203z"/>
  </g>
</svg></span></a>
    
  </div>

  <ul class="nav-list">
    <li class="level1 nav-leaf"><a href="../">Cats</a></li>
    <li class="level1 nav-leaf"><a href="../typeclasses.html">Type Classes</a></li>
    <li class="level1 nav-leaf"><a href="../datatypes.html">Data Types</a></li>
    <li class="level1 nav-leaf"><a href="../algebra.html">Algebra</a></li>
    <li class="level1 nav-leaf"><a href="../alleycats.html">Alleycats</a></li>
    <li class="level1 nav-leaf"><a href="../motivations.html">Motivations</a></li>
    <li class="level1 nav-leaf"><a href="../resources_for_learners.html">Resources for Learners</a></li>
    <li class="level1 nav-leaf"><a href="../jump_start_guide.html">Jump Start Guide</a></li>
    <li class="level1 nav-leaf"><a href="../imports.html">Imports</a></li>
    <li class="level1 nav-leaf"><a href="../faq.html">FAQ</a></li>
    <li class="level1 nav-leaf"><a href="../CONTRIBUTING.html">Contributor Guide</a></li>
    <li class="level1 nav-leaf"><a href="../ADOPTERS.html">Adopters</a></li>
    <li class="level1 nav-leaf"><a href="../colophon.html">Colophon</a></li>
    <li class="level1 nav-leaf"><a href="../nomenclature.html">Glossary</a></li>
    <li class="level1 nav-leaf"><a href="../guidelines.html">Guidelines</a></li>
    <li class="level1 nav-leaf"><a href="../typelevelEcosystem.html">Typelevel Ecosystem</a></li>
    <li class="level1 nav-header">Type Classes</li>
    <li class="level2 nav-leaf"><a href="../typeclasses/alternative.html">Alternative</a></li>
    <li class="level2 nav-leaf"><a href="../typeclasses/applicative.html">Applicative</a></li>
    <li class="level2 nav-leaf"><a href="../typeclasses/applicativemonaderror.html">ApplicativeError and MonadError</a></li>
    <li class="level2 nav-leaf"><a href="../typeclasses/applicativetraverse.html">Applicative and Traversable Functors</a></li>
    <li class="level2 nav-leaf"><a href="../typeclasses/arrow.html">Arrow</a></li>
    <li class="level2 nav-leaf"><a href="../typeclasses/arrowchoice.html">Arrow Choice</a></li>
    <li class="level2 nav-leaf"><a href="../typeclasses/bifoldable.html">Bifoldable</a></li>
    <li class="level2 nav-leaf"><a href="../typeclasses/bifunctor.html">Bifunctor</a></li>
    <li class="level2 nav-leaf"><a href="../typeclasses/bimonad.html">Bimonad</a></li>
    <li class="level2 nav-leaf"><a href="../typeclasses/comonad.html">Comonad</a></li>
    <li class="level2 nav-leaf"><a href="../typeclasses/contravariant.html">Contravariant</a></li>
    <li class="level2 nav-leaf"><a href="../typeclasses/contravariantmonoidal.html">Contravariant Monoidal</a></li>
    <li class="level2 nav-leaf"><a href="../typeclasses/eq.html">Eq</a></li>
    <li class="level2 nav-leaf"><a href="../typeclasses/foldable.html">Foldable</a></li>
    <li class="level2 nav-leaf"><a href="../typeclasses/functor.html">Functor</a></li>
    <li class="level2 nav-leaf"><a href="../typeclasses/invariant.html">Invariant</a></li>
    <li class="level2 nav-leaf"><a href="../typeclasses/invariantmonoidal.html">Invariant Monoidal</a></li>
    <li class="level2 nav-leaf"><a href="../typeclasses/lawtesting.html">Law testing</a></li>
    <li class="level2 nav-leaf"><a href="../typeclasses/monad.html">Monad</a></li>
    <li class="level2 nav-leaf"><a href="../typeclasses/monoid.html">Monoid</a></li>
    <li class="level2 nav-leaf"><a href="../typeclasses/monoidk.html">MonoidK</a></li>
    <li class="level2 nav-leaf"><a href="../typeclasses/nonemptytraverse.html">NonEmptyTraverse</a></li>
    <li class="level2 nav-leaf"><a href="../typeclasses/parallel.html">Parallel</a></li>
    <li class="level2 nav-leaf"><a href="../typeclasses/reducible.html">Reducible</a></li>
    <li class="level2 nav-leaf"><a href="../typeclasses/semigroup.html">Semigroup</a></li>
    <li class="level2 nav-leaf"><a href="../typeclasses/semigroupk.html">SemigroupK</a></li>
    <li class="level2 nav-leaf"><a href="../typeclasses/show.html">Show</a></li>
    <li class="level2 nav-leaf"><a href="../typeclasses/traverse.html">Traverse</a></li>
    <li class="level1 nav-header">Data Types</li>
    <li class="level2 nav-leaf"><a href="chain.html">Chain</a></li>
    <li class="level2 nav-leaf"><a href="const.html">Const</a></li>
    <li class="level2 nav-leaf"><a href="contt.html">ContT</a></li>
    <li class="level2 nav-leaf"><a href="eithert.html">EitherT</a></li>
    <li class="level2 nav-leaf"><a href="eval.html">Eval</a></li>
    <li class="level2 nav-leaf"><a href="freeapplicative.html">Free Applicative</a></li>
    <li class="level2 nav-leaf"><a href="freemonad.html">Free Monad</a></li>
    <li class="level2 nav-leaf"><a href="functionk.html">FunctionK</a></li>
    <li class="level2 nav-leaf"><a href="id.html">Id</a></li>
    <li class="level2 nav-leaf"><a href="ior.html">Ior</a></li>
    <li class="level2 nav-leaf"><a href="iort.html">IorT</a></li>
    <li class="level2 active nav-leaf"><a href="#">Kleisli</a></li>
    <li class="level2 nav-leaf"><a href="nel.html">NonEmptyList</a></li>
    <li class="level2 nav-leaf"><a href="nested.html">Nested</a></li>
    <li class="level2 nav-leaf"><a href="oneand.html">OneAnd</a></li>
    <li class="level2 nav-leaf"><a href="optiont.html">OptionT</a></li>
    <li class="level2 nav-leaf"><a href="state.html">State</a></li>
    <li class="level2 nav-leaf"><a href="statet.html">StateT</a></li>
    <li class="level2 nav-leaf"><a href="validated.html">Validated</a></li>
    <li class="level2 nav-leaf"><a href="writer.html">Writer</a></li>
    <li class="level2 nav-leaf"><a href="writert.html">WriterT</a></li>
  </ul>

</nav>

    <div id="container">

      
<nav id="page-nav">
  <p class="header"><a href="#">Kleisli</a></p>

  <ul class="nav-list">
    <li class="level1 nav-leaf"><a href="#functions">Functions</a></li>
    <li class="level1 nav-node"><a href="#kleisli-2">Kleisli</a></li>
    <li class="level2 nav-leaf"><a href="#type-class-instances">Type class instances</a></li>
    <li class="level1 nav-node"><a href="#other-uses">Other uses</a></li>
    <li class="level2 nav-leaf"><a href="#monad-transformers">Monad Transformers</a></li>
    <li class="level2 nav-leaf"><a href="#configuration">Configuration</a></li>
  </ul>

  <p class="footer"></p>
</nav>


      <main class="content">

        <h1 id="kleisli-1" class="title">Kleisli</h1>
        <p>API Documentation: <a class="api" href="https://www.javadoc.io/doc/org.typelevel/cats-docs_2.13/2.13.0/cats/data/Kleisli.html">Kleisli</a></p>
        <p>Kleisli enables composition of functions that return a monadic value, for instance an <code>Option[Int]</code> 
        or a <code>Either[String, List[Double]]</code>, without having functions take an <code>Option</code> or <code>Either</code> as a parameter, 
        which can be strange and unwieldy.</p>
        <p>We may also have several functions which depend on some environment and want a nice way to compose these functions
        to ensure they all receive the same environment. Or perhaps we have functions which depend on their own &quot;local&quot;
        configuration and all the configurations together make up a &quot;global&quot; application configuration. How do we
        have these functions play nice with each other despite each only knowing about their own local requirements?</p>
        <p>These situations are where <code>Kleisli</code> is immensely helpful.</p>
        
        <h2 id="functions" class="section"><a class="anchor-link left" href="#functions"><i class="icofont-laika link">&#xef71;</i></a>Functions</h2>
        <p>One of the most useful properties of functions is that they <strong>compose</strong>. That is, given a function
        <code>A =&gt; B</code> and a function <code>B =&gt; C</code>, we can combine them to create a new function <code>A =&gt; C</code>. It is through
        this compositional property that we are able to write many small functions and compose them together
        to create a larger one that suits our needs.</p>
        <pre class="keep-together pdf epub"><code class="nohighlight"><span class="keyword">val</span><span> </span><span class="identifier">twice</span><span>: </span><span class="type-name">Int</span><span> =&gt; </span><span class="type-name">Int</span><span> =
  </span><span class="identifier">x</span><span> =&gt; </span><span class="identifier">x</span><span> * </span><span class="number-literal">2</span><span>

</span><span class="keyword">val</span><span> </span><span class="identifier">countCats</span><span>: </span><span class="type-name">Int</span><span> =&gt; </span><span class="type-name">String</span><span> =
  </span><span class="identifier">x</span><span> =&gt; </span><span class="keyword">if</span><span> (</span><span class="identifier">x</span><span> == </span><span class="number-literal">1</span><span>) </span><span class="string-literal">&quot;1 cat&quot;</span><span> </span><span class="keyword">else</span><span> </span><span class="string-literal">s&quot;</span><span class="substitution">$x</span><span class="string-literal"> cats&quot;</span><span>

</span><span class="keyword">val</span><span> </span><span class="identifier">twiceAsManyCats</span><span>: </span><span class="type-name">Int</span><span> =&gt; </span><span class="type-name">String</span><span> =
  </span><span class="identifier">twice</span><span> </span><span class="identifier">andThen</span><span> </span><span class="identifier">countCats</span><span> </span><span class="comment">// equivalent to: countCats compose twice  </span></code></pre>
        <p>Thus.</p>
        <pre class="keep-together pdf epub"><code class="nohighlight"><span class="identifier">twiceAsManyCats</span><span>(</span><span class="number-literal">1</span><span>) </span><span class="comment">// &quot;2 cats&quot;
// res0: String = &quot;2 cats&quot;</span></code></pre>
        <p>Sometimes, our functions will need to return monadic values. For instance, consider the following set of functions.</p>
        <pre class="keep-together pdf epub"><code class="nohighlight"><span class="keyword">val</span><span> </span><span class="identifier">parse</span><span>: </span><span class="type-name">String</span><span> =&gt; </span><span class="type-name">Option</span><span>[</span><span class="type-name">Int</span><span>] =
  </span><span class="identifier">s</span><span> =&gt; </span><span class="keyword">if</span><span> (</span><span class="identifier">s</span><span>.</span><span class="identifier">matches</span><span>(</span><span class="string-literal">&quot;-?[0-9]+&quot;</span><span>)) </span><span class="type-name">Some</span><span>(</span><span class="identifier">s</span><span>.</span><span class="identifier">toInt</span><span>) </span><span class="keyword">else</span><span> </span><span class="type-name">None</span><span>

</span><span class="keyword">val</span><span> </span><span class="identifier">reciprocal</span><span>: </span><span class="type-name">Int</span><span> =&gt; </span><span class="type-name">Option</span><span>[</span><span class="type-name">Double</span><span>] =
  </span><span class="identifier">i</span><span> =&gt; </span><span class="keyword">if</span><span> (</span><span class="identifier">i</span><span> != </span><span class="number-literal">0</span><span>) </span><span class="type-name">Some</span><span>(</span><span class="number-literal">1.0</span><span> / </span><span class="identifier">i</span><span>) </span><span class="keyword">else</span><span> </span><span class="type-name">None</span></code></pre>
        <p>As it stands we cannot use <code>Function1.compose</code> (or <code>Function1.andThen</code>) to compose these two functions.
        The output type of <code>parse</code> is <code>Option[Int]</code> whereas the input type of <code>reciprocal</code> is <code>Int</code>.</p>
        <p>This is where <code>Kleisli</code> comes into play.</p>
        
        <h2 id="kleisli-2" class="section"><a class="anchor-link left" href="#kleisli-2"><i class="icofont-laika link">&#xef71;</i></a>Kleisli</h2>
        <p>At its core, <code>Kleisli[F[_], A, B]</code> is just a wrapper around the function <code>A =&gt; F[B]</code>. Depending on the
        properties of the <code>F[_]</code>, we can do different things with <code>Kleisli</code>s. For instance, if <code>F[_]</code> has a
        <code>FlatMap[F]</code> instance (we can call <code>flatMap</code> on <code>F[A]</code> values), we can
        compose two <code>Kleisli</code>s much like we can two functions.</p>
        <pre class="keep-together pdf epub"><code class="nohighlight"><span class="keyword">import</span><span> </span><span class="identifier">cats</span><span>.</span><span class="type-name">FlatMap</span><span>
</span><span class="keyword">import</span><span> </span><span class="identifier">cats</span><span>.</span><span class="identifier">syntax</span><span>.</span><span class="identifier">all</span><span>.</span><span class="identifier">_</span><span>

</span><span class="keyword">final</span><span> </span><span class="keyword">case</span><span> </span><span class="keyword">class</span><span> </span><span class="type-name">Kleisli</span><span>[</span><span class="type-name">F</span><span>[</span><span class="identifier">_</span><span>], </span><span class="type-name">A</span><span>, </span><span class="type-name">B</span><span>](</span><span class="identifier">run</span><span>: </span><span class="type-name">A</span><span> =&gt; </span><span class="type-name">F</span><span>[</span><span class="type-name">B</span><span>]) {
  </span><span class="keyword">def</span><span> </span><span class="declaration-name">compose</span><span>[</span><span class="type-name">Z</span><span>](</span><span class="identifier">k</span><span>: </span><span class="type-name">Kleisli</span><span>[</span><span class="type-name">F</span><span>, </span><span class="type-name">Z</span><span>, </span><span class="type-name">A</span><span>])(</span><span class="keyword">implicit</span><span> </span><span class="type-name">F</span><span>: </span><span class="type-name">FlatMap</span><span>[</span><span class="type-name">F</span><span>]): </span><span class="type-name">Kleisli</span><span>[</span><span class="type-name">F</span><span>, </span><span class="type-name">Z</span><span>, </span><span class="type-name">B</span><span>] =
    </span><span class="type-name">Kleisli</span><span>[</span><span class="type-name">F</span><span>, </span><span class="type-name">Z</span><span>, </span><span class="type-name">B</span><span>](</span><span class="identifier">z</span><span> =&gt; </span><span class="identifier">k</span><span>.</span><span class="identifier">run</span><span>(</span><span class="identifier">z</span><span>).</span><span class="identifier">flatMap</span><span>(</span><span class="identifier">run</span><span>))
}</span></code></pre>
        <p>Returning to our earlier example:</p>
        <pre class="keep-together pdf epub"><code class="nohighlight"><span class="comment">// Bring in cats.FlatMap[Option] instance
</span><span class="keyword">import</span><span> </span><span class="identifier">cats</span><span>.</span><span class="identifier">syntax</span><span>.</span><span class="identifier">all</span><span>.</span><span class="identifier">_</span><span>

</span><span class="keyword">val</span><span> </span><span class="identifier">parse</span><span>: </span><span class="type-name">Kleisli</span><span>[</span><span class="type-name">Option</span><span>,</span><span class="type-name">String</span><span>,</span><span class="type-name">Int</span><span>] =
  </span><span class="type-name">Kleisli</span><span>((</span><span class="identifier">s</span><span>: </span><span class="type-name">String</span><span>) =&gt; </span><span class="keyword">if</span><span> (</span><span class="identifier">s</span><span>.</span><span class="identifier">matches</span><span>(</span><span class="string-literal">&quot;-?[0-9]+&quot;</span><span>)) </span><span class="type-name">Some</span><span>(</span><span class="identifier">s</span><span>.</span><span class="identifier">toInt</span><span>) </span><span class="keyword">else</span><span> </span><span class="type-name">None</span><span>)

</span><span class="keyword">val</span><span> </span><span class="identifier">reciprocal</span><span>: </span><span class="type-name">Kleisli</span><span>[</span><span class="type-name">Option</span><span>,</span><span class="type-name">Int</span><span>,</span><span class="type-name">Double</span><span>] =
  </span><span class="type-name">Kleisli</span><span>((</span><span class="identifier">i</span><span>: </span><span class="type-name">Int</span><span>) =&gt; </span><span class="keyword">if</span><span> (</span><span class="identifier">i</span><span> != </span><span class="number-literal">0</span><span>) </span><span class="type-name">Some</span><span>(</span><span class="number-literal">1.0</span><span> / </span><span class="identifier">i</span><span>) </span><span class="keyword">else</span><span> </span><span class="type-name">None</span><span>)

</span><span class="keyword">val</span><span> </span><span class="identifier">parseAndReciprocal</span><span>: </span><span class="type-name">Kleisli</span><span>[</span><span class="type-name">Option</span><span>,</span><span class="type-name">String</span><span>,</span><span class="type-name">Double</span><span>] =
  </span><span class="identifier">reciprocal</span><span>.</span><span class="identifier">compose</span><span>(</span><span class="identifier">parse</span><span>)</span></code></pre>
        <p><code>Kleisli#andThen</code> can be defined similarly.</p>
        <p>It is important to note that the <code>F[_]</code> having a <code>FlatMap</code> (or a <code>Monad</code>) instance is not a hard requirement -
        we can do useful things with weaker requirements. Such an example would be <code>Kleisli#map</code>, which only requires
        that <code>F[_]</code> have a <code>Functor</code> instance (e.g. is equipped with <code>map: F[A] =&gt; (A =&gt; B) =&gt; F[B]</code>).</p>
        <pre class="keep-together pdf epub"><code class="nohighlight"><span class="keyword">import</span><span> </span><span class="identifier">cats</span><span>.</span><span class="type-name">Functor</span><span>

</span><span class="keyword">final</span><span> </span><span class="keyword">case</span><span> </span><span class="keyword">class</span><span> </span><span class="type-name">Kleisli</span><span>[</span><span class="type-name">F</span><span>[</span><span class="identifier">_</span><span>], </span><span class="type-name">A</span><span>, </span><span class="type-name">B</span><span>](</span><span class="identifier">run</span><span>: </span><span class="type-name">A</span><span> =&gt; </span><span class="type-name">F</span><span>[</span><span class="type-name">B</span><span>]) {
  </span><span class="keyword">def</span><span> </span><span class="declaration-name">map</span><span>[</span><span class="type-name">C</span><span>](</span><span class="identifier">f</span><span>: </span><span class="type-name">B</span><span> =&gt; </span><span class="type-name">C</span><span>)(</span><span class="keyword">implicit</span><span> </span><span class="type-name">F</span><span>: </span><span class="type-name">Functor</span><span>[</span><span class="type-name">F</span><span>]): </span><span class="type-name">Kleisli</span><span>[</span><span class="type-name">F</span><span>, </span><span class="type-name">A</span><span>, </span><span class="type-name">C</span><span>] =
    </span><span class="type-name">Kleisli</span><span>[</span><span class="type-name">F</span><span>, </span><span class="type-name">A</span><span>, </span><span class="type-name">C</span><span>](</span><span class="identifier">a</span><span> =&gt; </span><span class="type-name">F</span><span>.</span><span class="identifier">map</span><span>(</span><span class="identifier">run</span><span>(</span><span class="identifier">a</span><span>))(</span><span class="identifier">f</span><span>))
}</span></code></pre>
        <p>Below are some more methods on <code>Kleisli</code> that can be used as long as the constraint on <code>F[_]</code>
        is satisfied.</p>
        <pre><code>Method    | Constraint on `F[_]`
--------- | -------------------
andThen   | FlatMap
compose   | FlatMap
flatMap   | FlatMap
lower     | Monad
map       | Functor
traverse  | Applicative</code></pre>
        
        <h3 id="type-class-instances" class="section"><a class="anchor-link left" href="#type-class-instances"><i class="icofont-laika link">&#xef71;</i></a>Type class instances</h3>
        <p>The type class instances for <code>Kleisli</code>, like that for functions, often fix the input type (and the <code>F[_]</code>) and leave
        the output type free. What type class instances it has tends to depend on what instances the <code>F[_]</code> has. For
        instance, <code>Kleisli[F, A, B]</code> has a <code>Functor</code> instance as long as the chosen <code>F[_]</code> does. It has a <code>Monad</code>
        instance as long as the chosen <code>F[_]</code> does. The instances in Cats are laid out in a way such that implicit
        resolution will pick up the most specific instance it can (depending on the <code>F[_]</code>).</p>
        <p>An example of a <code>Monad</code> instance for <code>Kleisli</code> is shown below.</p>
        <p><em>Note</em>: the example below assumes usage of the <a href="https://github.com/typelevel/kind-projector">kind-projector compiler plugin</a> and will not compile if it is not being used in a project.</p>
        <pre><code class="nohighlight"><span class="keyword">import</span><span> </span><span class="identifier">cats</span><span>.</span><span class="identifier">syntax</span><span>.</span><span class="identifier">all</span><span>.</span><span class="identifier">_</span><span>

</span><span class="comment">// We can define a FlatMap instance for Kleisli if the F[_] we chose has a FlatMap instance
// Note the input type and F are fixed, with the output type left free
</span><span class="keyword">implicit</span><span> </span><span class="keyword">def</span><span> </span><span class="declaration-name">kleisliFlatMap</span><span>[</span><span class="type-name">F</span><span>[</span><span class="identifier">_</span><span>], </span><span class="type-name">Z</span><span>](</span><span class="keyword">implicit</span><span> </span><span class="type-name">F</span><span>: </span><span class="type-name">FlatMap</span><span>[</span><span class="type-name">F</span><span>]): </span><span class="type-name">FlatMap</span><span>[</span><span class="type-name">Kleisli</span><span>[</span><span class="type-name">F</span><span>, </span><span class="type-name">Z</span><span>, *]] =
  </span><span class="keyword">new</span><span> </span><span class="type-name">FlatMap</span><span>[</span><span class="type-name">Kleisli</span><span>[</span><span class="type-name">F</span><span>, </span><span class="type-name">Z</span><span>, *]] {
    </span><span class="keyword">def</span><span> </span><span class="declaration-name">flatMap</span><span>[</span><span class="type-name">A</span><span>, </span><span class="type-name">B</span><span>](</span><span class="identifier">fa</span><span>: </span><span class="type-name">Kleisli</span><span>[</span><span class="type-name">F</span><span>, </span><span class="type-name">Z</span><span>, </span><span class="type-name">A</span><span>])(</span><span class="identifier">f</span><span>: </span><span class="type-name">A</span><span> =&gt; </span><span class="type-name">Kleisli</span><span>[</span><span class="type-name">F</span><span>, </span><span class="type-name">Z</span><span>, </span><span class="type-name">B</span><span>]): </span><span class="type-name">Kleisli</span><span>[</span><span class="type-name">F</span><span>, </span><span class="type-name">Z</span><span>, </span><span class="type-name">B</span><span>] =
      </span><span class="type-name">Kleisli</span><span>(</span><span class="identifier">z</span><span> =&gt; </span><span class="identifier">fa</span><span>.</span><span class="identifier">run</span><span>(</span><span class="identifier">z</span><span>).</span><span class="identifier">flatMap</span><span>(</span><span class="identifier">a</span><span> =&gt; </span><span class="identifier">f</span><span>(</span><span class="identifier">a</span><span>).</span><span class="identifier">run</span><span>(</span><span class="identifier">z</span><span>)))

    </span><span class="keyword">def</span><span> </span><span class="declaration-name">map</span><span>[</span><span class="type-name">A</span><span>, </span><span class="type-name">B</span><span>](</span><span class="identifier">fa</span><span>: </span><span class="type-name">Kleisli</span><span>[</span><span class="type-name">F</span><span>, </span><span class="type-name">Z</span><span>, </span><span class="type-name">A</span><span>])(</span><span class="identifier">f</span><span>: </span><span class="type-name">A</span><span> =&gt; </span><span class="type-name">B</span><span>): </span><span class="type-name">Kleisli</span><span>[</span><span class="type-name">F</span><span>, </span><span class="type-name">Z</span><span>, </span><span class="type-name">B</span><span>] =
      </span><span class="type-name">Kleisli</span><span>(</span><span class="identifier">z</span><span> =&gt; </span><span class="identifier">fa</span><span>.</span><span class="identifier">run</span><span>(</span><span class="identifier">z</span><span>).</span><span class="identifier">map</span><span>(</span><span class="identifier">f</span><span>))

    </span><span class="keyword">def</span><span> </span><span class="declaration-name">tailRecM</span><span>[</span><span class="type-name">A</span><span>, </span><span class="type-name">B</span><span>](</span><span class="identifier">a</span><span>: </span><span class="type-name">A</span><span>)(</span><span class="identifier">f</span><span>: </span><span class="type-name">A</span><span> =&gt; </span><span class="type-name">Kleisli</span><span>[</span><span class="type-name">F</span><span>, </span><span class="type-name">Z</span><span>, </span><span class="type-name">Either</span><span>[</span><span class="type-name">A</span><span>, </span><span class="type-name">B</span><span>]]) =
      </span><span class="type-name">Kleisli</span><span>[</span><span class="type-name">F</span><span>, </span><span class="type-name">Z</span><span>, </span><span class="type-name">B</span><span>]({ </span><span class="identifier">z</span><span> =&gt; </span><span class="type-name">FlatMap</span><span>[</span><span class="type-name">F</span><span>].</span><span class="identifier">tailRecM</span><span>(</span><span class="identifier">a</span><span>) { </span><span class="identifier">f</span><span>(</span><span class="identifier">_</span><span>).</span><span class="identifier">run</span><span>(</span><span class="identifier">z</span><span>) } })
  }</span></code></pre>
        <p>Below is a table of some of the type class instances <code>Kleisli</code> can have depending on what instances <code>F[_]</code> has.</p>
        <pre><code>Type class     | Constraint on `F[_]`
-------------- | -------------------
Functor        | Functor
Apply          | Apply
Applicative    | Applicative
FlatMap        | FlatMap
Monad          | Monad
Arrow          | Monad
Split          | FlatMap
Strong         | Functor
SemigroupK*    | FlatMap
MonoidK*       | Monad</code></pre>
        <p>*These instances only exist for Kleisli arrows with identical input and output types; that is, 
        <code>Kleisli[F, A, A]</code> for some type A. These instances use Kleisli composition as the <code>combine</code> operation,
        and <code>Monad.pure</code> as the <code>empty</code> value.</p>
        <p>Also, there is an instance of <code>Monoid[Kleisli[F, A, B]]</code> if there is an instance of <code>Monoid[F[B]]</code>. 
        <code>Monoid.combine</code> here creates a new Kleisli arrow which takes an <code>A</code> value and feeds it into each 
        of the combined Kleisli arrows, which together return two <code>F[B]</code> values. Then, they are combined into one 
        using the <code>Monoid[F[B]]</code> instance.</p>
        
        <h2 id="other-uses" class="section"><a class="anchor-link left" href="#other-uses"><i class="icofont-laika link">&#xef71;</i></a>Other uses</h2>
        
        <h3 id="monad-transformers" class="section"><a class="anchor-link left" href="#monad-transformers"><i class="icofont-laika link">&#xef71;</i></a>Monad Transformers</h3>
        <p>Many data types have a monad transformer equivalent that allows us to compose the <code>Monad</code> instance of the data
        type with any other <code>Monad</code> instance. For instance, <code>OptionT[F[_], A]</code> allows us to compose the monadic properties
        of <code>Option</code> with any other <code>F[_]</code>, such as a <code>List</code>. This allows us to work with nested contexts/effects in a
        nice way (for example, in for-comprehensions).</p>
        <p><code>Kleisli</code> can be viewed as the monad transformer for functions. Recall that at its essence, <code>Kleisli[F, A, B]</code>
        is just a function <code>A =&gt; F[B]</code>, with niceties to make working with the value we actually care about, the <code>B</code>, easy.
        <code>Kleisli</code> allows us to take the effects of functions and have them play nice with the effects of any other <code>F[_]</code>.</p>
        <p>This may raise the question, what exactly is the &quot;effect&quot; of a function?</p>
        <p>Well, if we take a look at any function, we can see it takes some input and produces some output with it, without
        having touched the input (assuming the function is pure, i.e.
        <a href="https://en.wikipedia.org/wiki/Referential_transparency_%28computer_science%29">referentially transparent</a>).
        That is, we take a read-only value, and produce some value with it. For this reason, the type class instances for
        functions often refer to the function as a <code>Reader</code>. For instance, it is common to hear about the <code>Reader</code> monad.
        In the same spirit, Cats defines a <code>Reader</code> type alias along the lines of:</p>
        <pre><code class="nohighlight"><span class="comment">// We want A =&gt; B, but Kleisli provides A =&gt; F[B]. To make the types/shapes match,
// we need an F[_] such that providing it a type A is equivalent to A
// This can be thought of as the type-level equivalent of the identity function
</span><span class="keyword">type</span><span> </span><span class="type-name">Id</span><span>[</span><span class="type-name">A</span><span>] = </span><span class="type-name">A</span><span>

</span><span class="keyword">type</span><span> </span><span class="type-name">Reader</span><span>[</span><span class="type-name">A</span><span>, </span><span class="type-name">B</span><span>] = </span><span class="type-name">Kleisli</span><span>[</span><span class="type-name">Id</span><span>, </span><span class="type-name">A</span><span>, </span><span class="type-name">B</span><span>]
</span><span class="keyword">object</span><span> </span><span class="type-name">Reader</span><span> {
  </span><span class="comment">// Lifts a plain function A =&gt; B into a Kleisli, giving us access
</span><span>  </span><span class="comment">// to all the useful methods and type class instances
</span><span>  </span><span class="keyword">def</span><span> </span><span class="declaration-name">apply</span><span>[</span><span class="type-name">A</span><span>, </span><span class="type-name">B</span><span>](</span><span class="identifier">f</span><span>: </span><span class="type-name">A</span><span> =&gt; </span><span class="type-name">B</span><span>): </span><span class="type-name">Reader</span><span>[</span><span class="type-name">A</span><span>, </span><span class="type-name">B</span><span>] = </span><span class="type-name">Kleisli</span><span>[</span><span class="type-name">Id</span><span>, </span><span class="type-name">A</span><span>, </span><span class="type-name">B</span><span>](</span><span class="identifier">f</span><span>)
}

</span><span class="keyword">type</span><span> </span><span class="type-name">ReaderT</span><span>[</span><span class="type-name">F</span><span>[</span><span class="identifier">_</span><span>], </span><span class="type-name">A</span><span>, </span><span class="type-name">B</span><span>] = </span><span class="type-name">Kleisli</span><span>[</span><span class="type-name">F</span><span>, </span><span class="type-name">A</span><span>, </span><span class="type-name">B</span><span>]
</span><span class="keyword">val</span><span> </span><span class="type-name">ReaderT</span><span> = </span><span class="type-name">Kleisli</span></code></pre>
        <p>The <code>ReaderT</code> value alias exists to allow users to use the <code>Kleisli</code> companion object as if it were <code>ReaderT</code>, if
        they were so inclined.</p>
        <p>The topic of functions as a read-only environment brings us to our next common use case of <code>Kleisli</code> - configuration.</p>
        
        <h3 id="configuration" class="section"><a class="anchor-link left" href="#configuration"><i class="icofont-laika link">&#xef71;</i></a>Configuration</h3>
        <p>Functional programming advocates the creation of programs and modules by composing smaller, simpler modules. This
        philosophy intentionally mirrors that of function composition - write many small functions, and compose them
        to build larger ones. After all, our programs are just functions.</p>
        <p>Let&#39;s look at some example modules, where each module has its own configuration that is validated by a function.
        If the configuration is good, we return a <code>Some</code> of the module, otherwise a <code>None</code>. This example uses <code>Option</code> for
        simplicity - if you want to provide error messages or other failure context, consider using <code>Either</code> instead.</p>
        <pre class="keep-together pdf epub"><code class="nohighlight"><span class="keyword">case</span><span> </span><span class="keyword">class</span><span> </span><span class="type-name">DbConfig</span><span>(</span><span class="identifier">url</span><span>: </span><span class="type-name">String</span><span>, </span><span class="identifier">user</span><span>: </span><span class="type-name">String</span><span>, </span><span class="identifier">pass</span><span>: </span><span class="type-name">String</span><span>)
</span><span class="keyword">trait</span><span> </span><span class="type-name">Db</span><span>
</span><span class="keyword">object</span><span> </span><span class="type-name">Db</span><span> {
  </span><span class="keyword">val</span><span> </span><span class="identifier">fromDbConfig</span><span>: </span><span class="type-name">Kleisli</span><span>[</span><span class="type-name">Option</span><span>, </span><span class="type-name">DbConfig</span><span>, </span><span class="type-name">Db</span><span>] = ???
}

</span><span class="keyword">case</span><span> </span><span class="keyword">class</span><span> </span><span class="type-name">ServiceConfig</span><span>(</span><span class="identifier">addr</span><span>: </span><span class="type-name">String</span><span>, </span><span class="identifier">port</span><span>: </span><span class="type-name">Int</span><span>)
</span><span class="keyword">trait</span><span> </span><span class="type-name">Service</span><span>
</span><span class="keyword">object</span><span> </span><span class="type-name">Service</span><span> {
  </span><span class="keyword">val</span><span> </span><span class="identifier">fromServiceConfig</span><span>: </span><span class="type-name">Kleisli</span><span>[</span><span class="type-name">Option</span><span>, </span><span class="type-name">ServiceConfig</span><span>, </span><span class="type-name">Service</span><span>] = ???
}</span></code></pre>
        <p>We have two independent modules, a <code>Db</code> (allowing access to a database) and a <code>Service</code> (supporting an API to provide
        data over the web). Both depend on their own configuration parameters. Neither know or care about the other, as it
        should be. However our application needs both of these modules to work. It is plausible we then have a more global
        application configuration.</p>
        <pre class="keep-together pdf epub"><code class="nohighlight"><span class="keyword">case</span><span> </span><span class="keyword">class</span><span> </span><span class="type-name">AppConfig</span><span>(</span><span class="identifier">dbConfig</span><span>: </span><span class="type-name">DbConfig</span><span>, </span><span class="identifier">serviceConfig</span><span>: </span><span class="type-name">ServiceConfig</span><span>)

</span><span class="keyword">class</span><span> </span><span class="type-name">App</span><span>(</span><span class="identifier">db</span><span>: </span><span class="type-name">Db</span><span>, </span><span class="identifier">service</span><span>: </span><span class="type-name">Service</span><span>)</span></code></pre>
        <p>As it stands, we cannot use both <code>Kleisli</code> validation functions together nicely - one takes a <code>DbConfig</code>, the
        other a <code>ServiceConfig</code>. That means the <code>FlatMap</code> (and by extension, the <code>Monad</code>) instances differ (recall the
        input type is fixed in the type class instances). However, there is a nice function on <code>Kleisli</code> called <code>local</code>.</p>
        <pre class="keep-together pdf epub"><code class="nohighlight"><span class="keyword">final</span><span> </span><span class="keyword">case</span><span> </span><span class="keyword">class</span><span> </span><span class="type-name">Kleisli</span><span>[</span><span class="type-name">F</span><span>[</span><span class="identifier">_</span><span>], </span><span class="type-name">A</span><span>, </span><span class="type-name">B</span><span>](</span><span class="identifier">run</span><span>: </span><span class="type-name">A</span><span> =&gt; </span><span class="type-name">F</span><span>[</span><span class="type-name">B</span><span>]) {
  </span><span class="keyword">def</span><span> </span><span class="declaration-name">local</span><span>[</span><span class="type-name">AA</span><span>](</span><span class="identifier">f</span><span>: </span><span class="type-name">AA</span><span> =&gt; </span><span class="type-name">A</span><span>): </span><span class="type-name">Kleisli</span><span>[</span><span class="type-name">F</span><span>, </span><span class="type-name">AA</span><span>, </span><span class="type-name">B</span><span>] = </span><span class="type-name">Kleisli</span><span>(</span><span class="identifier">f</span><span>.</span><span class="identifier">andThen</span><span>(</span><span class="identifier">run</span><span>))
}</span></code></pre>
        <p>What <code>local</code> allows us to do is essentially &quot;expand&quot; our input type to a more &quot;general&quot; one. In our case, we
        can take a <code>Kleisli</code> that expects a <code>DbConfig</code> or <code>ServiceConfig</code> and turn it into one that expects an <code>AppConfig</code>,
        as long as we tell it how to go from an <code>AppConfig</code> to the other configs.</p>
        <p>Now we can create our application config validator!</p>
        <pre><code class="nohighlight"><span class="keyword">final</span><span> </span><span class="keyword">case</span><span> </span><span class="keyword">class</span><span> </span><span class="type-name">Kleisli</span><span>[</span><span class="type-name">F</span><span>[</span><span class="identifier">_</span><span>], </span><span class="type-name">Z</span><span>, </span><span class="type-name">A</span><span>](</span><span class="identifier">run</span><span>: </span><span class="type-name">Z</span><span> =&gt; </span><span class="type-name">F</span><span>[</span><span class="type-name">A</span><span>]) {
  </span><span class="keyword">def</span><span> </span><span class="declaration-name">flatMap</span><span>[</span><span class="type-name">B</span><span>](</span><span class="identifier">f</span><span>: </span><span class="type-name">A</span><span> =&gt; </span><span class="type-name">Kleisli</span><span>[</span><span class="type-name">F</span><span>, </span><span class="type-name">Z</span><span>, </span><span class="type-name">B</span><span>])(</span><span class="keyword">implicit</span><span> </span><span class="type-name">F</span><span>: </span><span class="type-name">FlatMap</span><span>[</span><span class="type-name">F</span><span>]): </span><span class="type-name">Kleisli</span><span>[</span><span class="type-name">F</span><span>, </span><span class="type-name">Z</span><span>, </span><span class="type-name">B</span><span>] =
    </span><span class="type-name">Kleisli</span><span>(</span><span class="identifier">z</span><span> =&gt; </span><span class="type-name">F</span><span>.</span><span class="identifier">flatMap</span><span>(</span><span class="identifier">run</span><span>(</span><span class="identifier">z</span><span>))(</span><span class="identifier">a</span><span> =&gt; </span><span class="identifier">f</span><span>(</span><span class="identifier">a</span><span>).</span><span class="identifier">run</span><span>(</span><span class="identifier">z</span><span>)))

  </span><span class="keyword">def</span><span> </span><span class="declaration-name">map</span><span>[</span><span class="type-name">B</span><span>](</span><span class="identifier">f</span><span>: </span><span class="type-name">A</span><span> =&gt; </span><span class="type-name">B</span><span>)(</span><span class="keyword">implicit</span><span> </span><span class="type-name">F</span><span>: </span><span class="type-name">Functor</span><span>[</span><span class="type-name">F</span><span>]): </span><span class="type-name">Kleisli</span><span>[</span><span class="type-name">F</span><span>, </span><span class="type-name">Z</span><span>, </span><span class="type-name">B</span><span>] =
    </span><span class="type-name">Kleisli</span><span>(</span><span class="identifier">z</span><span> =&gt; </span><span class="type-name">F</span><span>.</span><span class="identifier">map</span><span>(</span><span class="identifier">run</span><span>(</span><span class="identifier">z</span><span>))(</span><span class="identifier">f</span><span>))

  </span><span class="keyword">def</span><span> </span><span class="declaration-name">local</span><span>[</span><span class="type-name">ZZ</span><span>](</span><span class="identifier">f</span><span>: </span><span class="type-name">ZZ</span><span> =&gt; </span><span class="type-name">Z</span><span>): </span><span class="type-name">Kleisli</span><span>[</span><span class="type-name">F</span><span>, </span><span class="type-name">ZZ</span><span>, </span><span class="type-name">A</span><span>] = </span><span class="type-name">Kleisli</span><span>(</span><span class="identifier">f</span><span>.</span><span class="identifier">andThen</span><span>(</span><span class="identifier">run</span><span>))
}

</span><span class="keyword">case</span><span> </span><span class="keyword">class</span><span> </span><span class="type-name">DbConfig</span><span>(</span><span class="identifier">url</span><span>: </span><span class="type-name">String</span><span>, </span><span class="identifier">user</span><span>: </span><span class="type-name">String</span><span>, </span><span class="identifier">pass</span><span>: </span><span class="type-name">String</span><span>)
</span><span class="keyword">trait</span><span> </span><span class="type-name">Db</span><span>
</span><span class="keyword">object</span><span> </span><span class="type-name">Db</span><span> {
  </span><span class="keyword">val</span><span> </span><span class="identifier">fromDbConfig</span><span>: </span><span class="type-name">Kleisli</span><span>[</span><span class="type-name">Option</span><span>, </span><span class="type-name">DbConfig</span><span>, </span><span class="type-name">Db</span><span>] = ???
}

</span><span class="keyword">case</span><span> </span><span class="keyword">class</span><span> </span><span class="type-name">ServiceConfig</span><span>(</span><span class="identifier">addr</span><span>: </span><span class="type-name">String</span><span>, </span><span class="identifier">port</span><span>: </span><span class="type-name">Int</span><span>)
</span><span class="keyword">trait</span><span> </span><span class="type-name">Service</span><span>
</span><span class="keyword">object</span><span> </span><span class="type-name">Service</span><span> {
  </span><span class="keyword">val</span><span> </span><span class="identifier">fromServiceConfig</span><span>: </span><span class="type-name">Kleisli</span><span>[</span><span class="type-name">Option</span><span>, </span><span class="type-name">ServiceConfig</span><span>, </span><span class="type-name">Service</span><span>] = ???
}

</span><span class="keyword">case</span><span> </span><span class="keyword">class</span><span> </span><span class="type-name">AppConfig</span><span>(</span><span class="identifier">dbConfig</span><span>: </span><span class="type-name">DbConfig</span><span>, </span><span class="identifier">serviceConfig</span><span>: </span><span class="type-name">ServiceConfig</span><span>)

</span><span class="keyword">class</span><span> </span><span class="type-name">App</span><span>(</span><span class="identifier">db</span><span>: </span><span class="type-name">Db</span><span>, </span><span class="identifier">service</span><span>: </span><span class="type-name">Service</span><span>)

</span><span class="keyword">def</span><span> </span><span class="declaration-name">appFromAppConfig</span><span>: </span><span class="type-name">Kleisli</span><span>[</span><span class="type-name">Option</span><span>, </span><span class="type-name">AppConfig</span><span>, </span><span class="type-name">App</span><span>] =
  </span><span class="keyword">for</span><span> {
    </span><span class="identifier">db</span><span> &lt;- </span><span class="type-name">Db</span><span>.</span><span class="identifier">fromDbConfig</span><span>.</span><span class="identifier">local</span><span>[</span><span class="type-name">AppConfig</span><span>](</span><span class="identifier">_</span><span>.</span><span class="identifier">dbConfig</span><span>)
    </span><span class="identifier">sv</span><span> &lt;- </span><span class="type-name">Service</span><span>.</span><span class="identifier">fromServiceConfig</span><span>.</span><span class="identifier">local</span><span>[</span><span class="type-name">AppConfig</span><span>](</span><span class="identifier">_</span><span>.</span><span class="identifier">serviceConfig</span><span>)
  } </span><span class="keyword">yield</span><span> </span><span class="keyword">new</span><span> </span><span class="type-name">App</span><span>(</span><span class="identifier">db</span><span>, </span><span class="identifier">sv</span><span>)</span></code></pre>
        <p>What if we need a module that doesn&#39;t need any config validation, say a strategy to log events? We would have such a
        module be instantiated from a config directly, without an <code>Option</code> - we would have something like
        <code>Kleisli[Id, LogConfig, Log]</code> (alternatively, <code>Reader[LogConfig, Log]</code>). However, this won&#39;t play nice with our other
        <code>Kleisli</code>s since those use <code>Option</code> instead of <code>Id</code>.</p>
        <p>We can define a <code>lift</code> method on <code>Kleisli</code> (available already on <code>Kleisli</code> in Cats) that takes a type parameter <code>G[_]</code>
        such that <code>G</code> has an <code>Applicative</code> instance and lifts a <code>Kleisli</code> value such that its output type is <code>G[F[B]]</code>. This
        allows us to then lift a <code>Reader[A, B]</code> into a <code>Kleisli[G, A, B]</code>. Note that lifting a <code>Reader[A, B]</code> into some <code>G[_]</code>
        is equivalent to having a <code>Kleisli[G, A, B]</code> since <code>Reader[A, B]</code> is just a type alias for <code>Kleisli[Id, A, B]</code>, and
        <code>type Id[A] = A</code> so <code>G[Id[A]]</code> is equivalent to <code>G[A]</code>.</p>

        
<hr class="footer-rule"/>
<footer>
  cats is a <a href="https://typelevel.org/">Typelevel</a> project distributed under the <a href="https://opensource.org/licenses/MIT">MIT</a> license.
</footer>


      </main>

    </div>

  </body>

</html>