<!DOCTYPE html>
<html lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="Laika 0.18.1 + Helium Theme" />
    <title>Validated</title>
    
      <meta name="author" content="Cody Allen"/>
    
      <meta name="author" content="Ross Baker"/>
    
      <meta name="author" content="Arman Bilge"/>
    
      <meta name="author" content="P. Oscar Boykin"/>
    
      <meta name="author" content="Travis Brown"/>
    
      <meta name="author" content="Adelbert Chang"/>
    
      <meta name="author" content="Daniel Esik"/>
    
      <meta name="author" content="Peter Neyens"/>
    
      <meta name="author" content="Rob Norris"/>
    
      <meta name="author" content="Erik Osheim"/>
    
      <meta name="author" content="LukaJCB"/>
    
      <meta name="author" content="Michael Pilquist"/>
    
      <meta name="author" content="Miles Sabin"/>
    
      <meta name="author" content="Daniel Spiewak"/>
    
      <meta name="author" content="Frank Thomas"/>
    
      <meta name="author" content="Sergey Torgashov"/>
    
      <meta name="author" content="Julien Truffaut"/>
    
      <meta name="author" content="Kailuo Wang"/>
    
    
      <meta name="description" content="docs"/>
    
    
      <link rel="icon" sizes="32x32" type="image/png" href="https://typelevel.org/img/favicon.png"/>
    
    
      <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:400,700">
    
      <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/tonsky/FiraCode@1.207/distr/fira_code.css">
    
    <link rel="stylesheet" type="text/css" href="../helium/icofont.min.css" />
    <link rel="stylesheet" type="text/css" href="../helium/laika-helium.css" />
    <link rel="stylesheet" type="text/css" href="../site/styles.css" />
    <script src="../helium/laika-helium.js"></script>
    <script src="../js/sponsors.js"></script>
    
    
    <script> /* for avoiding page load transitions */ </script>
  </head>

  <body>

    <header id="top-bar">

      <div class="row">
        <a id="nav-icon">
          <i class="icofont-laika" title="Navigation">&#xefa2;</i>
        </a>
        
      </div>

      <a class="image-link" href="https://typelevel.org"><img src="https://typelevel.org/img/logo.svg"></a>

      <span class="row links"><a class="icon-link svg-link" href="https://www.javadoc.io/doc/org.typelevel/cats-docs_2.12/2.8.0/"><span title="API"><svg class="svg-icon" width="100%" height="100%" viewBox="0 0 100 100" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xml:space="preserve" xmlns:serif="http://www.serif.com/" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:2;">
  <g class="svg-shape">
    <path d="M75,47.5c13.246,0 24,10.754 24,24c0,13.246 -10.754,24 -24,24c-13.246,0 -24,-10.754 -24,-24c0,-13.246 10.754,-24 24,-24Zm-50,-0c13.246,-0 24,10.754 24,24c0,13.246 -10.754,24 -24,24c-13.246,-0 -24,-10.754 -24,-24c0,-13.246 10.754,-24 24,-24Zm2.705,16.735l7.239,0l0.622,-4.904l-21.833,0l-0,4.904l7.589,0l0,22.067l6.383,0l-0,-22.067Zm58.076,7.265c-0,-8.757 -3.698,-14.166 -10.781,-14.166c-7.083,-0 -10.781,5.604 -10.781,14.166c0,8.757 3.698,14.166 10.781,14.166c7.083,0 10.781,-5.604 10.781,-14.166Zm-6.539,0c0,6.538 -1.128,9.496 -4.242,9.496c-2.997,0 -4.242,-2.88 -4.242,-9.496c-0,-6.616 1.206,-9.496 4.242,-9.496c3.036,-0 4.242,2.88 4.242,9.496Zm-29.242,-67c13.246,0 24,10.754 24,24c0,13.246 -10.754,24 -24,24c-13.246,0 -24,-10.754 -24,-24c0,-13.246 10.754,-24 24,-24Zm0.512,9.834c-7.122,-0 -12.609,5.098 -12.609,14.127c-0,9.263 5.215,14.205 12.532,14.205c4.164,0 7.083,-1.634 9.068,-3.658l-2.88,-3.697c-1.518,1.206 -3.153,2.413 -5.838,2.413c-3.697,-0 -6.266,-2.763 -6.266,-9.263c-0,-6.616 2.724,-9.379 6.149,-9.379c2.102,-0 3.892,0.778 5.371,1.984l3.113,-3.775c-2.257,-1.868 -4.748,-2.957 -8.64,-2.957Z"/>
  </g>
</svg></span></a><a class="icon-link svg-link" href="https://github.com/typelevel/cats"><span title="Source Code"><svg class="svg-icon" width="100%" height="100%" viewBox="0 0 100 100" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xml:space="preserve" xmlns:serif="http://www.serif.com/" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:2;">
  <g class="svg-shape">
    <path d="M49.995,1c-27.609,-0 -49.995,22.386 -49.995,50.002c-0,22.09 14.325,40.83 34.194,47.444c2.501,0.458 3.413,-1.086 3.413,-2.412c0,-1.185 -0.043,-4.331 -0.067,-8.503c-13.908,3.021 -16.843,-6.704 -16.843,-6.704c-2.274,-5.773 -5.552,-7.311 -5.552,-7.311c-4.54,-3.103 0.344,-3.042 0.344,-3.042c5.018,0.356 7.658,5.154 7.658,5.154c4.46,7.64 11.704,5.433 14.552,4.156c0.454,-3.232 1.744,-5.436 3.174,-6.685c-11.102,-1.262 -22.775,-5.553 -22.775,-24.713c-0,-5.457 1.949,-9.92 5.147,-13.416c-0.516,-1.265 -2.231,-6.348 0.488,-13.233c0,0 4.199,-1.344 13.751,5.126c3.988,-1.108 8.266,-1.663 12.518,-1.682c4.245,0.019 8.523,0.574 12.517,1.682c9.546,-6.47 13.736,-5.126 13.736,-5.126c2.728,6.885 1.013,11.968 0.497,13.233c3.204,3.496 5.141,7.959 5.141,13.416c0,19.209 -11.691,23.436 -22.83,24.673c1.795,1.544 3.394,4.595 3.394,9.26c0,6.682 -0.061,12.076 -0.061,13.715c0,1.338 0.899,2.894 3.438,2.406c19.853,-6.627 34.166,-25.354 34.166,-47.438c-0,-27.616 -22.389,-50.002 -50.005,-50.002"/>
  </g>
</svg></span></a><a class="icon-link" href="https://discord.gg/XF3CXcMzqD"><i class="icofont-laika" title="Chat">&#xeed5;</i></a><a class="icon-link" href="https://twitter.com/typelevel"><i class="icofont-laika" title="Twitter">&#xed7a;</i></a></span>

    </header>

    <nav id="sidebar">

      <div class="row">
        <a class="icon-link svg-link" href="https://www.javadoc.io/doc/org.typelevel/cats-docs_2.12/2.8.0/"><span title="API"><svg class="svg-icon" width="100%" height="100%" viewBox="0 0 100 100" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xml:space="preserve" xmlns:serif="http://www.serif.com/" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:2;">
  <g class="svg-shape">
    <path d="M75,47.5c13.246,0 24,10.754 24,24c0,13.246 -10.754,24 -24,24c-13.246,0 -24,-10.754 -24,-24c0,-13.246 10.754,-24 24,-24Zm-50,-0c13.246,-0 24,10.754 24,24c0,13.246 -10.754,24 -24,24c-13.246,-0 -24,-10.754 -24,-24c0,-13.246 10.754,-24 24,-24Zm2.705,16.735l7.239,0l0.622,-4.904l-21.833,0l-0,4.904l7.589,0l0,22.067l6.383,0l-0,-22.067Zm58.076,7.265c-0,-8.757 -3.698,-14.166 -10.781,-14.166c-7.083,-0 -10.781,5.604 -10.781,14.166c0,8.757 3.698,14.166 10.781,14.166c7.083,0 10.781,-5.604 10.781,-14.166Zm-6.539,0c0,6.538 -1.128,9.496 -4.242,9.496c-2.997,0 -4.242,-2.88 -4.242,-9.496c-0,-6.616 1.206,-9.496 4.242,-9.496c3.036,-0 4.242,2.88 4.242,9.496Zm-29.242,-67c13.246,0 24,10.754 24,24c0,13.246 -10.754,24 -24,24c-13.246,0 -24,-10.754 -24,-24c0,-13.246 10.754,-24 24,-24Zm0.512,9.834c-7.122,-0 -12.609,5.098 -12.609,14.127c-0,9.263 5.215,14.205 12.532,14.205c4.164,0 7.083,-1.634 9.068,-3.658l-2.88,-3.697c-1.518,1.206 -3.153,2.413 -5.838,2.413c-3.697,-0 -6.266,-2.763 -6.266,-9.263c-0,-6.616 2.724,-9.379 6.149,-9.379c2.102,-0 3.892,0.778 5.371,1.984l3.113,-3.775c-2.257,-1.868 -4.748,-2.957 -8.64,-2.957Z"/>
  </g>
</svg></span></a><a class="icon-link svg-link" href="https://github.com/typelevel/cats"><span title="Source Code"><svg class="svg-icon" width="100%" height="100%" viewBox="0 0 100 100" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xml:space="preserve" xmlns:serif="http://www.serif.com/" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:2;">
  <g class="svg-shape">
    <path d="M49.995,1c-27.609,-0 -49.995,22.386 -49.995,50.002c-0,22.09 14.325,40.83 34.194,47.444c2.501,0.458 3.413,-1.086 3.413,-2.412c0,-1.185 -0.043,-4.331 -0.067,-8.503c-13.908,3.021 -16.843,-6.704 -16.843,-6.704c-2.274,-5.773 -5.552,-7.311 -5.552,-7.311c-4.54,-3.103 0.344,-3.042 0.344,-3.042c5.018,0.356 7.658,5.154 7.658,5.154c4.46,7.64 11.704,5.433 14.552,4.156c0.454,-3.232 1.744,-5.436 3.174,-6.685c-11.102,-1.262 -22.775,-5.553 -22.775,-24.713c-0,-5.457 1.949,-9.92 5.147,-13.416c-0.516,-1.265 -2.231,-6.348 0.488,-13.233c0,0 4.199,-1.344 13.751,5.126c3.988,-1.108 8.266,-1.663 12.518,-1.682c4.245,0.019 8.523,0.574 12.517,1.682c9.546,-6.47 13.736,-5.126 13.736,-5.126c2.728,6.885 1.013,11.968 0.497,13.233c3.204,3.496 5.141,7.959 5.141,13.416c0,19.209 -11.691,23.436 -22.83,24.673c1.795,1.544 3.394,4.595 3.394,9.26c0,6.682 -0.061,12.076 -0.061,13.715c0,1.338 0.899,2.894 3.438,2.406c19.853,-6.627 34.166,-25.354 34.166,-47.438c-0,-27.616 -22.389,-50.002 -50.005,-50.002"/>
  </g>
</svg></span></a><a class="icon-link" href="https://discord.gg/XF3CXcMzqD"><i class="icofont-laika" title="Chat">&#xeed5;</i></a><a class="icon-link" href="https://twitter.com/typelevel"><i class="icofont-laika" title="Twitter">&#xed7a;</i></a>
      </div>

      <ul class="nav-list">
        <li class="level1"><a href="../index.html">Cats</a></li>
        <li class="level1"><a href="../typeclasses.html">Type Classes</a></li>
        <li class="level1"><a href="../datatypes.html">Data Types</a></li>
        <li class="level1"><a href="../algebra.html">Algebra</a></li>
        <li class="level1"><a href="../motivations.html">Motivations</a></li>
        <li class="level1"><a href="../resources_for_learners.html">Resources for Learners</a></li>
        <li class="level1"><a href="../jump_start_guide.html">Jump Start Guide</a></li>
        <li class="level1"><a href="../imports.html">Imports</a></li>
        <li class="level1"><a href="../faq.html">FAQ</a></li>
        <li class="level1"><a href="../CONTRIBUTING.html">Contributor guide</a></li>
        <li class="level1"><a href="../colophon.html">Colophon</a></li>
        <li class="level1"><a href="../nomenclature.html">Glossary</a></li>
        <li class="level1"><a href="../guidelines.html">Guidelines</a></li>
        <li class="level1"><a href="../typelevelEcosystem.html">Typelevel Ecosystem</a></li>
        <li class="level1 nav-header">Type Classes</li>
        <li class="level2"><a href="../typeclasses/alternative.html">Alternative</a></li>
        <li class="level2"><a href="../typeclasses/applicative.html">Applicative</a></li>
        <li class="level2"><a href="../typeclasses/applicativemonaderror.html">ApplicativeError and MonadError</a></li>
        <li class="level2"><a href="../typeclasses/applicativetraverse.html">Applicative and Traversable Functors</a></li>
        <li class="level2"><a href="../typeclasses/arrow.html">Arrow</a></li>
        <li class="level2"><a href="../typeclasses/arrowchoice.html">Arrow Choice</a></li>
        <li class="level2"><a href="../typeclasses/bifoldable.html">Bifoldable</a></li>
        <li class="level2"><a href="../typeclasses/bifunctor.html">Bifunctor</a></li>
        <li class="level2"><a href="../typeclasses/bimonad.html">Bimonad</a></li>
        <li class="level2"><a href="../typeclasses/comonad.html">Comonad</a></li>
        <li class="level2"><a href="../typeclasses/contravariant.html">Contravariant</a></li>
        <li class="level2"><a href="../typeclasses/contravariantmonoidal.html">Contravariant Monoidal</a></li>
        <li class="level2"><a href="../typeclasses/eq.html">Eq</a></li>
        <li class="level2"><a href="../typeclasses/foldable.html">Foldable</a></li>
        <li class="level2"><a href="../typeclasses/functor.html">Functor</a></li>
        <li class="level2"><a href="../typeclasses/invariant.html">Invariant</a></li>
        <li class="level2"><a href="../typeclasses/invariantmonoidal.html">Invariant Monoidal</a></li>
        <li class="level2"><a href="../typeclasses/lawtesting.html">Law testing</a></li>
        <li class="level2"><a href="../typeclasses/monad.html">Monad</a></li>
        <li class="level2"><a href="../typeclasses/monoid.html">Monoid</a></li>
        <li class="level2"><a href="../typeclasses/monoidk.html">MonoidK</a></li>
        <li class="level2"><a href="../typeclasses/nonemptytraverse.html">NonEmptyTraverse</a></li>
        <li class="level2"><a href="../typeclasses/parallel.html">Parallel</a></li>
        <li class="level2"><a href="../typeclasses/reducible.html">Reducible</a></li>
        <li class="level2"><a href="../typeclasses/semigroup.html">Semigroup</a></li>
        <li class="level2"><a href="../typeclasses/semigroupk.html">SemigroupK</a></li>
        <li class="level2"><a href="../typeclasses/show.html">Show</a></li>
        <li class="level2"><a href="../typeclasses/traverse.html">Traverse</a></li>
        <li class="level1 nav-header">Data Types</li>
        <li class="level2"><a href="chain.html">Chain</a></li>
        <li class="level2"><a href="const.html">Const</a></li>
        <li class="level2"><a href="contt.html">ContT</a></li>
        <li class="level2"><a href="either.html">Either</a></li>
        <li class="level2"><a href="eithert.html">EitherT</a></li>
        <li class="level2"><a href="eval.html">Eval</a></li>
        <li class="level2"><a href="freeapplicative.html">Free Applicative</a></li>
        <li class="level2"><a href="freemonad.html">Free Monad</a></li>
        <li class="level2"><a href="functionk.html">FunctionK</a></li>
        <li class="level2"><a href="id.html">Id</a></li>
        <li class="level2"><a href="ior.html">Ior</a></li>
        <li class="level2"><a href="iort.html">IorT</a></li>
        <li class="level2"><a href="kleisli.html">Kleisli</a></li>
        <li class="level2"><a href="nel.html">NonEmptyList</a></li>
        <li class="level2"><a href="nested.html">Nested</a></li>
        <li class="level2"><a href="oneand.html">OneAnd</a></li>
        <li class="level2"><a href="optiont.html">OptionT</a></li>
        <li class="level2"><a href="state.html">State</a></li>
        <li class="level2 active"><a href="#">Validated</a></li>
        <li class="level2"><a href="writer.html">Writer</a></li>
        <li class="level2"><a href="writert.html">WriterT</a></li>
        <li class="level2"><a href="statet.html">StateT</a></li>
      </ul>

      <ul class="nav-list">
        <li class="level1 nav-header">Related Projects</li>
        
          <li class="level2"><a href="https://typelevel.org/cats-effect/">cats-effect</a></li>
        
          <li class="level2"><a href="https://typelevel.org/mouse">Mouse</a></li>
        
          <li class="level2"><a href="https://github.com/typelevel/discipline/">discipline</a></li>
        
      </ul>

    </nav>

    <div id="container">

      <nav id="page-nav">
        <p class="header"><a href="#">Validated</a></p>

        <ul class="nav-list">
          <li class="level1"><a href="#a-first-approach">A first approach</a></li>
          <li class="level2"><a href="#an-iteration-with-validated">An iteration with <code>Validated</code></a></li>
          <li class="level2"><a href="#meeting-applicative">Meeting applicative</a></li>
          <li class="level2"><a href="#a-short-detour">A short detour</a></li>
          <li class="level2"><a href="#going-back-and-forth">Going back and forth</a></li>
          <li class="level1"><a href="#another-case">Another case</a></li>
          <li class="level1"><a href="#parallel-validation">Parallel validation</a></li>
          <li class="level1"><a href="#apply">Apply</a></li>
          <li class="level1"><a href="#of-flatmaps-and-eithers">Of <code>flatMap</code>s and <code>Either</code>s</a></li>
          <li class="level1"><a href="#validated-vs-either"><code>Validated</code> vs <code>Either</code></a></li>
          <li class="level1"><a href="#sequential-validation">Sequential Validation</a></li>
          <li class="level2"><a href="#andthen"><code>andThen</code></a></li>
          <li class="level2"><a href="#witheither"><code>withEither</code></a></li>
        </ul>

        <p class="footer"></p>
      </nav>

      <main class="content">

        <h1 id="validated" class="title">Validated</h1>
        <p>Imagine you are filling out a web form to signup for an account. You input your username and password and submit.
        Response comes back saying your username can&#39;t have dashes in it, so you make some changes and resubmit. Can&#39;t
        have special characters either. Change, resubmit. Passwords need to have at least one capital letter. Change,
        resubmit. Password needs to have at least one number.</p>
        <p>It would be nice to have all of these errors be reported simultaneously. That the username can&#39;t have dashes can
        be validated separately from it not having special characters, as well as from the password needing to have certain
        requirements. A misspelled (or missing) field in a config can be validated separately from another field not being
        well-formed.</p>
        <p>Enter <code>Validated</code>.</p>
        
        <h2 id="a-first-approach" class="section">A first approach<a class="anchor-link right" href="#a-first-approach"><i class="icofont-laika">&#xef71;</i></a></h2>
        <p>You&#39;ll note firsthand that <code>Validated</code> is very similar to <code>Either</code> because it also has two possible values: errors on the left side or successful computations on the right side.</p>
        <p>Signature of the structure is as follows:</p>
        <pre class="keep-together pdf epub"><code class="nohighlight"><span class="keyword">sealed</span><span> </span><span class="keyword">abstract</span><span> </span><span class="keyword">class</span><span> </span><span class="type-name">Validated</span><span>[+</span><span class="type-name">E</span><span>, +</span><span class="type-name">A</span><span>] </span><span class="keyword">extends</span><span> </span><span class="type-name">Product</span><span> </span><span class="keyword">with</span><span> </span><span class="type-name">Serializable</span><span> {
  </span><span class="comment">// Implementation elided
</span><span>}</span></code></pre>
        <p>And its <em>projections</em>:</p>
        <pre class="keep-together pdf epub"><code class="nohighlight"><span class="keyword">final</span><span> </span><span class="keyword">case</span><span> </span><span class="keyword">class</span><span> </span><span class="type-name">Valid</span><span>[+</span><span class="type-name">A</span><span>](</span><span class="identifier">a</span><span>: </span><span class="type-name">A</span><span>) </span><span class="keyword">extends</span><span> </span><span class="type-name">Validated</span><span>[</span><span class="type-name">Nothing</span><span>, </span><span class="type-name">A</span><span>]
</span><span class="keyword">final</span><span> </span><span class="keyword">case</span><span> </span><span class="keyword">class</span><span> </span><span class="type-name">Invalid</span><span>[+</span><span class="type-name">E</span><span>](</span><span class="identifier">e</span><span>: </span><span class="type-name">E</span><span>) </span><span class="keyword">extends</span><span> </span><span class="type-name">Validated</span><span>[</span><span class="type-name">E</span><span>, </span><span class="type-name">Nothing</span><span>]</span></code></pre>
        <p>Before diving into <code>Validated</code>, let&#39;s take a look at an <code>Either</code> based first approach to address our validation necessity.</p>
        <p>Our data will be represented this way:</p>
        <pre class="keep-together pdf epub"><code class="nohighlight"><span class="keyword">final</span><span> </span><span class="keyword">case</span><span> </span><span class="keyword">class</span><span> </span><span class="type-name">RegistrationData</span><span>(</span><span class="identifier">username</span><span>: </span><span class="type-name">String</span><span>, </span><span class="identifier">password</span><span>: </span><span class="type-name">String</span><span>, </span><span class="identifier">firstName</span><span>: </span><span class="type-name">String</span><span>, </span><span class="identifier">lastName</span><span>: </span><span class="type-name">String</span><span>, </span><span class="identifier">age</span><span>: </span><span class="type-name">Int</span><span>)</span></code></pre>
        <p>And our error model:</p>
        <pre><code class="nohighlight"><span class="keyword">sealed</span><span> </span><span class="keyword">trait</span><span> </span><span class="type-name">DomainValidation</span><span> {
  </span><span class="keyword">def</span><span> </span><span class="declaration-name">errorMessage</span><span>: </span><span class="type-name">String</span><span>
}

</span><span class="keyword">case</span><span> </span><span class="keyword">object</span><span> </span><span class="type-name">UsernameHasSpecialCharacters</span><span> </span><span class="keyword">extends</span><span> </span><span class="type-name">DomainValidation</span><span> {
  </span><span class="keyword">def</span><span> </span><span class="declaration-name">errorMessage</span><span>: </span><span class="type-name">String</span><span> = </span><span class="string-literal">&quot;Username cannot contain special characters.&quot;</span><span>
}

</span><span class="keyword">case</span><span> </span><span class="keyword">object</span><span> </span><span class="type-name">PasswordDoesNotMeetCriteria</span><span> </span><span class="keyword">extends</span><span> </span><span class="type-name">DomainValidation</span><span> {
  </span><span class="keyword">def</span><span> </span><span class="declaration-name">errorMessage</span><span>: </span><span class="type-name">String</span><span> = </span><span class="string-literal">&quot;Password must be at least 10 characters long, including an uppercase and a lowercase letter, one number and one special character.&quot;</span><span>
}

</span><span class="keyword">case</span><span> </span><span class="keyword">object</span><span> </span><span class="type-name">FirstNameHasSpecialCharacters</span><span> </span><span class="keyword">extends</span><span> </span><span class="type-name">DomainValidation</span><span> {
  </span><span class="keyword">def</span><span> </span><span class="declaration-name">errorMessage</span><span>: </span><span class="type-name">String</span><span> = </span><span class="string-literal">&quot;First name cannot contain spaces, numbers or special characters.&quot;</span><span>
}

</span><span class="keyword">case</span><span> </span><span class="keyword">object</span><span> </span><span class="type-name">LastNameHasSpecialCharacters</span><span> </span><span class="keyword">extends</span><span> </span><span class="type-name">DomainValidation</span><span> {
  </span><span class="keyword">def</span><span> </span><span class="declaration-name">errorMessage</span><span>: </span><span class="type-name">String</span><span> = </span><span class="string-literal">&quot;Last name cannot contain spaces, numbers or special characters.&quot;</span><span>
}

</span><span class="keyword">case</span><span> </span><span class="keyword">object</span><span> </span><span class="type-name">AgeIsInvalid</span><span> </span><span class="keyword">extends</span><span> </span><span class="type-name">DomainValidation</span><span> {
  </span><span class="keyword">def</span><span> </span><span class="declaration-name">errorMessage</span><span>: </span><span class="type-name">String</span><span> = </span><span class="string-literal">&quot;You must be aged 18 and not older than 75 to use our services.&quot;</span><span>
}</span></code></pre>
        <p>We have our <code>RegistrationData</code> case class that will hold the information the user has submitted, alongside the definition of the error model that we&#39;ll be using for displaying the possible errors of every field. Now, let&#39;s explore the proposed implementation:</p>
        <pre><code class="nohighlight"><span class="keyword">import</span><span> </span><span class="identifier">cats</span><span>.</span><span class="identifier">implicits</span><span>.</span><span class="identifier">_</span><span>

</span><span class="keyword">sealed</span><span> </span><span class="keyword">trait</span><span> </span><span class="type-name">FormValidator</span><span> {
 </span><span class="keyword">def</span><span> </span><span class="declaration-name">validateUserName</span><span>(</span><span class="identifier">userName</span><span>: </span><span class="type-name">String</span><span>): </span><span class="type-name">Either</span><span>[</span><span class="type-name">DomainValidation</span><span>, </span><span class="type-name">String</span><span>] =
    </span><span class="type-name">Either</span><span>.</span><span class="identifier">cond</span><span>(
      </span><span class="identifier">userName</span><span>.</span><span class="identifier">matches</span><span>(</span><span class="string-literal">&quot;^[a-zA-Z0-9]+$&quot;</span><span>),
      </span><span class="identifier">userName</span><span>,
      </span><span class="type-name">UsernameHasSpecialCharacters</span><span>
    )

 </span><span class="keyword">def</span><span> </span><span class="declaration-name">validatePassword</span><span>(</span><span class="identifier">password</span><span>: </span><span class="type-name">String</span><span>): </span><span class="type-name">Either</span><span>[</span><span class="type-name">DomainValidation</span><span>, </span><span class="type-name">String</span><span>] =
    </span><span class="type-name">Either</span><span>.</span><span class="identifier">cond</span><span>(
      </span><span class="identifier">password</span><span>.</span><span class="identifier">matches</span><span>(</span><span class="string-literal">&quot;(?=^.{10,}$)((?=.*</span><span class="escape-sequence">\\</span><span class="string-literal">d)|(?=.*</span><span class="escape-sequence">\\</span><span class="string-literal">W+))(?![.</span><span class="escape-sequence">\\</span><span class="string-literal">n])(?=.*[A-Z])(?=.*[a-z]).*$&quot;</span><span>),
      </span><span class="identifier">password</span><span>,
      </span><span class="type-name">PasswordDoesNotMeetCriteria</span><span>
    )

 </span><span class="keyword">def</span><span> </span><span class="declaration-name">validateFirstName</span><span>(</span><span class="identifier">firstName</span><span>: </span><span class="type-name">String</span><span>): </span><span class="type-name">Either</span><span>[</span><span class="type-name">DomainValidation</span><span>, </span><span class="type-name">String</span><span>] =
    </span><span class="type-name">Either</span><span>.</span><span class="identifier">cond</span><span>(
      </span><span class="identifier">firstName</span><span>.</span><span class="identifier">matches</span><span>(</span><span class="string-literal">&quot;^[a-zA-Z]+$&quot;</span><span>),
      </span><span class="identifier">firstName</span><span>,
      </span><span class="type-name">FirstNameHasSpecialCharacters</span><span>
    )

 </span><span class="keyword">def</span><span> </span><span class="declaration-name">validateLastName</span><span>(</span><span class="identifier">lastName</span><span>: </span><span class="type-name">String</span><span>): </span><span class="type-name">Either</span><span>[</span><span class="type-name">DomainValidation</span><span>, </span><span class="type-name">String</span><span>] =
    </span><span class="type-name">Either</span><span>.</span><span class="identifier">cond</span><span>(
      </span><span class="identifier">lastName</span><span>.</span><span class="identifier">matches</span><span>(</span><span class="string-literal">&quot;^[a-zA-Z]+$&quot;</span><span>),
      </span><span class="identifier">lastName</span><span>,
      </span><span class="type-name">LastNameHasSpecialCharacters</span><span>
    )

 </span><span class="keyword">def</span><span> </span><span class="declaration-name">validateAge</span><span>(</span><span class="identifier">age</span><span>: </span><span class="type-name">Int</span><span>): </span><span class="type-name">Either</span><span>[</span><span class="type-name">DomainValidation</span><span>, </span><span class="type-name">Int</span><span>] =
    </span><span class="type-name">Either</span><span>.</span><span class="identifier">cond</span><span>(
      </span><span class="identifier">age</span><span> &gt;= </span><span class="number-literal">18</span><span> &amp;&amp; </span><span class="identifier">age</span><span> &lt;= </span><span class="number-literal">75</span><span>,
      </span><span class="identifier">age</span><span>,
      </span><span class="type-name">AgeIsInvalid</span><span>
    )

  </span><span class="keyword">def</span><span> </span><span class="declaration-name">validateForm</span><span>(</span><span class="identifier">username</span><span>: </span><span class="type-name">String</span><span>, </span><span class="identifier">password</span><span>: </span><span class="type-name">String</span><span>, </span><span class="identifier">firstName</span><span>: </span><span class="type-name">String</span><span>, </span><span class="identifier">lastName</span><span>: </span><span class="type-name">String</span><span>, </span><span class="identifier">age</span><span>: </span><span class="type-name">Int</span><span>): </span><span class="type-name">Either</span><span>[</span><span class="type-name">DomainValidation</span><span>, </span><span class="type-name">RegistrationData</span><span>] = {

    </span><span class="keyword">for</span><span> {
      </span><span class="identifier">validatedUserName</span><span> &lt;- </span><span class="identifier">validateUserName</span><span>(</span><span class="identifier">username</span><span>)
      </span><span class="identifier">validatedPassword</span><span> &lt;- </span><span class="identifier">validatePassword</span><span>(</span><span class="identifier">password</span><span>)
      </span><span class="identifier">validatedFirstName</span><span> &lt;- </span><span class="identifier">validateFirstName</span><span>(</span><span class="identifier">firstName</span><span>)
      </span><span class="identifier">validatedLastName</span><span> &lt;- </span><span class="identifier">validateLastName</span><span>(</span><span class="identifier">lastName</span><span>)
      </span><span class="identifier">validatedAge</span><span> &lt;- </span><span class="identifier">validateAge</span><span>(</span><span class="identifier">age</span><span>)
    } </span><span class="keyword">yield</span><span> </span><span class="type-name">RegistrationData</span><span>(</span><span class="identifier">validatedUserName</span><span>, </span><span class="identifier">validatedPassword</span><span>, </span><span class="identifier">validatedFirstName</span><span>, </span><span class="identifier">validatedLastName</span><span>, </span><span class="identifier">validatedAge</span><span>)
  }

}

</span><span class="keyword">object</span><span> </span><span class="type-name">FormValidator</span><span> </span><span class="keyword">extends</span><span> </span><span class="type-name">FormValidator</span></code></pre>
        <p>The logic of the validation process is as follows: <strong>check every individual field based on the established rules for each one of them. If the validation is successful, then return the field wrapped in a <code>Right</code> instance; If not, then return a <code>DomainValidation</code> with the respective message, wrapped in a <code>Left</code> instance</strong>.
        Note that we took advantage of the <code>.cond</code> method of <code>Either</code>, that is equivalent to do <code>if (cond) Right(value) else Left(error)</code>.</p>
        <p>Our service has the <code>validateForm</code> method for checking all the fields and, if the process succeeds it will create an instance of <code>RegistrationData</code>, right?</p>
        <p>Well, yes, but the error reporting part will have the downside of showing only the first error.</p>
        <p>Let&#39;s look this in detail:</p>
        <pre class="keep-together pdf epub"><code class="nohighlight"><span class="keyword">for</span><span> {
  </span><span class="identifier">validatedUserName</span><span> &lt;- </span><span class="identifier">validateUserName</span><span>(</span><span class="identifier">username</span><span>)
  </span><span class="identifier">validatedPassword</span><span> &lt;- </span><span class="identifier">validatePassword</span><span>(</span><span class="identifier">password</span><span>)
  </span><span class="identifier">validatedFirstName</span><span> &lt;- </span><span class="identifier">validateFirstName</span><span>(</span><span class="identifier">firstName</span><span>)
  </span><span class="identifier">validatedLastName</span><span> &lt;- </span><span class="identifier">validateLastName</span><span>(</span><span class="identifier">lastName</span><span>)
  </span><span class="identifier">validatedAge</span><span> &lt;- </span><span class="identifier">validateAge</span><span>(</span><span class="identifier">age</span><span>)
} </span><span class="keyword">yield</span><span> </span><span class="type-name">RegistrationData</span><span>(</span><span class="identifier">validatedUserName</span><span>, </span><span class="identifier">validatedPassword</span><span>, </span><span class="identifier">validatedFirstName</span><span>, </span><span class="identifier">validatedLastName</span><span>, </span><span class="identifier">validatedAge</span><span>)</span></code></pre>
        <p>A for-comprehension is <em>fail-fast</em>. If some of the evaluations in the <code>for</code> block fails for some reason, the <code>yield</code> statement will not complete. In our case, if that happens we won&#39;t be getting the accumulated list of errors.</p>
        <p>If we run our code:</p>
        <pre class="keep-together pdf epub"><code class="nohighlight"><span class="type-name">FormValidator</span><span>.</span><span class="identifier">validateForm</span><span>(
  </span><span class="identifier">username</span><span> = </span><span class="string-literal">&quot;fakeUs3rname&quot;</span><span>,
  </span><span class="identifier">password</span><span> = </span><span class="string-literal">&quot;password&quot;</span><span>,
  </span><span class="identifier">firstName</span><span> = </span><span class="string-literal">&quot;John&quot;</span><span>,
  </span><span class="identifier">lastName</span><span> = </span><span class="string-literal">&quot;Doe&quot;</span><span>,
  </span><span class="identifier">age</span><span> = </span><span class="number-literal">15</span><span>
)
</span><span class="comment">// res1: Either[DomainValidation, RegistrationData] = Left(
//   PasswordDoesNotMeetCriteria
// )</span></code></pre>
        <p>We should have gotten another <code>DomainValidation</code> object denoting the invalid age.</p>
        
        <h3 id="an-iteration-with-validated" class="section">An iteration with <code>Validated</code><a class="anchor-link right" href="#an-iteration-with-validated"><i class="icofont-laika">&#xef71;</i></a></h3>
        <p>Time to do some refactoring! We&#39;re going to try a <code>Validated</code> approach:</p>
        <pre><code class="nohighlight"><span class="keyword">import</span><span> </span><span class="identifier">cats</span><span>.</span><span class="identifier">data</span><span>.</span><span class="identifier">_</span><span>
</span><span class="keyword">import</span><span> </span><span class="identifier">cats</span><span>.</span><span class="identifier">data</span><span>.</span><span class="type-name">Validated</span><span>.</span><span class="identifier">_</span><span>
</span><span class="keyword">import</span><span> </span><span class="identifier">cats</span><span>.</span><span class="identifier">implicits</span><span>.</span><span class="identifier">_</span><span>

</span><span class="keyword">def</span><span> </span><span class="declaration-name">validateUserName</span><span>(</span><span class="identifier">userName</span><span>: </span><span class="type-name">String</span><span>): </span><span class="type-name">Validated</span><span>[</span><span class="type-name">DomainValidation</span><span>, </span><span class="type-name">String</span><span>] = </span><span class="type-name">FormValidator</span><span>.</span><span class="identifier">validateUserName</span><span>(</span><span class="identifier">userName</span><span>).</span><span class="identifier">toValidated</span><span>

</span><span class="keyword">def</span><span> </span><span class="declaration-name">validatePassword</span><span>(</span><span class="identifier">password</span><span>: </span><span class="type-name">String</span><span>): </span><span class="type-name">Validated</span><span>[</span><span class="type-name">DomainValidation</span><span>, </span><span class="type-name">String</span><span>] = </span><span class="type-name">FormValidator</span><span>.</span><span class="identifier">validatePassword</span><span>(</span><span class="identifier">password</span><span>).</span><span class="identifier">toValidated</span><span>

</span><span class="keyword">def</span><span> </span><span class="declaration-name">validateFirstName</span><span>(</span><span class="identifier">firstName</span><span>: </span><span class="type-name">String</span><span>): </span><span class="type-name">Validated</span><span>[</span><span class="type-name">DomainValidation</span><span>, </span><span class="type-name">String</span><span>] = </span><span class="type-name">FormValidator</span><span>.</span><span class="identifier">validateFirstName</span><span>(</span><span class="identifier">firstName</span><span>).</span><span class="identifier">toValidated</span><span>

</span><span class="keyword">def</span><span> </span><span class="declaration-name">validateLastName</span><span>(</span><span class="identifier">lastName</span><span>: </span><span class="type-name">String</span><span>): </span><span class="type-name">Validated</span><span>[</span><span class="type-name">DomainValidation</span><span>, </span><span class="type-name">String</span><span>] = </span><span class="type-name">FormValidator</span><span>.</span><span class="identifier">validateLastName</span><span>(</span><span class="identifier">lastName</span><span>).</span><span class="identifier">toValidated</span><span>

</span><span class="keyword">def</span><span> </span><span class="declaration-name">validateAge</span><span>(</span><span class="identifier">age</span><span>: </span><span class="type-name">Int</span><span>): </span><span class="type-name">Validated</span><span>[</span><span class="type-name">DomainValidation</span><span>, </span><span class="type-name">Int</span><span>] = </span><span class="type-name">FormValidator</span><span>.</span><span class="identifier">validateAge</span><span>(</span><span class="identifier">age</span><span>).</span><span class="identifier">toValidated</span></code></pre>
        <pre><code class="nohighlight"><span class="keyword">def</span><span> </span><span class="declaration-name">validateForm</span><span>(</span><span class="identifier">username</span><span>: </span><span class="type-name">String</span><span>, </span><span class="identifier">password</span><span>: </span><span class="type-name">String</span><span>, </span><span class="identifier">firstName</span><span>: </span><span class="type-name">String</span><span>, </span><span class="identifier">lastName</span><span>: </span><span class="type-name">String</span><span>, </span><span class="identifier">age</span><span>: </span><span class="type-name">Int</span><span>): </span><span class="type-name">Validated</span><span>[</span><span class="type-name">DomainValidation</span><span>, </span><span class="type-name">RegistrationData</span><span>] = {
  </span><span class="keyword">for</span><span> {
    </span><span class="identifier">validatedUserName</span><span> &lt;- </span><span class="identifier">validateUserName</span><span>(</span><span class="identifier">username</span><span>)
    </span><span class="identifier">validatedPassword</span><span> &lt;- </span><span class="identifier">validatePassword</span><span>(</span><span class="identifier">password</span><span>)
    </span><span class="identifier">validatedFirstName</span><span> &lt;- </span><span class="identifier">validateFirstName</span><span>(</span><span class="identifier">firstName</span><span>)
    </span><span class="identifier">validatedLastName</span><span> &lt;- </span><span class="identifier">validateLastName</span><span>(</span><span class="identifier">lastName</span><span>)
    </span><span class="identifier">validatedAge</span><span> &lt;- </span><span class="identifier">validateAge</span><span>(</span><span class="identifier">age</span><span>)
  } </span><span class="keyword">yield</span><span> </span><span class="type-name">RegistrationData</span><span>(</span><span class="identifier">validatedUserName</span><span>, </span><span class="identifier">validatedPassword</span><span>, </span><span class="identifier">validatedFirstName</span><span>, </span><span class="identifier">validatedLastName</span><span>, </span><span class="identifier">validatedAge</span><span>)
}
</span><span class="comment">// error: value flatMap is not a member of cats.data.Validated[repl.MdocSession.App.DomainValidation,String]
//     validatedUserName &lt;- validateUserName(username)
//                          ^^^^^^^^^^^^^^^^^^^^^^^^^^
// error: value flatMap is not a member of cats.data.Validated[repl.MdocSession.App.DomainValidation,String]
//     validatedPassword &lt;- validatePassword(password)
//                          ^^^^^^^^^^^^^^^^^^^^^^^^^^
// error: value flatMap is not a member of cats.data.Validated[repl.MdocSession.App.DomainValidation,String]
//     validatedFirstName &lt;- validateFirstName(firstName)
//                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
// error: value flatMap is not a member of cats.data.Validated[repl.MdocSession.App.DomainValidation,String]
//     validatedLastName &lt;- validateLastName(lastName)
//                          ^^^^^^^^^^^^^^^^^^^^^^^^^^</span></code></pre>
        <p>What we&#39;ve done here was to reuse the previously created validation functions and convert their output to a <code>Validated</code> instance with the <code>.toValidated</code> combinator. This one takes an <code>Either</code> and converts it to its equivalent <code>Validated</code>.
        This datatype, as with <code>Either</code> has two projections: <code>Valid</code> and <code>Invalid</code>, analogous to <code>Right</code> and <code>Left</code>, respectively.</p>
        <p>Remember that our goal is to get all the validation errors for displaying it to the user, but you&#39;ll find that this approach won&#39;t compile, as you can see in the previous snippet. Why?</p>
        <p>Without diving into details about monads, a for-comprehension uses the <code>flatMap</code> method for composition. Monads like <code>Either</code> can be composed in that way, but the thing with <code>Validated</code> is that it isn&#39;t a monad, but an <a href="../typeclasses/applicativetraverse.html"><em>Applicative Functor</em></a>.
        That&#39;s why you see the message: <code>error: value flatMap is not a member of cats.data.Validated[DomainValidation,String]</code>.</p>
        <p>So, how do we do here?</p>
        
        <h3 id="meeting-applicative" class="section">Meeting applicative<a class="anchor-link right" href="#meeting-applicative"><i class="icofont-laika">&#xef71;</i></a></h3>
        <p>We have to look into another direction: a for-comprehension plays well in a fail-fast scenario, but the structure in our previous example was designed to catch one error at a time, so, our next step is to tweak the implementation a bit.</p>
        <pre><code class="nohighlight"><span class="keyword">sealed</span><span> </span><span class="keyword">trait</span><span> </span><span class="type-name">FormValidatorNec</span><span> {

  </span><span class="keyword">type</span><span> </span><span class="type-name">ValidationResult</span><span>[</span><span class="type-name">A</span><span>] = </span><span class="type-name">ValidatedNec</span><span>[</span><span class="type-name">DomainValidation</span><span>, </span><span class="type-name">A</span><span>]

  </span><span class="keyword">private</span><span> </span><span class="keyword">def</span><span> </span><span class="declaration-name">validateUserName</span><span>(</span><span class="identifier">userName</span><span>: </span><span class="type-name">String</span><span>): </span><span class="type-name">ValidationResult</span><span>[</span><span class="type-name">String</span><span>] =
    </span><span class="keyword">if</span><span> (</span><span class="identifier">userName</span><span>.</span><span class="identifier">matches</span><span>(</span><span class="string-literal">&quot;^[a-zA-Z0-9]+$&quot;</span><span>)) </span><span class="identifier">userName</span><span>.</span><span class="identifier">validNec</span><span> </span><span class="keyword">else</span><span> </span><span class="type-name">UsernameHasSpecialCharacters</span><span>.</span><span class="identifier">invalidNec</span><span>

  </span><span class="keyword">private</span><span> </span><span class="keyword">def</span><span> </span><span class="declaration-name">validatePassword</span><span>(</span><span class="identifier">password</span><span>: </span><span class="type-name">String</span><span>): </span><span class="type-name">ValidationResult</span><span>[</span><span class="type-name">String</span><span>] =
    </span><span class="keyword">if</span><span> (</span><span class="identifier">password</span><span>.</span><span class="identifier">matches</span><span>(</span><span class="string-literal">&quot;(?=^.{10,}$)((?=.*</span><span class="escape-sequence">\\</span><span class="string-literal">d)|(?=.*</span><span class="escape-sequence">\\</span><span class="string-literal">W+))(?![.</span><span class="escape-sequence">\\</span><span class="string-literal">n])(?=.*[A-Z])(?=.*[a-z]).*$&quot;</span><span>)) </span><span class="identifier">password</span><span>.</span><span class="identifier">validNec</span><span>
    </span><span class="keyword">else</span><span> </span><span class="type-name">PasswordDoesNotMeetCriteria</span><span>.</span><span class="identifier">invalidNec</span><span>

  </span><span class="keyword">private</span><span> </span><span class="keyword">def</span><span> </span><span class="declaration-name">validateFirstName</span><span>(</span><span class="identifier">firstName</span><span>: </span><span class="type-name">String</span><span>): </span><span class="type-name">ValidationResult</span><span>[</span><span class="type-name">String</span><span>] =
    </span><span class="keyword">if</span><span> (</span><span class="identifier">firstName</span><span>.</span><span class="identifier">matches</span><span>(</span><span class="string-literal">&quot;^[a-zA-Z]+$&quot;</span><span>)) </span><span class="identifier">firstName</span><span>.</span><span class="identifier">validNec</span><span> </span><span class="keyword">else</span><span> </span><span class="type-name">FirstNameHasSpecialCharacters</span><span>.</span><span class="identifier">invalidNec</span><span>

  </span><span class="keyword">private</span><span> </span><span class="keyword">def</span><span> </span><span class="declaration-name">validateLastName</span><span>(</span><span class="identifier">lastName</span><span>: </span><span class="type-name">String</span><span>): </span><span class="type-name">ValidationResult</span><span>[</span><span class="type-name">String</span><span>] =
    </span><span class="keyword">if</span><span> (</span><span class="identifier">lastName</span><span>.</span><span class="identifier">matches</span><span>(</span><span class="string-literal">&quot;^[a-zA-Z]+$&quot;</span><span>)) </span><span class="identifier">lastName</span><span>.</span><span class="identifier">validNec</span><span> </span><span class="keyword">else</span><span> </span><span class="type-name">LastNameHasSpecialCharacters</span><span>.</span><span class="identifier">invalidNec</span><span>

  </span><span class="keyword">private</span><span> </span><span class="keyword">def</span><span> </span><span class="declaration-name">validateAge</span><span>(</span><span class="identifier">age</span><span>: </span><span class="type-name">Int</span><span>): </span><span class="type-name">ValidationResult</span><span>[</span><span class="type-name">Int</span><span>] =
    </span><span class="keyword">if</span><span> (</span><span class="identifier">age</span><span> &gt;= </span><span class="number-literal">18</span><span> &amp;&amp; </span><span class="identifier">age</span><span> &lt;= </span><span class="number-literal">75</span><span>) </span><span class="identifier">age</span><span>.</span><span class="identifier">validNec</span><span> </span><span class="keyword">else</span><span> </span><span class="type-name">AgeIsInvalid</span><span>.</span><span class="identifier">invalidNec</span><span>

  </span><span class="keyword">def</span><span> </span><span class="declaration-name">validateForm</span><span>(</span><span class="identifier">username</span><span>: </span><span class="type-name">String</span><span>, </span><span class="identifier">password</span><span>: </span><span class="type-name">String</span><span>, </span><span class="identifier">firstName</span><span>: </span><span class="type-name">String</span><span>, </span><span class="identifier">lastName</span><span>: </span><span class="type-name">String</span><span>, </span><span class="identifier">age</span><span>: </span><span class="type-name">Int</span><span>): </span><span class="type-name">ValidationResult</span><span>[</span><span class="type-name">RegistrationData</span><span>] = {
    (</span><span class="identifier">validateUserName</span><span>(</span><span class="identifier">username</span><span>),
    </span><span class="identifier">validatePassword</span><span>(</span><span class="identifier">password</span><span>),
    </span><span class="identifier">validateFirstName</span><span>(</span><span class="identifier">firstName</span><span>),
    </span><span class="identifier">validateLastName</span><span>(</span><span class="identifier">lastName</span><span>),
    </span><span class="identifier">validateAge</span><span>(</span><span class="identifier">age</span><span>)).</span><span class="identifier">mapN</span><span>(</span><span class="type-name">RegistrationData</span><span>)
  }

}

</span><span class="keyword">object</span><span> </span><span class="type-name">FormValidatorNec</span><span> </span><span class="keyword">extends</span><span> </span><span class="type-name">FormValidatorNec</span></code></pre>
        <p>Let&#39;s see what changed here:</p>
        <ol class="arabic">
          <li>In this new implementation, we&#39;re using a <a href="https://github.com/typelevel/cats/blob/main/core/src/main/scala/cats/data/NonEmptyChain.scala">NonEmptyChain</a>, a data structure that guarantees that at least one element will be present. In case that multiple errors arise, you&#39;ll get a chain of <code>DomainValidation</code>.</li>
          <li><code>ValidatedNec[DomainValidation, A]</code> is an alias for <code>Validated[NonEmptyChain[DomainValidation], A]</code>. When you use <code>ValidatedNec</code> you&#39;re stating that your accumulative structure will be a <code>NonEmptyChain</code>. With <code>Validated</code>, you have the choice about which data structure you want for reporting the errors (more on that soon).</li>
          <li>We&#39;ve declared the type alias <code>ValidationResult</code> that conveniently expresses the return type of our validation.</li>
          <li><code>.validNec</code> and <code>.invalidNec</code> combinators lets you <em>lift</em> the success or failure in their respective container (either a <code>Valid</code> or <code>Invalid[NonEmptyChain[A]]</code>).</li>
          <li>The <a href="../typeclasses/applicative.html">applicative</a> syntax <code>(a, b, c, ...).mapN(...)</code> provides us a way to accumulatively apply the validation functions and yield a product with their successful result or the accumulated errors in the <code>NonEmptyChain</code>. Then, we transform that product with <code>mapN</code> into a valid instance of <code>RegistrationData</code>.</li>
        </ol>
        <p><strong>Deprecation notice:</strong> since Cats <code>1.0.0-MF</code> the cartesian syntax <code>|@|</code> for applicatives is deprecated. If you&#39;re using <code>0.9.0</code> or less, you can use the syntax: <code>(a |@| b |@| ...).map(...)</code>.</p>
        <p>Note that, at the end, we expect to lift the result of the validation functions in a <code>RegistrationData</code> instance. If the process fails, we&#39;ll get our <code>NonEmptyChain</code> detailing what went wrong.</p>
        <p>For example:</p>
        <pre><code class="nohighlight"><span class="type-name">FormValidatorNec</span><span>.</span><span class="identifier">validateForm</span><span>(
  </span><span class="identifier">username</span><span> = </span><span class="string-literal">&quot;Joe&quot;</span><span>,
  </span><span class="identifier">password</span><span> = </span><span class="string-literal">&quot;Passw0r$1234&quot;</span><span>,
  </span><span class="identifier">firstName</span><span> = </span><span class="string-literal">&quot;John&quot;</span><span>,
  </span><span class="identifier">lastName</span><span> = </span><span class="string-literal">&quot;Doe&quot;</span><span>,
  </span><span class="identifier">age</span><span> = </span><span class="number-literal">21</span><span>
)
</span><span class="comment">// res3: FormValidatorNec.ValidationResult[RegistrationData] = Valid(
//   RegistrationData(&quot;Joe&quot;, &quot;Passw0r$1234&quot;, &quot;John&quot;, &quot;Doe&quot;, 21)
// )
</span><span>
</span><span class="type-name">FormValidatorNec</span><span>.</span><span class="identifier">validateForm</span><span>(
  </span><span class="identifier">username</span><span> = </span><span class="string-literal">&quot;Joe%%%&quot;</span><span>,
  </span><span class="identifier">password</span><span> = </span><span class="string-literal">&quot;password&quot;</span><span>,
  </span><span class="identifier">firstName</span><span> = </span><span class="string-literal">&quot;John&quot;</span><span>,
  </span><span class="identifier">lastName</span><span> = </span><span class="string-literal">&quot;Doe&quot;</span><span>,
  </span><span class="identifier">age</span><span> = </span><span class="number-literal">21</span><span>
)
</span><span class="comment">// res4: FormValidatorNec.ValidationResult[RegistrationData] = Invalid(
//   Append(
//     Singleton(UsernameHasSpecialCharacters),
//     Singleton(PasswordDoesNotMeetCriteria)
//   )
// )</span></code></pre>
        <p>Sweet success! Now you can take your validation process to the next level!</p>
        
        <h3 id="a-short-detour" class="section">A short detour<a class="anchor-link right" href="#a-short-detour"><i class="icofont-laika">&#xef71;</i></a></h3>
        <p>As previously stated, <code>ValidatedNec[DomainValidation, A]</code> is an alias for <code>Validated[NonEmptyChain[DomainValidation], A]</code>. Typically, you&#39;ll see that <code>Validated</code> is accompanied by a <code>NonEmptyChain</code> when it comes to accumulation. The thing here is that you can define your own accumulative data structure and you&#39;re not limited to the aforementioned construction.</p>
        <p>For doing this, you have to provide a <code>Semigroup</code> instance. <code>NonEmptyChain</code>, by definition has its own <code>Semigroup</code>. For those who don&#39;t know what a <code>Semigroup</code> is, you can find out more <a href="../typeclasses/semigroup.html">here</a>.</p>
        
        <h4 id="accumulative-structures" class="section">Accumulative Structures<a class="anchor-link right" href="#accumulative-structures"><i class="icofont-laika">&#xef71;</i></a></h4>
        <p>Let&#39;s take a look about how a <code>Semigroup</code> works in a <code>NonEmptyChain</code>:</p>
        <pre class="keep-together pdf epub"><code class="nohighlight"><span class="type-name">NonEmptyChain</span><span>.</span><span class="identifier">one</span><span>[</span><span class="type-name">DomainValidation</span><span>](</span><span class="type-name">UsernameHasSpecialCharacters</span><span>) |+| </span><span class="type-name">NonEmptyChain</span><span>[</span><span class="type-name">DomainValidation</span><span>](</span><span class="type-name">FirstNameHasSpecialCharacters</span><span>, </span><span class="type-name">LastNameHasSpecialCharacters</span><span>)
</span><span class="comment">// res5: NonEmptyChain[DomainValidation] = Append(
//   Singleton(UsernameHasSpecialCharacters),
//   Append(
//     Singleton(FirstNameHasSpecialCharacters),
//     Singleton(LastNameHasSpecialCharacters)
//   )
// )</span></code></pre>
        <p>We&#39;re combining a couple of <code>NonEmptyChain</code>s. The first one has its mandatory element (note that we&#39;ve built an instance of it with <code>.one</code>) and the second has a couple of elements. As you can see, the output of the combination, expressed by the <code>|+|</code> operator is another <code>NonEmptyChain</code> with the three elements.</p>
        <p>But, what about if we want <em>another</em> way of combining? We can provide our custom <code>Semigroup</code> instance with the desired combining logic and pass it implicitly to your scope.</p>
        
        <h3 id="going-back-and-forth" class="section">Going back and forth<a class="anchor-link right" href="#going-back-and-forth"><i class="icofont-laika">&#xef71;</i></a></h3>
        <p>Cats offers you a nice set of combinators for transforming your <code>Validated</code> based approach to an <code>Either</code> one and vice-versa.
        We&#39;ve used <code>.toValidated</code> in our second example, now let&#39;s see how to use <code>.toEither</code>.</p>
        
        <h4 id="from-validated-to-either" class="section">From <code>Validated</code> to <code>Either</code><a class="anchor-link right" href="#from-validated-to-either"><i class="icofont-laika">&#xef71;</i></a></h4>
        <p>To do this, simply use <code>.toEither</code> combinator:</p>
        <pre><code class="nohighlight"><span class="comment">// Successful case
</span><span class="type-name">FormValidatorNec</span><span>.</span><span class="identifier">validateForm</span><span>(
  </span><span class="identifier">username</span><span> = </span><span class="string-literal">&quot;Joe&quot;</span><span>,
  </span><span class="identifier">password</span><span> = </span><span class="string-literal">&quot;Passw0r$1234&quot;</span><span>,
  </span><span class="identifier">firstName</span><span> = </span><span class="string-literal">&quot;John&quot;</span><span>,
  </span><span class="identifier">lastName</span><span> = </span><span class="string-literal">&quot;Doe&quot;</span><span>,
  </span><span class="identifier">age</span><span> = </span><span class="number-literal">21</span><span>
).</span><span class="identifier">toEither</span><span>
</span><span class="comment">// res6: Either[NonEmptyChain[DomainValidation], RegistrationData] = Right(
//   RegistrationData(&quot;Joe&quot;, &quot;Passw0r$1234&quot;, &quot;John&quot;, &quot;Doe&quot;, 21)
// )
</span><span>
</span><span class="comment">// Invalid case
</span><span class="type-name">FormValidatorNec</span><span>.</span><span class="identifier">validateForm</span><span>(
  </span><span class="identifier">username</span><span> = </span><span class="string-literal">&quot;Joe123#&quot;</span><span>,
  </span><span class="identifier">password</span><span> = </span><span class="string-literal">&quot;password&quot;</span><span>,
  </span><span class="identifier">firstName</span><span> = </span><span class="string-literal">&quot;John&quot;</span><span>,
  </span><span class="identifier">lastName</span><span> = </span><span class="string-literal">&quot;Doe&quot;</span><span>,
  </span><span class="identifier">age</span><span> = </span><span class="number-literal">5</span><span>
).</span><span class="identifier">toEither</span><span>
</span><span class="comment">// res7: Either[NonEmptyChain[DomainValidation], RegistrationData] = Left(
//   Append(
//     Singleton(UsernameHasSpecialCharacters),
//     Append(Singleton(PasswordDoesNotMeetCriteria), Singleton(AgeIsInvalid))
//   )
// )</span></code></pre>
        <p>With this conversion, as you can see, we got an <code>Either</code> with a <code>NonEmptyChain</code> detailing the possible validation errors or our <code>RegistrationData</code> object.</p>
        
        <h2 id="another-case" class="section">Another case<a class="anchor-link right" href="#another-case"><i class="icofont-laika">&#xef71;</i></a></h2>
        <p>Perhaps you&#39;re reading from a configuration file. One could imagine the configuration library you&#39;re using returns
        a <code>scala.util.Try</code>, or maybe a <code>scala.util.Either</code>. Your parsing may look something like:</p>
        <pre class="keep-together pdf epub"><code class="nohighlight"><span class="keyword">for</span><span> {
  </span><span class="identifier">url</span><span>  &lt;- </span><span class="identifier">config</span><span>[</span><span class="type-name">String</span><span>](</span><span class="string-literal">&quot;url&quot;</span><span>)
  </span><span class="identifier">port</span><span> &lt;- </span><span class="identifier">config</span><span>[</span><span class="type-name">Int</span><span>](</span><span class="string-literal">&quot;port&quot;</span><span>)
} </span><span class="keyword">yield</span><span> </span><span class="type-name">ConnectionParams</span><span>(</span><span class="identifier">url</span><span>, </span><span class="identifier">port</span><span>)</span></code></pre>
        <p>You run your program and it says key &quot;url&quot; not found, turns out the key was &quot;endpoint&quot;. So you change your code
        and re-run. Now it says the &quot;port&quot; key was not a well-formed integer.</p>
        
        <h2 id="parallel-validation" class="section">Parallel validation<a class="anchor-link right" href="#parallel-validation"><i class="icofont-laika">&#xef71;</i></a></h2>
        <p>Our goal is to report any and all errors across independent bits of data. For instance, when we ask for several
        pieces of configuration, each configuration field can be validated separately from one another. How then do we
        enforce that the data we are working with is independent? We ask for both of them up front.</p>
        <p>As our running example, we will look at config parsing. Our config will be represented by a
        <code>Map[String, String]</code>. Parsing will be handled by a <code>Read</code> type class - we provide instances
        just for <code>String</code> and <code>Int</code> for brevity.</p>
        <pre><code class="nohighlight"><span class="keyword">trait</span><span> </span><span class="type-name">Read</span><span>[</span><span class="type-name">A</span><span>] {
  </span><span class="keyword">def</span><span> </span><span class="declaration-name">read</span><span>(</span><span class="identifier">s</span><span>: </span><span class="type-name">String</span><span>): </span><span class="type-name">Option</span><span>[</span><span class="type-name">A</span><span>]
}

</span><span class="keyword">object</span><span> </span><span class="type-name">Read</span><span> {
  </span><span class="keyword">def</span><span> </span><span class="declaration-name">apply</span><span>[</span><span class="type-name">A</span><span>](</span><span class="keyword">implicit</span><span> </span><span class="type-name">A</span><span>: </span><span class="type-name">Read</span><span>[</span><span class="type-name">A</span><span>]): </span><span class="type-name">Read</span><span>[</span><span class="type-name">A</span><span>] = </span><span class="type-name">A</span><span>

  </span><span class="keyword">implicit</span><span> </span><span class="keyword">val</span><span> </span><span class="identifier">stringRead</span><span>: </span><span class="type-name">Read</span><span>[</span><span class="type-name">String</span><span>] =
    </span><span class="keyword">new</span><span> </span><span class="type-name">Read</span><span>[</span><span class="type-name">String</span><span>] { </span><span class="keyword">def</span><span> </span><span class="declaration-name">read</span><span>(</span><span class="identifier">s</span><span>: </span><span class="type-name">String</span><span>): </span><span class="type-name">Option</span><span>[</span><span class="type-name">String</span><span>] = </span><span class="type-name">Some</span><span>(</span><span class="identifier">s</span><span>) }

  </span><span class="keyword">implicit</span><span> </span><span class="keyword">val</span><span> </span><span class="identifier">intRead</span><span>: </span><span class="type-name">Read</span><span>[</span><span class="type-name">Int</span><span>] =
    </span><span class="keyword">new</span><span> </span><span class="type-name">Read</span><span>[</span><span class="type-name">Int</span><span>] {
      </span><span class="keyword">def</span><span> </span><span class="declaration-name">read</span><span>(</span><span class="identifier">s</span><span>: </span><span class="type-name">String</span><span>): </span><span class="type-name">Option</span><span>[</span><span class="type-name">Int</span><span>] =
        </span><span class="keyword">if</span><span> (</span><span class="identifier">s</span><span>.</span><span class="identifier">matches</span><span>(</span><span class="string-literal">&quot;-?[0-9]+&quot;</span><span>)) </span><span class="type-name">Some</span><span>(</span><span class="identifier">s</span><span>.</span><span class="identifier">toInt</span><span>)
        </span><span class="keyword">else</span><span> </span><span class="type-name">None</span><span>
    }
}</span></code></pre>
        <p>Then we enumerate our errors - when asking for a config value, one of two things can
        go wrong: the field is missing, or it is not well-formed with regards to the expected
        type.</p>
        <pre class="keep-together pdf epub"><code class="nohighlight"><span class="keyword">sealed</span><span> </span><span class="keyword">abstract</span><span> </span><span class="keyword">class</span><span> </span><span class="type-name">ConfigError</span><span>
</span><span class="keyword">final</span><span> </span><span class="keyword">case</span><span> </span><span class="keyword">class</span><span> </span><span class="type-name">MissingConfig</span><span>(</span><span class="identifier">field</span><span>: </span><span class="type-name">String</span><span>) </span><span class="keyword">extends</span><span> </span><span class="type-name">ConfigError</span><span>
</span><span class="keyword">final</span><span> </span><span class="keyword">case</span><span> </span><span class="keyword">class</span><span> </span><span class="type-name">ParseError</span><span>(</span><span class="identifier">field</span><span>: </span><span class="type-name">String</span><span>) </span><span class="keyword">extends</span><span> </span><span class="type-name">ConfigError</span></code></pre>
        <p>We need a data type that can represent either a successful value (a parsed configuration),
        or an error.</p>
        <pre class="keep-together pdf epub"><code class="nohighlight"><span class="keyword">sealed</span><span> </span><span class="keyword">abstract</span><span> </span><span class="keyword">class</span><span> </span><span class="type-name">Validated</span><span>[+</span><span class="type-name">E</span><span>, +</span><span class="type-name">A</span><span>]

</span><span class="keyword">object</span><span> </span><span class="type-name">Validated</span><span> {
  </span><span class="keyword">final</span><span> </span><span class="keyword">case</span><span> </span><span class="keyword">class</span><span> </span><span class="type-name">Valid</span><span>[+</span><span class="type-name">A</span><span>](</span><span class="identifier">a</span><span>: </span><span class="type-name">A</span><span>) </span><span class="keyword">extends</span><span> </span><span class="type-name">Validated</span><span>[</span><span class="type-name">Nothing</span><span>, </span><span class="type-name">A</span><span>]
  </span><span class="keyword">final</span><span> </span><span class="keyword">case</span><span> </span><span class="keyword">class</span><span> </span><span class="type-name">Invalid</span><span>[+</span><span class="type-name">E</span><span>](</span><span class="identifier">e</span><span>: </span><span class="type-name">E</span><span>) </span><span class="keyword">extends</span><span> </span><span class="type-name">Validated</span><span>[</span><span class="type-name">E</span><span>, </span><span class="type-name">Nothing</span><span>]
}</span></code></pre>
        <p>Now we are ready to write our parser.</p>
        <pre><code class="nohighlight"><span class="keyword">import</span><span> </span><span class="identifier">cats</span><span>.</span><span class="identifier">data</span><span>.</span><span class="type-name">Validated</span><span>
</span><span class="keyword">import</span><span> </span><span class="identifier">cats</span><span>.</span><span class="identifier">data</span><span>.</span><span class="type-name">Validated</span><span>.{</span><span class="type-name">Invalid</span><span>, </span><span class="type-name">Valid</span><span>}

</span><span class="keyword">case</span><span> </span><span class="keyword">class</span><span> </span><span class="type-name">Config</span><span>(</span><span class="identifier">map</span><span>: </span><span class="type-name">Map</span><span>[</span><span class="type-name">String</span><span>, </span><span class="type-name">String</span><span>]) {
  </span><span class="keyword">def</span><span> </span><span class="declaration-name">parse</span><span>[</span><span class="type-name">A</span><span> : </span><span class="type-name">Read</span><span>](</span><span class="identifier">key</span><span>: </span><span class="type-name">String</span><span>): </span><span class="type-name">Validated</span><span>[</span><span class="type-name">ConfigError</span><span>, </span><span class="type-name">A</span><span>] =
    </span><span class="identifier">map</span><span>.</span><span class="identifier">get</span><span>(</span><span class="identifier">key</span><span>) </span><span class="keyword">match</span><span> {
      </span><span class="keyword">case</span><span> </span><span class="type-name">None</span><span>        =&gt; </span><span class="type-name">Invalid</span><span>(</span><span class="type-name">MissingConfig</span><span>(</span><span class="identifier">key</span><span>))
      </span><span class="keyword">case</span><span> </span><span class="type-name">Some</span><span>(</span><span class="identifier">value</span><span>) =&gt;
        </span><span class="type-name">Read</span><span>[</span><span class="type-name">A</span><span>].</span><span class="identifier">read</span><span>(</span><span class="identifier">value</span><span>) </span><span class="keyword">match</span><span> {
          </span><span class="keyword">case</span><span> </span><span class="type-name">None</span><span>    =&gt; </span><span class="type-name">Invalid</span><span>(</span><span class="type-name">ParseError</span><span>(</span><span class="identifier">key</span><span>))
          </span><span class="keyword">case</span><span> </span><span class="type-name">Some</span><span>(</span><span class="identifier">a</span><span>) =&gt; </span><span class="type-name">Valid</span><span>(</span><span class="identifier">a</span><span>)
        }
    }
}</span></code></pre>
        <p>Everything is in place to write the parallel validator. Recall that we can only do parallel
        validation if each piece is independent. How do we enforce the data is independent? By asking
        for all of it up front. Let&#39;s start with two pieces of data.</p>
        <pre class="keep-together pdf epub"><code class="nohighlight"><span class="keyword">def</span><span> </span><span class="declaration-name">parallelValidateSimple</span><span>[</span><span class="type-name">E</span><span>, </span><span class="type-name">A</span><span>, </span><span class="type-name">B</span><span>, </span><span class="type-name">C</span><span>](</span><span class="identifier">v1</span><span>: </span><span class="type-name">Validated</span><span>[</span><span class="type-name">E</span><span>, </span><span class="type-name">A</span><span>], </span><span class="identifier">v2</span><span>: </span><span class="type-name">Validated</span><span>[</span><span class="type-name">E</span><span>, </span><span class="type-name">B</span><span>])(</span><span class="identifier">f</span><span>: (</span><span class="type-name">A</span><span>, </span><span class="type-name">B</span><span>) =&gt; </span><span class="type-name">C</span><span>): </span><span class="type-name">Validated</span><span>[</span><span class="type-name">E</span><span>, </span><span class="type-name">C</span><span>] =
  (</span><span class="identifier">v1</span><span>, </span><span class="identifier">v2</span><span>) </span><span class="keyword">match</span><span> {
    </span><span class="keyword">case</span><span> (</span><span class="type-name">Valid</span><span>(</span><span class="identifier">a</span><span>), </span><span class="type-name">Valid</span><span>(</span><span class="identifier">b</span><span>))       =&gt; </span><span class="type-name">Valid</span><span>(</span><span class="identifier">f</span><span>(</span><span class="identifier">a</span><span>, </span><span class="identifier">b</span><span>))
    </span><span class="keyword">case</span><span> (</span><span class="type-name">Valid</span><span>(</span><span class="identifier">_</span><span>), </span><span class="identifier">i</span><span class="annotation">@Invalid</span><span>(</span><span class="identifier">_</span><span>))   =&gt; </span><span class="identifier">i</span><span>
    </span><span class="keyword">case</span><span> (</span><span class="identifier">i</span><span class="annotation">@Invalid</span><span>(</span><span class="identifier">_</span><span>), </span><span class="type-name">Valid</span><span>(</span><span class="identifier">_</span><span>))   =&gt; </span><span class="identifier">i</span><span>
    </span><span class="keyword">case</span><span> (</span><span class="type-name">Invalid</span><span>(</span><span class="identifier">e1</span><span>), </span><span class="type-name">Invalid</span><span>(</span><span class="identifier">e2</span><span>)) =&gt; ???
  }</span></code></pre>
        <p>We&#39;ve run into a problem. In the case where both have errors, we want to report both. But we have
        no way of combining the two errors into one error! Perhaps we can put both errors into a <code>Chain</code>,
        but that seems needlessly specific - clients may want to define their own way of combining errors.</p>
        <p>How then do we abstract over a binary operation? The <code>Semigroup</code> type class captures this idea.</p>
        <pre class="keep-together pdf epub"><code class="nohighlight"><span class="keyword">import</span><span> </span><span class="identifier">cats</span><span>.</span><span class="type-name">Semigroup</span><span>

</span><span class="keyword">def</span><span> </span><span class="declaration-name">parallelValidate</span><span>[</span><span class="type-name">E</span><span> : </span><span class="type-name">Semigroup</span><span>, </span><span class="type-name">A</span><span>, </span><span class="type-name">B</span><span>, </span><span class="type-name">C</span><span>](</span><span class="identifier">v1</span><span>: </span><span class="type-name">Validated</span><span>[</span><span class="type-name">E</span><span>, </span><span class="type-name">A</span><span>], </span><span class="identifier">v2</span><span>: </span><span class="type-name">Validated</span><span>[</span><span class="type-name">E</span><span>, </span><span class="type-name">B</span><span>])(</span><span class="identifier">f</span><span>: (</span><span class="type-name">A</span><span>, </span><span class="type-name">B</span><span>) =&gt; </span><span class="type-name">C</span><span>): </span><span class="type-name">Validated</span><span>[</span><span class="type-name">E</span><span>, </span><span class="type-name">C</span><span>] =
  (</span><span class="identifier">v1</span><span>, </span><span class="identifier">v2</span><span>) </span><span class="keyword">match</span><span> {
    </span><span class="keyword">case</span><span> (</span><span class="type-name">Valid</span><span>(</span><span class="identifier">a</span><span>), </span><span class="type-name">Valid</span><span>(</span><span class="identifier">b</span><span>))       =&gt; </span><span class="type-name">Valid</span><span>(</span><span class="identifier">f</span><span>(</span><span class="identifier">a</span><span>, </span><span class="identifier">b</span><span>))
    </span><span class="keyword">case</span><span> (</span><span class="type-name">Valid</span><span>(</span><span class="identifier">_</span><span>), </span><span class="identifier">i</span><span class="annotation">@Invalid</span><span>(</span><span class="identifier">_</span><span>))   =&gt; </span><span class="identifier">i</span><span>
    </span><span class="keyword">case</span><span> (</span><span class="identifier">i</span><span class="annotation">@Invalid</span><span>(</span><span class="identifier">_</span><span>), </span><span class="type-name">Valid</span><span>(</span><span class="identifier">_</span><span>))   =&gt; </span><span class="identifier">i</span><span>
    </span><span class="keyword">case</span><span> (</span><span class="type-name">Invalid</span><span>(</span><span class="identifier">e1</span><span>), </span><span class="type-name">Invalid</span><span>(</span><span class="identifier">e2</span><span>)) =&gt; </span><span class="type-name">Invalid</span><span>(</span><span class="type-name">Semigroup</span><span>[</span><span class="type-name">E</span><span>].</span><span class="identifier">combine</span><span>(</span><span class="identifier">e1</span><span>, </span><span class="identifier">e2</span><span>))
  }</span></code></pre>
        <p>Perfect! But.. going back to our example, we don&#39;t have a way to combine <code>ConfigError</code>s. But as clients,
        we can change our <code>Validated</code> values where the error can be combined, say, a <code>Chain[ConfigError]</code>. It is
        more common however to use a <code>NonEmptyChain[ConfigError]</code> - the <code>NonEmptyChain</code> statically guarantees we
        have at least one value, which aligns with the fact that if we have an <code>Invalid</code>, then we most
        certainly have at least one error. This technique is so common there is a convenient method on <code>Validated</code>
        called <code>toValidatedNec</code> that turns any <code>Validated[E, A]</code> value to a <code>Validated[NonEmptyChain[E], A]</code>.
        Additionally, the type alias <code>ValidatedNec[E, A]</code> is provided.</p>
        <p>Time to parse.</p>
        <pre><code class="nohighlight"><span class="keyword">import</span><span> </span><span class="identifier">cats</span><span>.</span><span class="type-name">SemigroupK</span><span>
</span><span class="keyword">import</span><span> </span><span class="identifier">cats</span><span>.</span><span class="identifier">data</span><span>.</span><span class="type-name">NonEmptyChain</span><span>
</span><span class="keyword">import</span><span> </span><span class="identifier">cats</span><span>.</span><span class="identifier">implicits</span><span>.</span><span class="identifier">_</span><span>

</span><span class="keyword">case</span><span> </span><span class="keyword">class</span><span> </span><span class="type-name">ConnectionParams</span><span>(</span><span class="identifier">url</span><span>: </span><span class="type-name">String</span><span>, </span><span class="identifier">port</span><span>: </span><span class="type-name">Int</span><span>)

</span><span class="keyword">val</span><span> </span><span class="identifier">config</span><span> = </span><span class="type-name">Config</span><span>(</span><span class="type-name">Map</span><span>((</span><span class="string-literal">&quot;endpoint&quot;</span><span>, </span><span class="string-literal">&quot;127.0.0.1&quot;</span><span>), (</span><span class="string-literal">&quot;port&quot;</span><span>, </span><span class="string-literal">&quot;not an int&quot;</span><span>)))

</span><span class="keyword">implicit</span><span> </span><span class="keyword">val</span><span> </span><span class="identifier">necSemigroup</span><span>: </span><span class="type-name">Semigroup</span><span>[</span><span class="type-name">NonEmptyChain</span><span>[</span><span class="type-name">ConfigError</span><span>]] =
  </span><span class="type-name">SemigroupK</span><span>[</span><span class="type-name">NonEmptyChain</span><span>].</span><span class="identifier">algebra</span><span>[</span><span class="type-name">ConfigError</span><span>]

</span><span class="keyword">implicit</span><span> </span><span class="keyword">val</span><span> </span><span class="identifier">readString</span><span>: </span><span class="type-name">Read</span><span>[</span><span class="type-name">String</span><span>] = </span><span class="type-name">Read</span><span>.</span><span class="identifier">stringRead</span><span>
</span><span class="keyword">implicit</span><span> </span><span class="keyword">val</span><span> </span><span class="identifier">readInt</span><span>: </span><span class="type-name">Read</span><span>[</span><span class="type-name">Int</span><span>] = </span><span class="type-name">Read</span><span>.</span><span class="identifier">intRead</span></code></pre>
        <p>Any and all errors are reported!</p>
        <pre class="keep-together pdf epub"><code class="nohighlight"><span class="keyword">val</span><span> </span><span class="identifier">v1</span><span> = </span><span class="identifier">parallelValidate</span><span>(</span><span class="identifier">config</span><span>.</span><span class="identifier">parse</span><span>[</span><span class="type-name">String</span><span>](</span><span class="string-literal">&quot;url&quot;</span><span>).</span><span class="identifier">toValidatedNec</span><span>,
                          </span><span class="identifier">config</span><span>.</span><span class="identifier">parse</span><span>[</span><span class="type-name">Int</span><span>](</span><span class="string-literal">&quot;port&quot;</span><span>).</span><span class="identifier">toValidatedNec</span><span>)(</span><span class="type-name">ConnectionParams</span><span>.</span><span class="identifier">apply</span><span>)
</span><span class="comment">// v1: Validated[NonEmptyChain[ConfigError], ConnectionParams] = Invalid(
//   Append(Singleton(MissingConfig(&quot;url&quot;)), Singleton(ParseError(&quot;port&quot;)))
// )
</span><span>
</span><span class="keyword">val</span><span> </span><span class="identifier">v2</span><span> = </span><span class="identifier">parallelValidate</span><span>(</span><span class="identifier">config</span><span>.</span><span class="identifier">parse</span><span>[</span><span class="type-name">String</span><span>](</span><span class="string-literal">&quot;endpoint&quot;</span><span>).</span><span class="identifier">toValidatedNec</span><span>,
                          </span><span class="identifier">config</span><span>.</span><span class="identifier">parse</span><span>[</span><span class="type-name">Int</span><span>](</span><span class="string-literal">&quot;port&quot;</span><span>).</span><span class="identifier">toValidatedNec</span><span>)(</span><span class="type-name">ConnectionParams</span><span>.</span><span class="identifier">apply</span><span>)
</span><span class="comment">// v2: Validated[NonEmptyChain[ConfigError], ConnectionParams] = Invalid(
//   Singleton(ParseError(&quot;port&quot;))
// )</span></code></pre>
        <pre class="keep-together pdf epub"><code class="nohighlight"><span class="keyword">val</span><span> </span><span class="identifier">config</span><span> = </span><span class="type-name">Config</span><span>(</span><span class="type-name">Map</span><span>((</span><span class="string-literal">&quot;endpoint&quot;</span><span>, </span><span class="string-literal">&quot;127.0.0.1&quot;</span><span>), (</span><span class="string-literal">&quot;port&quot;</span><span>, </span><span class="string-literal">&quot;1234&quot;</span><span>)))
</span><span class="comment">// config: Config = Config(Map(&quot;endpoint&quot; -&gt; &quot;127.0.0.1&quot;, &quot;port&quot; -&gt; &quot;1234&quot;))
</span><span class="keyword">val</span><span> </span><span class="identifier">v3</span><span> = </span><span class="identifier">parallelValidate</span><span>(</span><span class="identifier">config</span><span>.</span><span class="identifier">parse</span><span>[</span><span class="type-name">String</span><span>](</span><span class="string-literal">&quot;endpoint&quot;</span><span>).</span><span class="identifier">toValidatedNec</span><span>,
                          </span><span class="identifier">config</span><span>.</span><span class="identifier">parse</span><span>[</span><span class="type-name">Int</span><span>](</span><span class="string-literal">&quot;port&quot;</span><span>).</span><span class="identifier">toValidatedNec</span><span>)(</span><span class="type-name">ConnectionParams</span><span>.</span><span class="identifier">apply</span><span>)
</span><span class="comment">// v3: Validated[NonEmptyChain[ConfigError], ConnectionParams] = Valid(
//   ConnectionParams(&quot;127.0.0.1&quot;, 1234)
// )</span></code></pre>
        
        <h2 id="apply" class="section">Apply<a class="anchor-link right" href="#apply"><i class="icofont-laika">&#xef71;</i></a></h2>
        <p>Our <code>parallelValidate</code> function looks awfully like the <code>Apply#map2</code> function.</p>
        <pre class="keep-together pdf epub"><code class="nohighlight"><span class="keyword">def</span><span> </span><span class="declaration-name">map2</span><span>[</span><span class="type-name">F</span><span>[</span><span class="identifier">_</span><span>], </span><span class="type-name">A</span><span>, </span><span class="type-name">B</span><span>, </span><span class="type-name">C</span><span>](</span><span class="identifier">fa</span><span>: </span><span class="type-name">F</span><span>[</span><span class="type-name">A</span><span>], </span><span class="identifier">fb</span><span>: </span><span class="type-name">F</span><span>[</span><span class="type-name">B</span><span>])(</span><span class="identifier">f</span><span>: (</span><span class="type-name">A</span><span>, </span><span class="type-name">B</span><span>) =&gt; </span><span class="type-name">C</span><span>): </span><span class="type-name">F</span><span>[</span><span class="type-name">C</span><span>]</span></code></pre>
        <p>Which can be defined in terms of <code>Apply#ap</code> and <code>Apply#map</code>, the very functions needed to create an <code>Apply</code> instance.</p>
        <p>Can we perhaps define an <code>Apply</code> instance for <code>Validated</code>? Better yet, can we define an <code>Applicative</code> instance?</p>
        <p><em>Note</em>: the example below assumes usage of the <a href="https://github.com/typelevel/kind-projector">kind-projector compiler plugin</a> and will not compile if it is not being used in a project.</p>
        <pre><code class="nohighlight"><span class="keyword">import</span><span> </span><span class="identifier">cats</span><span>.</span><span class="type-name">Applicative</span><span>

</span><span class="keyword">implicit</span><span> </span><span class="keyword">def</span><span> </span><span class="declaration-name">validatedApplicative</span><span>[</span><span class="type-name">E</span><span> : </span><span class="type-name">Semigroup</span><span>]: </span><span class="type-name">Applicative</span><span>[</span><span class="type-name">Validated</span><span>[</span><span class="type-name">E</span><span>, *]] =
  </span><span class="keyword">new</span><span> </span><span class="type-name">Applicative</span><span>[</span><span class="type-name">Validated</span><span>[</span><span class="type-name">E</span><span>, *]] {
    </span><span class="keyword">def</span><span> </span><span class="declaration-name">ap</span><span>[</span><span class="type-name">A</span><span>, </span><span class="type-name">B</span><span>](</span><span class="identifier">f</span><span>: </span><span class="type-name">Validated</span><span>[</span><span class="type-name">E</span><span>, </span><span class="type-name">A</span><span> =&gt; </span><span class="type-name">B</span><span>])(</span><span class="identifier">fa</span><span>: </span><span class="type-name">Validated</span><span>[</span><span class="type-name">E</span><span>, </span><span class="type-name">A</span><span>]): </span><span class="type-name">Validated</span><span>[</span><span class="type-name">E</span><span>, </span><span class="type-name">B</span><span>] =
      (</span><span class="identifier">fa</span><span>, </span><span class="identifier">f</span><span>) </span><span class="keyword">match</span><span> {
        </span><span class="keyword">case</span><span> (</span><span class="type-name">Valid</span><span>(</span><span class="identifier">a</span><span>), </span><span class="type-name">Valid</span><span>(</span><span class="identifier">fab</span><span>)) =&gt; </span><span class="type-name">Valid</span><span>(</span><span class="identifier">fab</span><span>(</span><span class="identifier">a</span><span>))
        </span><span class="keyword">case</span><span> (</span><span class="identifier">i</span><span class="annotation">@Invalid</span><span>(</span><span class="identifier">_</span><span>), </span><span class="type-name">Valid</span><span>(</span><span class="identifier">_</span><span>)) =&gt; </span><span class="identifier">i</span><span>
        </span><span class="keyword">case</span><span> (</span><span class="type-name">Valid</span><span>(</span><span class="identifier">_</span><span>), </span><span class="identifier">i</span><span class="annotation">@Invalid</span><span>(</span><span class="identifier">_</span><span>)) =&gt; </span><span class="identifier">i</span><span>
        </span><span class="keyword">case</span><span> (</span><span class="type-name">Invalid</span><span>(</span><span class="identifier">e1</span><span>), </span><span class="type-name">Invalid</span><span>(</span><span class="identifier">e2</span><span>)) =&gt; </span><span class="type-name">Invalid</span><span>(</span><span class="type-name">Semigroup</span><span>[</span><span class="type-name">E</span><span>].</span><span class="identifier">combine</span><span>(</span><span class="identifier">e1</span><span>, </span><span class="identifier">e2</span><span>))
      }

    </span><span class="keyword">def</span><span> </span><span class="declaration-name">pure</span><span>[</span><span class="type-name">A</span><span>](</span><span class="identifier">x</span><span>: </span><span class="type-name">A</span><span>): </span><span class="type-name">Validated</span><span>[</span><span class="type-name">E</span><span>, </span><span class="type-name">A</span><span>] = </span><span class="type-name">Validated</span><span>.</span><span class="identifier">valid</span><span>(</span><span class="identifier">x</span><span>)
  }</span></code></pre>
        <p>Awesome! And now we also get access to all the goodness of <code>Applicative</code>, which includes <code>map{2-22}</code>, as well as the
        <code>Semigroupal</code> tuple syntax.</p>
        <p>We can now easily ask for several bits of configuration and get any and all errors returned back.</p>
        <pre><code class="nohighlight"><span class="keyword">import</span><span> </span><span class="identifier">cats</span><span>.</span><span class="type-name">Apply</span><span>
</span><span class="keyword">import</span><span> </span><span class="identifier">cats</span><span>.</span><span class="identifier">data</span><span>.</span><span class="type-name">ValidatedNec</span><span>

</span><span class="keyword">implicit</span><span> </span><span class="keyword">def</span><span> </span><span class="declaration-name">necSemigroup</span><span>: </span><span class="type-name">Semigroup</span><span>[</span><span class="type-name">NonEmptyChain</span><span>[</span><span class="type-name">ConfigError</span><span>]] =
  </span><span class="type-name">SemigroupK</span><span>[</span><span class="type-name">NonEmptyChain</span><span>].</span><span class="identifier">algebra</span><span>[</span><span class="type-name">ConfigError</span><span>]

</span><span class="keyword">val</span><span> </span><span class="identifier">personConfig</span><span> = </span><span class="type-name">Config</span><span>(</span><span class="type-name">Map</span><span>((</span><span class="string-literal">&quot;name&quot;</span><span>, </span><span class="string-literal">&quot;cat&quot;</span><span>), (</span><span class="string-literal">&quot;age&quot;</span><span>, </span><span class="string-literal">&quot;not a number&quot;</span><span>), (</span><span class="string-literal">&quot;houseNumber&quot;</span><span>, </span><span class="string-literal">&quot;1234&quot;</span><span>), (</span><span class="string-literal">&quot;lane&quot;</span><span>, </span><span class="string-literal">&quot;feline street&quot;</span><span>)))

</span><span class="keyword">case</span><span> </span><span class="keyword">class</span><span> </span><span class="type-name">Address</span><span>(</span><span class="identifier">houseNumber</span><span>: </span><span class="type-name">Int</span><span>, </span><span class="identifier">street</span><span>: </span><span class="type-name">String</span><span>)
</span><span class="keyword">case</span><span> </span><span class="keyword">class</span><span> </span><span class="type-name">Person</span><span>(</span><span class="identifier">name</span><span>: </span><span class="type-name">String</span><span>, </span><span class="identifier">age</span><span>: </span><span class="type-name">Int</span><span>, </span><span class="identifier">address</span><span>: </span><span class="type-name">Address</span><span>)

</span><span class="keyword">val</span><span> </span><span class="identifier">personFromConfig</span><span>: </span><span class="type-name">ValidatedNec</span><span>[</span><span class="type-name">ConfigError</span><span>, </span><span class="type-name">Person</span><span>] =
  </span><span class="type-name">Apply</span><span>[</span><span class="type-name">ValidatedNec</span><span>[</span><span class="type-name">ConfigError</span><span>, *]].</span><span class="identifier">map4</span><span>(</span><span class="identifier">personConfig</span><span>.</span><span class="identifier">parse</span><span>[</span><span class="type-name">String</span><span>](</span><span class="string-literal">&quot;name&quot;</span><span>).</span><span class="identifier">toValidatedNec</span><span>,
                                           </span><span class="identifier">personConfig</span><span>.</span><span class="identifier">parse</span><span>[</span><span class="type-name">Int</span><span>](</span><span class="string-literal">&quot;age&quot;</span><span>).</span><span class="identifier">toValidatedNec</span><span>,
                                           </span><span class="identifier">personConfig</span><span>.</span><span class="identifier">parse</span><span>[</span><span class="type-name">Int</span><span>](</span><span class="string-literal">&quot;house_number&quot;</span><span>).</span><span class="identifier">toValidatedNec</span><span>,
                                           </span><span class="identifier">personConfig</span><span>.</span><span class="identifier">parse</span><span>[</span><span class="type-name">String</span><span>](</span><span class="string-literal">&quot;street&quot;</span><span>).</span><span class="identifier">toValidatedNec</span><span>) {
    </span><span class="keyword">case</span><span> (</span><span class="identifier">name</span><span>, </span><span class="identifier">age</span><span>, </span><span class="identifier">houseNumber</span><span>, </span><span class="identifier">street</span><span>) =&gt; </span><span class="type-name">Person</span><span>(</span><span class="identifier">name</span><span>, </span><span class="identifier">age</span><span>, </span><span class="type-name">Address</span><span>(</span><span class="identifier">houseNumber</span><span>, </span><span class="identifier">street</span><span>))
  }</span></code></pre>
        
        <h2 id="of-flatmaps-and-eithers" class="section">Of <code>flatMap</code>s and <code>Either</code>s<a class="anchor-link right" href="#of-flatmaps-and-eithers"><i class="icofont-laika">&#xef71;</i></a></h2>
        <p><code>Option</code> has <code>flatMap</code>, <code>Either</code> has <code>flatMap</code>, where&#39;s <code>Validated</code>&#39;s? Let&#39;s try to implement it - better yet,
        let&#39;s implement the <code>Monad</code> type class.</p>
        <pre><code class="nohighlight"><span class="keyword">import</span><span> </span><span class="identifier">cats</span><span>.</span><span class="type-name">Monad</span><span>

</span><span class="keyword">implicit</span><span> </span><span class="keyword">def</span><span> </span><span class="declaration-name">validatedMonad</span><span>[</span><span class="type-name">E</span><span>]: </span><span class="type-name">Monad</span><span>[</span><span class="type-name">Validated</span><span>[</span><span class="type-name">E</span><span>, *]] =
  </span><span class="keyword">new</span><span> </span><span class="type-name">Monad</span><span>[</span><span class="type-name">Validated</span><span>[</span><span class="type-name">E</span><span>, *]] {
    </span><span class="keyword">def</span><span> </span><span class="declaration-name">flatMap</span><span>[</span><span class="type-name">A</span><span>, </span><span class="type-name">B</span><span>](</span><span class="identifier">fa</span><span>: </span><span class="type-name">Validated</span><span>[</span><span class="type-name">E</span><span>, </span><span class="type-name">A</span><span>])(</span><span class="identifier">f</span><span>: </span><span class="type-name">A</span><span> =&gt; </span><span class="type-name">Validated</span><span>[</span><span class="type-name">E</span><span>, </span><span class="type-name">B</span><span>]): </span><span class="type-name">Validated</span><span>[</span><span class="type-name">E</span><span>, </span><span class="type-name">B</span><span>] =
      </span><span class="identifier">fa</span><span> </span><span class="keyword">match</span><span> {
        </span><span class="keyword">case</span><span> </span><span class="type-name">Valid</span><span>(</span><span class="identifier">a</span><span>)     =&gt; </span><span class="identifier">f</span><span>(</span><span class="identifier">a</span><span>)
        </span><span class="keyword">case</span><span> </span><span class="identifier">i</span><span class="annotation">@Invalid</span><span>(</span><span class="identifier">_</span><span>) =&gt; </span><span class="identifier">i</span><span>
      }

    </span><span class="keyword">def</span><span> </span><span class="declaration-name">pure</span><span>[</span><span class="type-name">A</span><span>](</span><span class="identifier">x</span><span>: </span><span class="type-name">A</span><span>): </span><span class="type-name">Validated</span><span>[</span><span class="type-name">E</span><span>, </span><span class="type-name">A</span><span>] = </span><span class="type-name">Valid</span><span>(</span><span class="identifier">x</span><span>)

    </span><span class="annotation">@annotation</span><span>.</span><span class="identifier">tailrec</span><span>
    </span><span class="keyword">def</span><span> </span><span class="declaration-name">tailRecM</span><span>[</span><span class="type-name">A</span><span>, </span><span class="type-name">B</span><span>](</span><span class="identifier">a</span><span>: </span><span class="type-name">A</span><span>)(</span><span class="identifier">f</span><span>: </span><span class="type-name">A</span><span> =&gt; </span><span class="type-name">Validated</span><span>[</span><span class="type-name">E</span><span>, </span><span class="type-name">Either</span><span>[</span><span class="type-name">A</span><span>, </span><span class="type-name">B</span><span>]]): </span><span class="type-name">Validated</span><span>[</span><span class="type-name">E</span><span>, </span><span class="type-name">B</span><span>] =
      </span><span class="identifier">f</span><span>(</span><span class="identifier">a</span><span>) </span><span class="keyword">match</span><span> {
        </span><span class="keyword">case</span><span> </span><span class="type-name">Valid</span><span>(</span><span class="type-name">Right</span><span>(</span><span class="identifier">b</span><span>)) =&gt; </span><span class="type-name">Valid</span><span>(</span><span class="identifier">b</span><span>)
        </span><span class="keyword">case</span><span> </span><span class="type-name">Valid</span><span>(</span><span class="type-name">Left</span><span>(</span><span class="identifier">a</span><span>)) =&gt; </span><span class="identifier">tailRecM</span><span>(</span><span class="identifier">a</span><span>)(</span><span class="identifier">f</span><span>)
        </span><span class="keyword">case</span><span> </span><span class="identifier">i</span><span class="annotation">@Invalid</span><span>(</span><span class="identifier">_</span><span>) =&gt; </span><span class="identifier">i</span><span>
      }
  }</span></code></pre>
        <p>Note that all <code>Monad</code> instances are also <code>Applicative</code> instances, where <code>ap</code> is defined as</p>
        <pre class="keep-together pdf epub"><code class="nohighlight"><span class="keyword">trait</span><span> </span><span class="type-name">Monad</span><span>[</span><span class="type-name">F</span><span>[</span><span class="identifier">_</span><span>]] {
  </span><span class="keyword">def</span><span> </span><span class="declaration-name">flatMap</span><span>[</span><span class="type-name">A</span><span>, </span><span class="type-name">B</span><span>](</span><span class="identifier">fa</span><span>: </span><span class="type-name">F</span><span>[</span><span class="type-name">A</span><span>])(</span><span class="identifier">f</span><span>: </span><span class="type-name">A</span><span> =&gt; </span><span class="type-name">F</span><span>[</span><span class="type-name">B</span><span>]): </span><span class="type-name">F</span><span>[</span><span class="type-name">B</span><span>]
  </span><span class="keyword">def</span><span> </span><span class="declaration-name">pure</span><span>[</span><span class="type-name">A</span><span>](</span><span class="identifier">x</span><span>: </span><span class="type-name">A</span><span>): </span><span class="type-name">F</span><span>[</span><span class="type-name">A</span><span>]

  </span><span class="keyword">def</span><span> </span><span class="declaration-name">map</span><span>[</span><span class="type-name">A</span><span>, </span><span class="type-name">B</span><span>](</span><span class="identifier">fa</span><span>: </span><span class="type-name">F</span><span>[</span><span class="type-name">A</span><span>])(</span><span class="identifier">f</span><span>: </span><span class="type-name">A</span><span> =&gt; </span><span class="type-name">B</span><span>): </span><span class="type-name">F</span><span>[</span><span class="type-name">B</span><span>] =
    </span><span class="identifier">flatMap</span><span>(</span><span class="identifier">fa</span><span>)(</span><span class="identifier">f</span><span>.</span><span class="identifier">andThen</span><span>(</span><span class="identifier">pure</span><span>))

  </span><span class="keyword">def</span><span> </span><span class="declaration-name">ap</span><span>[</span><span class="type-name">A</span><span>, </span><span class="type-name">B</span><span>](</span><span class="identifier">fa</span><span>: </span><span class="type-name">F</span><span>[</span><span class="type-name">A</span><span>])(</span><span class="identifier">f</span><span>: </span><span class="type-name">F</span><span>[</span><span class="type-name">A</span><span> =&gt; </span><span class="type-name">B</span><span>]): </span><span class="type-name">F</span><span>[</span><span class="type-name">B</span><span>] =
    </span><span class="identifier">flatMap</span><span>(</span><span class="identifier">fa</span><span>)(</span><span class="identifier">a</span><span> =&gt; </span><span class="identifier">map</span><span>(</span><span class="identifier">f</span><span>)(</span><span class="identifier">fab</span><span> =&gt; </span><span class="identifier">fab</span><span>(</span><span class="identifier">a</span><span>)))
}</span></code></pre>
        <p>However, the <code>ap</code> behavior defined in terms of <code>flatMap</code> does not behave the same as that of
        our <code>ap</code> defined above. Observe:</p>
        <pre class="keep-together pdf epub"><code class="nohighlight"><span class="identifier">validatedMonad</span><span>.</span><span class="identifier">tuple2</span><span>(</span><span class="type-name">Validated</span><span>.</span><span class="identifier">invalidNec</span><span>[</span><span class="type-name">String</span><span>, </span><span class="type-name">Int</span><span>](</span><span class="string-literal">&quot;oops&quot;</span><span>), </span><span class="type-name">Validated</span><span>.</span><span class="identifier">invalidNec</span><span>[</span><span class="type-name">String</span><span>, </span><span class="type-name">Double</span><span>](</span><span class="string-literal">&quot;uh oh&quot;</span><span>))
</span><span class="comment">// res10: Validated[NonEmptyChain[String], (Int, Double)] = Invalid(
//   Singleton(&quot;oops&quot;)
// )</span></code></pre>
        <p>This one short circuits! Therefore, if we were to define a <code>Monad</code> (or <code>FlatMap</code>) instance for <code>Validated</code> we would
        have to override <code>ap</code> to get the behavior we want. </p>
        <pre><code class="nohighlight"><span class="keyword">import</span><span> </span><span class="identifier">cats</span><span>.</span><span class="type-name">Monad</span><span>

</span><span class="keyword">implicit</span><span> </span><span class="keyword">def</span><span> </span><span class="declaration-name">accumulatingValidatedMonad</span><span>[</span><span class="type-name">E</span><span>: </span><span class="type-name">Semigroup</span><span>]: </span><span class="type-name">Monad</span><span>[</span><span class="type-name">Validated</span><span>[</span><span class="type-name">E</span><span>, *]] =
  </span><span class="keyword">new</span><span> </span><span class="type-name">Monad</span><span>[</span><span class="type-name">Validated</span><span>[</span><span class="type-name">E</span><span>, *]] {
    </span><span class="keyword">def</span><span> </span><span class="declaration-name">flatMap</span><span>[</span><span class="type-name">A</span><span>, </span><span class="type-name">B</span><span>](</span><span class="identifier">fa</span><span>: </span><span class="type-name">Validated</span><span>[</span><span class="type-name">E</span><span>, </span><span class="type-name">A</span><span>])(</span><span class="identifier">f</span><span>: </span><span class="type-name">A</span><span> =&gt; </span><span class="type-name">Validated</span><span>[</span><span class="type-name">E</span><span>, </span><span class="type-name">B</span><span>]): </span><span class="type-name">Validated</span><span>[</span><span class="type-name">E</span><span>, </span><span class="type-name">B</span><span>] =
      </span><span class="identifier">fa</span><span> </span><span class="keyword">match</span><span> {
        </span><span class="keyword">case</span><span> </span><span class="type-name">Valid</span><span>(</span><span class="identifier">a</span><span>)     =&gt; </span><span class="identifier">f</span><span>(</span><span class="identifier">a</span><span>)
        </span><span class="keyword">case</span><span> </span><span class="identifier">i</span><span class="annotation">@Invalid</span><span>(</span><span class="identifier">_</span><span>) =&gt; </span><span class="identifier">i</span><span>
      }

    </span><span class="keyword">def</span><span> </span><span class="declaration-name">pure</span><span>[</span><span class="type-name">A</span><span>](</span><span class="identifier">x</span><span>: </span><span class="type-name">A</span><span>): </span><span class="type-name">Validated</span><span>[</span><span class="type-name">E</span><span>, </span><span class="type-name">A</span><span>] = </span><span class="type-name">Valid</span><span>(</span><span class="identifier">x</span><span>)

    </span><span class="annotation">@annotation</span><span>.</span><span class="identifier">tailrec</span><span>
    </span><span class="keyword">def</span><span> </span><span class="declaration-name">tailRecM</span><span>[</span><span class="type-name">A</span><span>, </span><span class="type-name">B</span><span>](</span><span class="identifier">a</span><span>: </span><span class="type-name">A</span><span>)(</span><span class="identifier">f</span><span>: </span><span class="type-name">A</span><span> =&gt; </span><span class="type-name">Validated</span><span>[</span><span class="type-name">E</span><span>, </span><span class="type-name">Either</span><span>[</span><span class="type-name">A</span><span>, </span><span class="type-name">B</span><span>]]): </span><span class="type-name">Validated</span><span>[</span><span class="type-name">E</span><span>, </span><span class="type-name">B</span><span>] =
      </span><span class="identifier">f</span><span>(</span><span class="identifier">a</span><span>) </span><span class="keyword">match</span><span> {
        </span><span class="keyword">case</span><span> </span><span class="type-name">Valid</span><span>(</span><span class="type-name">Right</span><span>(</span><span class="identifier">b</span><span>)) =&gt; </span><span class="type-name">Valid</span><span>(</span><span class="identifier">b</span><span>)
        </span><span class="keyword">case</span><span> </span><span class="type-name">Valid</span><span>(</span><span class="type-name">Left</span><span>(</span><span class="identifier">a</span><span>)) =&gt; </span><span class="identifier">tailRecM</span><span>(</span><span class="identifier">a</span><span>)(</span><span class="identifier">f</span><span>)
        </span><span class="keyword">case</span><span> </span><span class="identifier">i</span><span class="annotation">@Invalid</span><span>(</span><span class="identifier">_</span><span>) =&gt; </span><span class="identifier">i</span><span>
      }

    </span><span class="keyword">override</span><span> </span><span class="keyword">def</span><span> </span><span class="declaration-name">ap</span><span>[</span><span class="type-name">A</span><span>, </span><span class="type-name">B</span><span>](</span><span class="identifier">f</span><span>: </span><span class="type-name">Validated</span><span>[</span><span class="type-name">E</span><span>, </span><span class="type-name">A</span><span> =&gt; </span><span class="type-name">B</span><span>])(</span><span class="identifier">fa</span><span>: </span><span class="type-name">Validated</span><span>[</span><span class="type-name">E</span><span>, </span><span class="type-name">A</span><span>]): </span><span class="type-name">Validated</span><span>[</span><span class="type-name">E</span><span>, </span><span class="type-name">B</span><span>] =
      (</span><span class="identifier">fa</span><span>, </span><span class="identifier">f</span><span>) </span><span class="keyword">match</span><span> {
        </span><span class="keyword">case</span><span> (</span><span class="type-name">Valid</span><span>(</span><span class="identifier">a</span><span>), </span><span class="type-name">Valid</span><span>(</span><span class="identifier">fab</span><span>)) =&gt; </span><span class="type-name">Valid</span><span>(</span><span class="identifier">fab</span><span>(</span><span class="identifier">a</span><span>))
        </span><span class="keyword">case</span><span> (</span><span class="identifier">i</span><span class="annotation">@Invalid</span><span>(</span><span class="identifier">_</span><span>), </span><span class="type-name">Valid</span><span>(</span><span class="identifier">_</span><span>)) =&gt; </span><span class="identifier">i</span><span>
        </span><span class="keyword">case</span><span> (</span><span class="type-name">Valid</span><span>(</span><span class="identifier">_</span><span>), </span><span class="identifier">i</span><span class="annotation">@Invalid</span><span>(</span><span class="identifier">_</span><span>)) =&gt; </span><span class="identifier">i</span><span>
        </span><span class="keyword">case</span><span> (</span><span class="type-name">Invalid</span><span>(</span><span class="identifier">e1</span><span>), </span><span class="type-name">Invalid</span><span>(</span><span class="identifier">e2</span><span>)) =&gt; </span><span class="type-name">Invalid</span><span>(</span><span class="type-name">Semigroup</span><span>[</span><span class="type-name">E</span><span>].</span><span class="identifier">combine</span><span>(</span><span class="identifier">e1</span><span>, </span><span class="identifier">e2</span><span>))
      }
  }</span></code></pre>
        <p>But then the behavior of <code>flatMap</code> would be inconsistent with that of <code>ap</code>, and this will violate one of the <a href="https://github.com/typelevel/cats/blob/main/laws/src/main/scala/cats/laws/FlatMapLaws.scala">FlatMap laws</a>, <code>flatMapConsistentApply</code>:</p>
        <pre class="keep-together pdf epub"><code class="nohighlight"><span class="comment">// the `&lt;-&gt;` operator means &quot;is equivalent to&quot; and returns a data structure
// `IsEq` that is used to verify the equivalence of the two expressions
</span><span class="keyword">def</span><span> </span><span class="declaration-name">flatMapConsistentApply</span><span>[</span><span class="type-name">A</span><span>, </span><span class="type-name">B</span><span>](</span><span class="identifier">fa</span><span>: </span><span class="type-name">F</span><span>[</span><span class="type-name">A</span><span>], </span><span class="identifier">fab</span><span>: </span><span class="type-name">F</span><span>[</span><span class="type-name">A</span><span> =&gt; </span><span class="type-name">B</span><span>]): </span><span class="type-name">IsEq</span><span>[</span><span class="type-name">F</span><span>[</span><span class="type-name">B</span><span>]] = 
  </span><span class="identifier">fab</span><span>.</span><span class="identifier">ap</span><span>(</span><span class="identifier">fa</span><span>) &lt;-&gt; </span><span class="identifier">fab</span><span>.</span><span class="identifier">flatMap</span><span>(</span><span class="identifier">f</span><span> =&gt; </span><span class="identifier">fa</span><span>.</span><span class="identifier">map</span><span>(</span><span class="identifier">f</span><span>))</span></code></pre>
        <pre class="keep-together pdf epub"><code class="nohighlight"><span class="keyword">import</span><span> </span><span class="identifier">cats</span><span>.</span><span class="identifier">laws</span><span>.</span><span class="identifier">_</span><span>

</span><span class="keyword">val</span><span> </span><span class="identifier">flatMapLawsForAccumulatingValidatedMonad</span><span> = 
  </span><span class="type-name">FlatMapLaws</span><span>[</span><span class="type-name">Validated</span><span>[</span><span class="type-name">NonEmptyChain</span><span>[</span><span class="type-name">String</span><span>], *]](</span><span class="identifier">accumulatingValidatedMonad</span><span>)

</span><span class="keyword">val</span><span> </span><span class="identifier">fa</span><span>  = </span><span class="type-name">Validated</span><span>.</span><span class="identifier">invalidNec</span><span>[</span><span class="type-name">String</span><span>, </span><span class="type-name">Int</span><span>](</span><span class="string-literal">&quot;oops&quot;</span><span>)
</span><span class="keyword">val</span><span> </span><span class="identifier">fab</span><span> = </span><span class="type-name">Validated</span><span>.</span><span class="identifier">invalidNec</span><span>[</span><span class="type-name">String</span><span>, </span><span class="type-name">Int</span><span> =&gt; </span><span class="type-name">Double</span><span>](</span><span class="string-literal">&quot;Broken function&quot;</span><span>)</span></code></pre>
        <pre class="keep-together pdf epub"><code class="nohighlight"><span class="identifier">flatMapLawsForAccumulatingValidatedMonad</span><span>.</span><span class="identifier">flatMapConsistentApply</span><span>(</span><span class="identifier">fa</span><span> , </span><span class="identifier">fab</span><span>)
</span><span class="comment">// res11: IsEq[Validated[cats.data.NonEmptyChainImpl.Type[String], Double]] = IsEq(
//   Invalid(Append(Singleton(&quot;oops&quot;), Singleton(&quot;Broken function&quot;))),
//   Invalid(Singleton(&quot;Broken function&quot;))
// )</span></code></pre>
        <p>Therefore, <code>Validated</code> has only an <code>Applicative</code> instance.</p>
        
        <h2 id="validated-vs-either" class="section"><code>Validated</code> vs <code>Either</code><a class="anchor-link right" href="#validated-vs-either"><i class="icofont-laika">&#xef71;</i></a></h2>
        <p>We&#39;ve established that an error-accumulating data type such as <code>Validated</code> can&#39;t have a valid <code>Monad</code> instance. Sometimes the task at hand requires error-accumulation. However, sometimes we want a monadic structure that we can use for sequential validation (such as in a for-comprehension). This leaves us in a bit of a conundrum.</p>
        <p>Cats has decided to solve this problem by using separate data structures for error-accumulation (<code>Validated</code>) and short-circuiting monadic behavior (<code>Either</code>).</p>
        <p>If you are trying to decide whether you want to use <code>Validated</code> or <code>Either</code>, a simple heuristic is to use <code>Validated</code> if you want error-accumulation and to otherwise use <code>Either</code>.</p>
        
        <h2 id="sequential-validation" class="section">Sequential Validation<a class="anchor-link right" href="#sequential-validation"><i class="icofont-laika">&#xef71;</i></a></h2>
        <p>If you do want error accumulation but occasionally run into places where you sequential validation is needed, then <code>Validated</code> provides a couple methods that may be helpful.</p>
        
        <h3 id="andthen" class="section"><code>andThen</code><a class="anchor-link right" href="#andthen"><i class="icofont-laika">&#xef71;</i></a></h3>
        <p>The <code>andThen</code> method is similar to <code>flatMap</code> (such as <code>Either.flatMap</code>). In the case of success, it passes the valid value into a function that returns a new <code>Validated</code> instance.</p>
        <pre class="keep-together pdf epub"><code class="nohighlight"><span class="keyword">val</span><span> </span><span class="identifier">houseNumber</span><span> = </span><span class="identifier">config</span><span>.</span><span class="identifier">parse</span><span>[</span><span class="type-name">Int</span><span>](</span><span class="string-literal">&quot;house_number&quot;</span><span>).</span><span class="identifier">andThen</span><span>{ </span><span class="identifier">n</span><span> =&gt;
   </span><span class="keyword">if</span><span> (</span><span class="identifier">n</span><span> &gt;= </span><span class="number-literal">0</span><span>) </span><span class="type-name">Validated</span><span>.</span><span class="identifier">valid</span><span>(</span><span class="identifier">n</span><span>)
   </span><span class="keyword">else</span><span> </span><span class="type-name">Validated</span><span>.</span><span class="identifier">invalid</span><span>(</span><span class="type-name">ParseError</span><span>(</span><span class="string-literal">&quot;house_number&quot;</span><span>))
}
</span><span class="comment">// houseNumber: Validated[ConfigError, Int] = Invalid(
//   MissingConfig(&quot;house_number&quot;)
// )</span></code></pre>
        
        <h3 id="witheither" class="section"><code>withEither</code><a class="anchor-link right" href="#witheither"><i class="icofont-laika">&#xef71;</i></a></h3>
        <p>The <code>withEither</code> method allows you to temporarily turn a <code>Validated</code> instance into an <code>Either</code> instance and apply it to a function.</p>
        <pre class="keep-together pdf epub"><code class="nohighlight"><span class="keyword">def</span><span> </span><span class="declaration-name">positive</span><span>(</span><span class="identifier">field</span><span>: </span><span class="type-name">String</span><span>, </span><span class="identifier">i</span><span>: </span><span class="type-name">Int</span><span>): </span><span class="type-name">Either</span><span>[</span><span class="type-name">ConfigError</span><span>, </span><span class="type-name">Int</span><span>] = {
  </span><span class="keyword">if</span><span> (</span><span class="identifier">i</span><span> &gt;= </span><span class="number-literal">0</span><span>) </span><span class="type-name">Right</span><span>(</span><span class="identifier">i</span><span>)
  </span><span class="keyword">else</span><span> </span><span class="type-name">Left</span><span>(</span><span class="type-name">ParseError</span><span>(</span><span class="identifier">field</span><span>))
}</span></code></pre>
        <p>Thus.</p>
        <pre class="keep-together pdf epub"><code class="nohighlight"><span class="keyword">val</span><span> </span><span class="identifier">houseNumber</span><span> = </span><span class="identifier">config</span><span>.</span><span class="identifier">parse</span><span>[</span><span class="type-name">Int</span><span>](</span><span class="string-literal">&quot;house_number&quot;</span><span>).</span><span class="identifier">withEither</span><span>{ </span><span class="identifier">either</span><span>: </span><span class="type-name">Either</span><span>[</span><span class="type-name">ConfigError</span><span>, </span><span class="type-name">Int</span><span>] =&gt;
  </span><span class="identifier">either</span><span>.</span><span class="identifier">flatMap</span><span>{ </span><span class="identifier">i</span><span> =&gt;
    </span><span class="identifier">positive</span><span>(</span><span class="string-literal">&quot;house_number&quot;</span><span>, </span><span class="identifier">i</span><span>)
  }
}
</span><span class="comment">// houseNumber: Validated[ConfigError, Int] = Invalid(
//   MissingConfig(&quot;house_number&quot;)
// )</span></code></pre>

        <hr style="margin-top: 30px"/>
        <footer style="font-size: 90%; text-align: center">
          cats is a <a href="https://typelevel.org/">Typelevel</a> project distributed under the <a href="https://opensource.org/licenses/MIT">MIT</a> license.
        </footer>

      </main>

    </div>

  </body>
</html>
