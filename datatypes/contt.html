<!DOCTYPE html>
<html lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="Laika 0.18.1 + Helium Theme" />
    <title>ContT</title>
    
      <meta name="author" content="Cody Allen"/>
    
      <meta name="author" content="Ross Baker"/>
    
      <meta name="author" content="P. Oscar Boykin"/>
    
      <meta name="author" content="Travis Brown"/>
    
      <meta name="author" content="Adelbert Chang"/>
    
      <meta name="author" content="Peter Neyens"/>
    
      <meta name="author" content="Rob Norris"/>
    
      <meta name="author" content="Erik Osheim"/>
    
      <meta name="author" content="LukaJCB"/>
    
      <meta name="author" content="Michael Pilquist"/>
    
      <meta name="author" content="Miles Sabin"/>
    
      <meta name="author" content="Daniel Spiewak"/>
    
      <meta name="author" content="Frank Thomas"/>
    
      <meta name="author" content="Julien Truffaut"/>
    
      <meta name="author" content="Kailuo Wang"/>
    
    
      <meta name="description" content="docs"/>
    
    
      <link rel="icon" sizes="32x32" type="image/png" href="https://typelevel.org/img/favicon.png"/>
    
    
      <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:400,700">
    
      <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/tonsky/FiraCode@1.207/distr/fira_code.css">
    
    <link rel="stylesheet" type="text/css" href="../helium/icofont.min.css" />
    <link rel="stylesheet" type="text/css" href="../helium/laika-helium.css" />
    <link rel="stylesheet" type="text/css" href="../site/styles.css" />
    <script src="../helium/laika-helium.js"></script>
    <script src="../js/sponsors.js"></script>
    
    
    <script> /* for avoiding page load transitions */ </script>
  </head>

  <body>

    <header id="top-bar">

      <div class="row">
        <a id="nav-icon">
          <i class="icofont-laika" title="Navigation">&#xefa2;</i>
        </a>
        
      </div>

      <a class="image-link" href="https://typelevel.org"><img src="https://typelevel.org/img/logo.svg"></a>

      <span class="row links"><a class="icon-link svg-link" href="https://typelevel.org/cats/api/"><span title="API"><svg class="svg-icon" width="100%" height="100%" viewBox="0 0 100 100" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xml:space="preserve" xmlns:serif="http://www.serif.com/" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:2;">
  <g class="svg-shape">
    <path d="M75,47.5c13.246,0 24,10.754 24,24c0,13.246 -10.754,24 -24,24c-13.246,0 -24,-10.754 -24,-24c0,-13.246 10.754,-24 24,-24Zm-50,-0c13.246,-0 24,10.754 24,24c0,13.246 -10.754,24 -24,24c-13.246,-0 -24,-10.754 -24,-24c0,-13.246 10.754,-24 24,-24Zm2.705,16.735l7.239,0l0.622,-4.904l-21.833,0l-0,4.904l7.589,0l0,22.067l6.383,0l-0,-22.067Zm58.076,7.265c-0,-8.757 -3.698,-14.166 -10.781,-14.166c-7.083,-0 -10.781,5.604 -10.781,14.166c0,8.757 3.698,14.166 10.781,14.166c7.083,0 10.781,-5.604 10.781,-14.166Zm-6.539,0c0,6.538 -1.128,9.496 -4.242,9.496c-2.997,0 -4.242,-2.88 -4.242,-9.496c-0,-6.616 1.206,-9.496 4.242,-9.496c3.036,-0 4.242,2.88 4.242,9.496Zm-29.242,-67c13.246,0 24,10.754 24,24c0,13.246 -10.754,24 -24,24c-13.246,0 -24,-10.754 -24,-24c0,-13.246 10.754,-24 24,-24Zm0.512,9.834c-7.122,-0 -12.609,5.098 -12.609,14.127c-0,9.263 5.215,14.205 12.532,14.205c4.164,0 7.083,-1.634 9.068,-3.658l-2.88,-3.697c-1.518,1.206 -3.153,2.413 -5.838,2.413c-3.697,-0 -6.266,-2.763 -6.266,-9.263c-0,-6.616 2.724,-9.379 6.149,-9.379c2.102,-0 3.892,0.778 5.371,1.984l3.113,-3.775c-2.257,-1.868 -4.748,-2.957 -8.64,-2.957Z"/>
  </g>
</svg></span></a><a class="icon-link svg-link" href="https://github.com/typelevel/cats"><span title="Source Code"><svg class="svg-icon" width="100%" height="100%" viewBox="0 0 100 100" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xml:space="preserve" xmlns:serif="http://www.serif.com/" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:2;">
  <g class="svg-shape">
    <path d="M49.995,1c-27.609,-0 -49.995,22.386 -49.995,50.002c-0,22.09 14.325,40.83 34.194,47.444c2.501,0.458 3.413,-1.086 3.413,-2.412c0,-1.185 -0.043,-4.331 -0.067,-8.503c-13.908,3.021 -16.843,-6.704 -16.843,-6.704c-2.274,-5.773 -5.552,-7.311 -5.552,-7.311c-4.54,-3.103 0.344,-3.042 0.344,-3.042c5.018,0.356 7.658,5.154 7.658,5.154c4.46,7.64 11.704,5.433 14.552,4.156c0.454,-3.232 1.744,-5.436 3.174,-6.685c-11.102,-1.262 -22.775,-5.553 -22.775,-24.713c-0,-5.457 1.949,-9.92 5.147,-13.416c-0.516,-1.265 -2.231,-6.348 0.488,-13.233c0,0 4.199,-1.344 13.751,5.126c3.988,-1.108 8.266,-1.663 12.518,-1.682c4.245,0.019 8.523,0.574 12.517,1.682c9.546,-6.47 13.736,-5.126 13.736,-5.126c2.728,6.885 1.013,11.968 0.497,13.233c3.204,3.496 5.141,7.959 5.141,13.416c0,19.209 -11.691,23.436 -22.83,24.673c1.795,1.544 3.394,4.595 3.394,9.26c0,6.682 -0.061,12.076 -0.061,13.715c0,1.338 0.899,2.894 3.438,2.406c19.853,-6.627 34.166,-25.354 34.166,-47.438c-0,-27.616 -22.389,-50.002 -50.005,-50.002"/>
  </g>
</svg></span></a><a class="icon-link" href="https://discord.gg/XF3CXcMzqD"><i class="icofont-laika" title="Chat">&#xeed5;</i></a><a class="icon-link" href="https://twitter.com/typelevel"><i class="icofont-laika" title="Twitter">&#xed7a;</i></a></span>

    </header>

    <nav id="sidebar">

      <div class="row">
        <a class="icon-link svg-link" href="https://typelevel.org/cats/api/"><span title="API"><svg class="svg-icon" width="100%" height="100%" viewBox="0 0 100 100" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xml:space="preserve" xmlns:serif="http://www.serif.com/" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:2;">
  <g class="svg-shape">
    <path d="M75,47.5c13.246,0 24,10.754 24,24c0,13.246 -10.754,24 -24,24c-13.246,0 -24,-10.754 -24,-24c0,-13.246 10.754,-24 24,-24Zm-50,-0c13.246,-0 24,10.754 24,24c0,13.246 -10.754,24 -24,24c-13.246,-0 -24,-10.754 -24,-24c0,-13.246 10.754,-24 24,-24Zm2.705,16.735l7.239,0l0.622,-4.904l-21.833,0l-0,4.904l7.589,0l0,22.067l6.383,0l-0,-22.067Zm58.076,7.265c-0,-8.757 -3.698,-14.166 -10.781,-14.166c-7.083,-0 -10.781,5.604 -10.781,14.166c0,8.757 3.698,14.166 10.781,14.166c7.083,0 10.781,-5.604 10.781,-14.166Zm-6.539,0c0,6.538 -1.128,9.496 -4.242,9.496c-2.997,0 -4.242,-2.88 -4.242,-9.496c-0,-6.616 1.206,-9.496 4.242,-9.496c3.036,-0 4.242,2.88 4.242,9.496Zm-29.242,-67c13.246,0 24,10.754 24,24c0,13.246 -10.754,24 -24,24c-13.246,0 -24,-10.754 -24,-24c0,-13.246 10.754,-24 24,-24Zm0.512,9.834c-7.122,-0 -12.609,5.098 -12.609,14.127c-0,9.263 5.215,14.205 12.532,14.205c4.164,0 7.083,-1.634 9.068,-3.658l-2.88,-3.697c-1.518,1.206 -3.153,2.413 -5.838,2.413c-3.697,-0 -6.266,-2.763 -6.266,-9.263c-0,-6.616 2.724,-9.379 6.149,-9.379c2.102,-0 3.892,0.778 5.371,1.984l3.113,-3.775c-2.257,-1.868 -4.748,-2.957 -8.64,-2.957Z"/>
  </g>
</svg></span></a><a class="icon-link svg-link" href="https://github.com/typelevel/cats"><span title="Source Code"><svg class="svg-icon" width="100%" height="100%" viewBox="0 0 100 100" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xml:space="preserve" xmlns:serif="http://www.serif.com/" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:2;">
  <g class="svg-shape">
    <path d="M49.995,1c-27.609,-0 -49.995,22.386 -49.995,50.002c-0,22.09 14.325,40.83 34.194,47.444c2.501,0.458 3.413,-1.086 3.413,-2.412c0,-1.185 -0.043,-4.331 -0.067,-8.503c-13.908,3.021 -16.843,-6.704 -16.843,-6.704c-2.274,-5.773 -5.552,-7.311 -5.552,-7.311c-4.54,-3.103 0.344,-3.042 0.344,-3.042c5.018,0.356 7.658,5.154 7.658,5.154c4.46,7.64 11.704,5.433 14.552,4.156c0.454,-3.232 1.744,-5.436 3.174,-6.685c-11.102,-1.262 -22.775,-5.553 -22.775,-24.713c-0,-5.457 1.949,-9.92 5.147,-13.416c-0.516,-1.265 -2.231,-6.348 0.488,-13.233c0,0 4.199,-1.344 13.751,5.126c3.988,-1.108 8.266,-1.663 12.518,-1.682c4.245,0.019 8.523,0.574 12.517,1.682c9.546,-6.47 13.736,-5.126 13.736,-5.126c2.728,6.885 1.013,11.968 0.497,13.233c3.204,3.496 5.141,7.959 5.141,13.416c0,19.209 -11.691,23.436 -22.83,24.673c1.795,1.544 3.394,4.595 3.394,9.26c0,6.682 -0.061,12.076 -0.061,13.715c0,1.338 0.899,2.894 3.438,2.406c19.853,-6.627 34.166,-25.354 34.166,-47.438c-0,-27.616 -22.389,-50.002 -50.005,-50.002"/>
  </g>
</svg></span></a><a class="icon-link" href="https://discord.gg/XF3CXcMzqD"><i class="icofont-laika" title="Chat">&#xeed5;</i></a><a class="icon-link" href="https://twitter.com/typelevel"><i class="icofont-laika" title="Twitter">&#xed7a;</i></a>
      </div>

      <ul class="nav-list">
        <li class="level1"><a href="../index.html">Cats</a></li>
        <li class="level1"><a href="../typeclasses.html">Type Classes</a></li>
        <li class="level1"><a href="../datatypes.html">Data Types</a></li>
        <li class="level1"><a href="../algebra.html">Algebra</a></li>
        <li class="level1"><a href="../motivations.html">Motivations</a></li>
        <li class="level1"><a href="../resources_for_learners.html">Resources for Learners</a></li>
        <li class="level1"><a href="../jump_start_guide.html">Jump Start Guide</a></li>
        <li class="level1"><a href="../imports.html">Imports</a></li>
        <li class="level1"><a href="../faq.html">FAQ</a></li>
        <li class="level1"><a href="../CONTRIBUTING.html">Contributor guide</a></li>
        <li class="level1"><a href="../colophon.html">Colophon</a></li>
        <li class="level1"><a href="../nomenclature.html">Glossary</a></li>
        <li class="level1"><a href="../guidelines.html">Guidelines</a></li>
        <li class="level1"><a href="../typelevelEcosystem.html">Typelevel Ecosystem</a></li>
        <li class="level1 nav-header">Type Classes</li>
        <li class="level2"><a href="../typeclasses/alternative.html">Alternative</a></li>
        <li class="level2"><a href="../typeclasses/applicative.html">Applicative</a></li>
        <li class="level2"><a href="../typeclasses/applicativemonaderror.html">ApplicativeError and MonadError</a></li>
        <li class="level2"><a href="../typeclasses/applicativetraverse.html">Applicative and Traversable Functors</a></li>
        <li class="level2"><a href="../typeclasses/arrow.html">Arrow</a></li>
        <li class="level2"><a href="../typeclasses/arrowchoice.html">Arrow Choice</a></li>
        <li class="level2"><a href="../typeclasses/bifoldable.html">Bifoldable</a></li>
        <li class="level2"><a href="../typeclasses/bifunctor.html">Bifunctor</a></li>
        <li class="level2"><a href="../typeclasses/bimonad.html">Bimonad</a></li>
        <li class="level2"><a href="../typeclasses/comonad.html">Comonad</a></li>
        <li class="level2"><a href="../typeclasses/contravariant.html">Contravariant</a></li>
        <li class="level2"><a href="../typeclasses/contravariantmonoidal.html">Contravariant Monoidal</a></li>
        <li class="level2"><a href="../typeclasses/eq.html">Eq</a></li>
        <li class="level2"><a href="../typeclasses/foldable.html">Foldable</a></li>
        <li class="level2"><a href="../typeclasses/functor.html">Functor</a></li>
        <li class="level2"><a href="../typeclasses/invariant.html">Invariant</a></li>
        <li class="level2"><a href="../typeclasses/invariantmonoidal.html">Invariant Monoidal</a></li>
        <li class="level2"><a href="../typeclasses/lawtesting.html">Law testing</a></li>
        <li class="level2"><a href="../typeclasses/monad.html">Monad</a></li>
        <li class="level2"><a href="../typeclasses/monoid.html">Monoid</a></li>
        <li class="level2"><a href="../typeclasses/monoidk.html">MonoidK</a></li>
        <li class="level2"><a href="../typeclasses/nonemptytraverse.html">NonEmptyTraverse</a></li>
        <li class="level2"><a href="../typeclasses/parallel.html">Parallel</a></li>
        <li class="level2"><a href="../typeclasses/reducible.html">Reducible</a></li>
        <li class="level2"><a href="../typeclasses/semigroup.html">Semigroup</a></li>
        <li class="level2"><a href="../typeclasses/semigroupk.html">SemigroupK</a></li>
        <li class="level2"><a href="../typeclasses/show.html">Show</a></li>
        <li class="level2"><a href="../typeclasses/traverse.html">Traverse</a></li>
        <li class="level1 nav-header">Data Types</li>
        <li class="level2"><a href="chain.html">Chain</a></li>
        <li class="level2"><a href="const.html">Const</a></li>
        <li class="level2 active"><a href="#">ContT</a></li>
        <li class="level2"><a href="either.html">Either</a></li>
        <li class="level2"><a href="eithert.html">EitherT</a></li>
        <li class="level2"><a href="eval.html">Eval</a></li>
        <li class="level2"><a href="freeapplicative.html">Free Applicative</a></li>
        <li class="level2"><a href="freemonad.html">Free Monad</a></li>
        <li class="level2"><a href="functionk.html">FunctionK</a></li>
        <li class="level2"><a href="id.html">Id</a></li>
        <li class="level2"><a href="ior.html">Ior</a></li>
        <li class="level2"><a href="iort.html">IorT</a></li>
        <li class="level2"><a href="kleisli.html">Kleisli</a></li>
        <li class="level2"><a href="nel.html">NonEmptyList</a></li>
        <li class="level2"><a href="nested.html">Nested</a></li>
        <li class="level2"><a href="oneand.html">OneAnd</a></li>
        <li class="level2"><a href="optiont.html">OptionT</a></li>
        <li class="level2"><a href="state.html">State</a></li>
        <li class="level2"><a href="validated.html">Validated</a></li>
        <li class="level2"><a href="writer.html">Writer</a></li>
        <li class="level2"><a href="writert.html">WriterT</a></li>
      </ul>

      <ul class="nav-list">
        <li class="level1 nav-header">Related Projects</li>
        
          <li class="level2"><a href="https://typelevel.org/cats-effect/">cats-effect</a></li>
        
          <li class="level2"><a href="https://typelevel.org/mouse">Mouse</a></li>
        
          <li class="level2"><a href="https://github.com/typelevel/discipline/">discipline</a></li>
        
      </ul>

    </nav>

    <div id="container">

      <nav id="page-nav">
        <p class="header"><a href="#">ContT</a></p>

        <ul class="nav-list">
          <li class="level1"><a href="#composition">Composition</a></li>
          <li class="level1"><a href="#why-eval">Why Eval?</a></li>
        </ul>

        <p class="footer"></p>
      </nav>

      <main class="content">

        <h1 id="contt" class="title">ContT</h1>
        <p>A pattern that appears sometimes in functional programming is that of a function
        first computing some kind of intermediate result and then passing that result to
        another function which was passed in as an argument, in order to delegate the
        computation of the final result.</p>
        <p>For example:</p>
        <pre class="keep-together pdf epub"><code class="nohighlight"><span class="keyword">case</span><span> </span><span class="keyword">class</span><span> </span><span class="type-name">User</span><span>(</span><span class="identifier">id</span><span>: </span><span class="type-name">Int</span><span>, </span><span class="identifier">name</span><span>: </span><span class="type-name">String</span><span>, </span><span class="identifier">age</span><span>: </span><span class="type-name">Int</span><span>)
</span><span class="keyword">sealed</span><span> </span><span class="keyword">abstract</span><span> </span><span class="keyword">class</span><span> </span><span class="type-name">UserUpdateResult</span><span>
</span><span class="keyword">case</span><span> </span><span class="keyword">class</span><span> </span><span class="type-name">Succeeded</span><span>(</span><span class="identifier">updatedUserId</span><span>: </span><span class="type-name">Int</span><span>) </span><span class="keyword">extends</span><span> </span><span class="type-name">UserUpdateResult</span><span>
</span><span class="keyword">case</span><span> </span><span class="keyword">object</span><span> </span><span class="type-name">Failed</span><span> </span><span class="keyword">extends</span><span> </span><span class="type-name">UserUpdateResult</span></code></pre>
        <pre class="keep-together pdf epub"><code class="nohighlight"><span class="keyword">import</span><span> </span><span class="identifier">cats</span><span>.</span><span class="type-name">Eval</span><span>

</span><span class="keyword">def</span><span> </span><span class="declaration-name">updateUser</span><span>(</span><span class="identifier">persistToDatabase</span><span>: </span><span class="type-name">User</span><span> =&gt; </span><span class="type-name">Eval</span><span>[</span><span class="type-name">UserUpdateResult</span><span>])
              (</span><span class="identifier">existingUser</span><span>: </span><span class="type-name">User</span><span>, </span><span class="identifier">newName</span><span>: </span><span class="type-name">String</span><span>, </span><span class="identifier">newAge</span><span>: </span><span class="type-name">Int</span><span>): </span><span class="type-name">Eval</span><span>[</span><span class="type-name">UserUpdateResult</span><span>] = {
  </span><span class="keyword">val</span><span> </span><span class="identifier">trimmedName</span><span> = </span><span class="identifier">newName</span><span>.</span><span class="identifier">trim</span><span>
  </span><span class="keyword">val</span><span> </span><span class="identifier">cappedAge</span><span> = </span><span class="identifier">newAge</span><span> </span><span class="identifier">max</span><span> </span><span class="number-literal">150</span><span>
  </span><span class="keyword">val</span><span> </span><span class="identifier">updatedUser</span><span> = </span><span class="identifier">existingUser</span><span>.</span><span class="identifier">copy</span><span>(</span><span class="identifier">name</span><span> = </span><span class="identifier">trimmedName</span><span>, </span><span class="identifier">age</span><span> = </span><span class="identifier">cappedAge</span><span>)

  </span><span class="identifier">persistToDatabase</span><span>(</span><span class="identifier">updatedUser</span><span>)
}</span></code></pre>
        <p>(Note: We will be using <code>Eval</code> throughout the examples on this page. If you are not
        familiar with <code>Eval</code>, it&#39;s worth reading <a href="eval.html">the Eval documentation</a> first.)</p>
        <p>Our <code>updateUser</code> function takes in an existing user and some updates to perform.
        It sanitises the inputs and updates the user model, but it delegates the
        database update to another function which is passed in as an argument.</p>
        <p>This pattern is known as &quot;continuation passing style&quot; or CPS, and the function
        passed in (<code>persistToDatabase</code>) is known as a &quot;continuation&quot;.</p>
        <p>Note the following characteristics:</p>
        <ul>
          <li>The return type of our <code>updateUser</code> function (<code>Eval[UserUpdateResult]</code>) is the
          same as the return type of the continuation function that was passed in.</li>
          <li>Our function does a bit of work to build an intermediate value, then passes
          that value to the continuation, which takes care of the remainder of the
          work.</li>
        </ul>
        <p>In Cats we can encode this pattern using the <code>ContT</code> data type:</p>
        <pre class="keep-together pdf epub"><code class="nohighlight"><span class="keyword">import</span><span> </span><span class="identifier">cats</span><span>.</span><span class="identifier">data</span><span>.</span><span class="type-name">ContT</span><span>

</span><span class="keyword">def</span><span> </span><span class="declaration-name">updateUserCont</span><span>(</span><span class="identifier">existingUser</span><span>: </span><span class="type-name">User</span><span>,
                   </span><span class="identifier">newName</span><span>: </span><span class="type-name">String</span><span>,
                   </span><span class="identifier">newAge</span><span>: </span><span class="type-name">Int</span><span>): </span><span class="type-name">ContT</span><span>[</span><span class="type-name">Eval</span><span>, </span><span class="type-name">UserUpdateResult</span><span>, </span><span class="type-name">User</span><span>] =
  </span><span class="type-name">ContT</span><span>.</span><span class="identifier">apply</span><span>[</span><span class="type-name">Eval</span><span>, </span><span class="type-name">UserUpdateResult</span><span>, </span><span class="type-name">User</span><span>] { </span><span class="identifier">next</span><span> =&gt;
    </span><span class="keyword">val</span><span> </span><span class="identifier">trimmedName</span><span> = </span><span class="identifier">newName</span><span>.</span><span class="identifier">trim</span><span>
    </span><span class="keyword">val</span><span> </span><span class="identifier">cappedAge</span><span> = </span><span class="identifier">newAge</span><span> </span><span class="identifier">min</span><span> </span><span class="number-literal">150</span><span>
    </span><span class="keyword">val</span><span> </span><span class="identifier">updatedUser</span><span> = </span><span class="identifier">existingUser</span><span>.</span><span class="identifier">copy</span><span>(</span><span class="identifier">name</span><span> = </span><span class="identifier">trimmedName</span><span>, </span><span class="identifier">age</span><span> = </span><span class="identifier">cappedAge</span><span>)

    </span><span class="identifier">next</span><span>(</span><span class="identifier">updatedUser</span><span>)
  }</span></code></pre>
        <p>We can construct a computation as follows:</p>
        <pre class="keep-together pdf epub"><code class="nohighlight"><span class="keyword">val</span><span> </span><span class="identifier">existingUser</span><span> = </span><span class="type-name">User</span><span>(</span><span class="number-literal">100</span><span>, </span><span class="string-literal">&quot;Alice&quot;</span><span>, </span><span class="number-literal">42</span><span>)
</span><span class="comment">// existingUser: User = User(100, &quot;Alice&quot;, 42)
</span><span>
</span><span class="keyword">val</span><span> </span><span class="identifier">computation</span><span> = </span><span class="identifier">updateUserCont</span><span>(</span><span class="identifier">existingUser</span><span>, </span><span class="string-literal">&quot;Bob&quot;</span><span>, </span><span class="number-literal">200</span><span>)
</span><span class="comment">// computation: ContT[Eval, UserUpdateResult, User] = FromFn(
//   Single(&lt;function1&gt;, 0)
// )</span></code></pre>
        <p>And then call <code>run</code> on it, passing in a function of type <code>User =&gt;
Eval[UserUpdateResult]</code> as the continuation:</p>
        <pre class="keep-together pdf epub"><code class="nohighlight"><span class="keyword">val</span><span> </span><span class="identifier">eval</span><span> = </span><span class="identifier">computation</span><span>.</span><span class="identifier">run</span><span> { </span><span class="identifier">user</span><span> =&gt;
  </span><span class="type-name">Eval</span><span>.</span><span class="identifier">later</span><span> {
    </span><span class="identifier">println</span><span>(</span><span class="string-literal">s&quot;Persisting updated user to the DB: </span><span class="substitution">$user</span><span class="string-literal">&quot;</span><span>)
    </span><span class="type-name">Succeeded</span><span>(</span><span class="identifier">user</span><span>.</span><span class="identifier">id</span><span>)
  }
}
</span><span class="comment">// eval: Eval[UserUpdateResult] = cats.Later@2da7d3ce</span></code></pre>
        <p>Finally we can run the resulting <code>Eval</code> to actually execute the computation:</p>
        <pre class="keep-together pdf epub"><code class="nohighlight"><span class="identifier">eval</span><span>.</span><span class="identifier">value</span><span>
</span><span class="comment">// Persisting updated user to the DB: User(100,Bob,150)
// res0: UserUpdateResult = Succeeded(100)</span></code></pre>
        
        <h2 id="composition" class="section">Composition<a class="anchor-link right" href="#composition"><i class="icofont-laika">&#xef71;</i></a></h2>
        <p>You might be wondering what the point of all this was, as the function that uses
        <code>ContT</code> seems to achieve the same thing as the original function, just encoded
        in a slightly different way.</p>
        <p>The point is that <code>ContT</code> is a monad, so by rewriting our function into a
        <code>ContT</code> we gain composibility for free.</p>
        <p>For example we can <code>map</code> over a <code>ContT</code>:</p>
        <pre><code class="nohighlight"><span class="keyword">val</span><span> </span><span class="identifier">anotherComputation</span><span> = </span><span class="identifier">computation</span><span>.</span><span class="identifier">map</span><span> { </span><span class="identifier">user</span><span> =&gt;
  </span><span class="type-name">Map</span><span>(
    </span><span class="string-literal">&quot;id&quot;</span><span> -&gt; </span><span class="identifier">user</span><span>.</span><span class="identifier">id</span><span>.</span><span class="identifier">toString</span><span>,
    </span><span class="string-literal">&quot;name&quot;</span><span> -&gt; </span><span class="identifier">user</span><span>.</span><span class="identifier">name</span><span>,
    </span><span class="string-literal">&quot;age&quot;</span><span> -&gt; </span><span class="identifier">user</span><span>.</span><span class="identifier">age</span><span>.</span><span class="identifier">toString</span><span>
  )
}
</span><span class="comment">// anotherComputation: ContT[Eval, UserUpdateResult, Map[String, String]] = FromFn(
//   Single(cats.data.ContT$$Lambda$12019/2042110056@74a94a2, 0)
// )
</span><span>
</span><span class="keyword">val</span><span> </span><span class="identifier">anotherEval</span><span> = </span><span class="identifier">anotherComputation</span><span>.</span><span class="identifier">run</span><span> { </span><span class="identifier">userFields</span><span> =&gt;
  </span><span class="type-name">Eval</span><span>.</span><span class="identifier">later</span><span> {
    </span><span class="identifier">println</span><span>(</span><span class="string-literal">s&quot;Persisting these fields to the DB: </span><span class="substitution">$userFields</span><span class="string-literal">&quot;</span><span>)
    </span><span class="type-name">Succeeded</span><span>(</span><span class="identifier">userFields</span><span>(</span><span class="string-literal">&quot;id&quot;</span><span>).</span><span class="identifier">toInt</span><span>)
  }
}
</span><span class="comment">// anotherEval: Eval[UserUpdateResult] = cats.Eval$$anon$5@13e6a09a
</span><span>
</span><span class="identifier">anotherEval</span><span>.</span><span class="identifier">value</span><span>
</span><span class="comment">// Persisting these fields to the DB: Map(id -&gt; 100, name -&gt; Bob, age -&gt; 150)
// res1: UserUpdateResult = Succeeded(100)</span></code></pre>
        <p>And we can use <code>flatMap</code> to chain multiple <code>ContT</code>s together.</p>
        <p>The following example builds 3 computations: one to sanitise the inputs and
        update the user model, one to persist the updated user to the database, and one
        to publish a message saying the user was updated. It then chains them together
        in continuation-passing style using <code>flatMap</code> and runs the whole computation.</p>
        <pre><code class="nohighlight"><span class="keyword">val</span><span> </span><span class="identifier">updateUserModel</span><span>: </span><span class="type-name">ContT</span><span>[</span><span class="type-name">Eval</span><span>, </span><span class="type-name">UserUpdateResult</span><span>, </span><span class="type-name">User</span><span>] =
  </span><span class="identifier">updateUserCont</span><span>(</span><span class="identifier">existingUser</span><span>, </span><span class="string-literal">&quot;Bob&quot;</span><span>, </span><span class="number-literal">200</span><span>).</span><span class="identifier">map</span><span> { </span><span class="identifier">updatedUser</span><span> =&gt;
    </span><span class="identifier">println</span><span>(</span><span class="string-literal">&quot;Updated user model&quot;</span><span>)
    </span><span class="identifier">updatedUser</span><span>
  }
</span><span class="comment">// updateUserModel: ContT[Eval, UserUpdateResult, User] = FromFn(
//   Single(cats.data.ContT$$Lambda$12019/2042110056@732584d0, 0)
// )
</span><span>
</span><span class="keyword">val</span><span> </span><span class="identifier">persistToDb</span><span>: </span><span class="type-name">User</span><span> =&gt; </span><span class="type-name">ContT</span><span>[</span><span class="type-name">Eval</span><span>, </span><span class="type-name">UserUpdateResult</span><span>, </span><span class="type-name">UserUpdateResult</span><span>] = {
  </span><span class="identifier">user</span><span> =&gt;
    </span><span class="type-name">ContT</span><span>.</span><span class="identifier">apply</span><span>[</span><span class="type-name">Eval</span><span>, </span><span class="type-name">UserUpdateResult</span><span>, </span><span class="type-name">UserUpdateResult</span><span>] { </span><span class="identifier">next</span><span> =&gt;
      </span><span class="identifier">println</span><span>(</span><span class="string-literal">s&quot;Persisting updated user to the DB: </span><span class="substitution">$user</span><span class="string-literal">&quot;</span><span>)

      </span><span class="identifier">next</span><span>(</span><span class="type-name">Succeeded</span><span>(</span><span class="identifier">user</span><span>.</span><span class="identifier">id</span><span>))
    }
}
</span><span class="comment">// persistToDb: User =&gt; ContT[Eval, UserUpdateResult, UserUpdateResult] = &lt;function1&gt;
</span><span>
</span><span class="keyword">val</span><span> </span><span class="identifier">publishEvent</span><span>: </span><span class="type-name">UserUpdateResult</span><span> =&gt; </span><span class="type-name">ContT</span><span>[</span><span class="type-name">Eval</span><span>, </span><span class="type-name">UserUpdateResult</span><span>, </span><span class="type-name">UserUpdateResult</span><span>] = {
  </span><span class="identifier">userUpdateResult</span><span> =&gt;
    </span><span class="type-name">ContT</span><span>.</span><span class="identifier">apply</span><span>[</span><span class="type-name">Eval</span><span>, </span><span class="type-name">UserUpdateResult</span><span>, </span><span class="type-name">UserUpdateResult</span><span>] { </span><span class="identifier">next</span><span> =&gt;
      </span><span class="identifier">userUpdateResult</span><span> </span><span class="keyword">match</span><span> {
        </span><span class="keyword">case</span><span> </span><span class="type-name">Succeeded</span><span>(</span><span class="identifier">userId</span><span>) =&gt;
          </span><span class="identifier">println</span><span>(</span><span class="string-literal">s&quot;Publishing &#39;user updated&#39; event for user ID </span><span class="substitution">$userId</span><span class="string-literal">&quot;</span><span>)
        </span><span class="keyword">case</span><span> </span><span class="type-name">Failed</span><span> =&gt;
          </span><span class="identifier">println</span><span>(</span><span class="string-literal">&quot;Not publishing &#39;user updated&#39; event because update failed&quot;</span><span>)
      }

      </span><span class="identifier">next</span><span>(</span><span class="identifier">userUpdateResult</span><span>)
    }
}
</span><span class="comment">// publishEvent: UserUpdateResult =&gt; ContT[Eval, UserUpdateResult, UserUpdateResult] = &lt;function1&gt;
</span><span>
</span><span class="keyword">val</span><span> </span><span class="identifier">chainOfContinuations</span><span> =
  </span><span class="identifier">updateUserModel</span><span> </span><span class="identifier">flatMap</span><span> </span><span class="identifier">persistToDb</span><span> </span><span class="identifier">flatMap</span><span> </span><span class="identifier">publishEvent</span><span>
</span><span class="comment">// chainOfContinuations: ContT[Eval, UserUpdateResult, UserUpdateResult] = FromFn(
//   Single(cats.data.ContT$$Lambda$12021/179597833@79cfeba, 0)
// )
</span><span>
</span><span class="keyword">val</span><span> </span><span class="identifier">eval</span><span> = </span><span class="identifier">chainOfContinuations</span><span>.</span><span class="identifier">run</span><span> { </span><span class="identifier">finalResult</span><span> =&gt;
  </span><span class="type-name">Eval</span><span>.</span><span class="identifier">later</span><span> {
    </span><span class="identifier">println</span><span>(</span><span class="string-literal">&quot;Finished!&quot;</span><span>)
    </span><span class="identifier">finalResult</span><span>
  }
}
</span><span class="comment">// eval: Eval[UserUpdateResult] = cats.Eval$$anon$5@43a4aa78
</span><span>
</span><span class="identifier">eval</span><span>.</span><span class="identifier">value</span><span>
</span><span class="comment">// Updated user model
// Persisting updated user to the DB: User(100,Bob,150)
// Publishing &#39;user updated&#39; event for user ID 100
// Finished!
// res2: UserUpdateResult = Succeeded(100)</span></code></pre>
        
        <h2 id="why-eval" class="section">Why Eval?<a class="anchor-link right" href="#why-eval"><i class="icofont-laika">&#xef71;</i></a></h2>
        <p>If you&#39;re wondering why we used <code>Eval</code> in our examples above, it&#39;s because the
        <code>Monad</code> instance for <code>ContT[M[_], A, B]</code> requires an instance of <code>cats.Defer</code>
        for <code>M[_]</code>. This is an implementation detail - it&#39;s needed in order to preserve
        stack safety.</p>
        <p>In a real-world application, you&#39;re more likely to be using something like
        cats-effect <code>IO</code>, which has a <code>Defer</code> instance.</p>

        <hr style="margin-top: 30px"/>
        <footer style="font-size: 90%; text-align: center">
          cats is a <a href="https://typelevel.org/">Typelevel</a> project distributed under the <a href="https://opensource.org/licenses/MIT">MIT</a> license.
        </footer>

      </main>

    </div>

  </body>
</html>
